import{_ as a,j as s,U as l,Q as t,V as e,W as n,A as r,r as u,n as i,d as o,e as d,g as c,w as f,T as v,E as p,f as _,o as g,k as y,t as m,s as I,z as h}from"./index-774e9717.js";const w={class:"profile-container"},x={key:0,class:"loading-container"},b={key:1,class:"error-container"},S={key:2},P={class:"user-info"},k={class:"user-details"},D={class:"user-role"},U={class:"card-header"},A={class:"status-content"},C={class:"status-item"},E={key:0,class:"status-item"},z={key:1,class:"status-item"},L={class:"card-header"},T={class:"traffic-content"},B={class:"traffic-progress"},F={class:"traffic-details"},N={class:"traffic-item"},R={class:"traffic-item"},j={class:"traffic-item"},Q={class:"card-header"},H={class:"port-content"},V={class:"port-item"},W={class:"port-item"},q={class:"port-item"},G={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},J={class:"card-header"},K={class:"stat-item"},M={class:"stat-value"},O={class:"stat-item"},X={class:"stat-value success"},Y={class:"stat-item"},Z={class:"stat-value warning"},$={class:"stat-item"},aa={class:"stat-value danger"},sa={class:"card-header"},la={key:0},ta={key:1,class:"no-expiry"};const ea=a({name:"Profile",components:{User:s,DataLine:l,Connection:t,DataBoard:e,List:n,Right:r},setup(){const a=u(null),s=u(!1),l=()=>{return l=this,t=null,e=function*(){var l;try{s.value=!0;const l=yield v.get("/users/me");l&&l.data?l.data.success&&l.data.data?a.value=l.data.data:l.data.data?a.value=l.data:p.error("用户信息格式错误"):p.error("获取用户信息失败")}catch(t){401===(null==(l=t.response)?void 0:l.status)?p.error("登录已过期，请重新登录"):p.error("获取用户信息失败")}finally{s.value=!1}},new Promise(((a,s)=>{var n=a=>{try{u(e.next(a))}catch(l){s(l)}},r=a=>{try{u(e.throw(a))}catch(l){s(l)}},u=s=>s.done?a(s.value):Promise.resolve(s.value).then(n,r);u((e=e.apply(l,t)).next())}));var l,t,e};return i((()=>{l()})),{userInfo:a,loading:s,fetchUserInfo:l,formatDate:a=>a?new Date(a).toLocaleString("zh-CN"):"-",getDaysClass:a=>a<=0?"expired":a<=7?"warning":a<=30?"caution":"normal",getTrafficStatus:a=>a>=90?"exception":a>=70?"warning":"success",getUsageClass:a=>a>=90?"danger":a>=70?"warning":"success"}}},[["render",function(a,s,l,t,e,n){const r=_("el-loading-spinner"),u=_("el-button"),i=_("el-empty"),v=_("el-avatar"),p=_("el-tag"),ea=_("el-card"),na=_("User"),ra=_("el-icon"),ua=_("el-col"),ia=_("DataLine"),oa=_("el-progress"),da=_("Connection"),ca=_("el-row"),fa=_("DataBoard"),va=_("List"),pa=_("el-table-column"),_a=_("Right"),ga=_("el-table");return g(),o("div",w,[t.loading?(g(),o("div",x,[d(r,{size:"50"}),s[0]||(s[0]=c("p",null,"正在加载用户信息...",-1))])):t.userInfo?(g(),o("div",S,[d(ea,{class:"profile-header"},{default:f((()=>{var a,l,e,n;return[c("div",P,[d(v,{size:80,class:"user-avatar"},{default:f((()=>s[2]||(s[2]=[c("i",{class:"el-icon-user"},null,-1)]))),_:1,__:[2]}),c("div",k,[c("h2",null,m(null==(a=t.userInfo)?void 0:a.username),1),d(p,{type:(null==(e=null==(l=t.userInfo)?void 0:l.accountStatus)?void 0:e.isExpired)?"danger":"success"},{default:f((()=>{var a,s;return[y(m((null==(s=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:s.isExpired)?"已过期":"正常"),1)]})),_:1},8,["type"]),c("p",D,m("admin"===(null==(n=t.userInfo)?void 0:n.role)?"管理员":"普通用户"),1)])])]})),_:1}),d(ca,{gutter:20,style:{"margin-top":"20px"}},{default:f((()=>[d(ua,{span:8},{default:f((()=>[d(ea,{class:"status-card"},{header:f((()=>[c("div",U,[s[3]||(s[3]=c("span",null,"账户状态",-1)),d(ra,null,{default:f((()=>[d(na)])),_:1})])])),default:f((()=>{var a,l,e,n,r,u;return[c("div",A,[c("div",C,[s[4]||(s[4]=c("span",{class:"label"},"账户状态:",-1)),d(p,{type:(null==(l=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:l.isExpired)?"danger":"success"},{default:f((()=>{var a,s;return[y(m((null==(s=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:s.userStatus)||"正常"),1)]})),_:1},8,["type"])]),(null==(n=null==(e=t.userInfo)?void 0:e.accountStatus)?void 0:n.expiresAt)?(g(),o("div",E,[s[5]||(s[5]=c("span",{class:"label"},"到期时间:",-1)),c("span",null,m(t.formatDate(t.userInfo.accountStatus.expiresAt)),1)])):I("",!0),null!==(null==(u=null==(r=t.userInfo)?void 0:r.accountStatus)?void 0:u.daysUntilExpiry)?(g(),o("div",z,[s[6]||(s[6]=c("span",{class:"label"},"剩余天数:",-1)),c("span",{class:h(t.getDaysClass(t.userInfo.accountStatus.daysUntilExpiry))},m(t.userInfo.accountStatus.daysUntilExpiry>0?t.userInfo.accountStatus.daysUntilExpiry+" 天":"已过期"),3)])):I("",!0)])]})),_:1})])),_:1}),d(ua,{span:8},{default:f((()=>[d(ea,{class:"traffic-card"},{header:f((()=>[c("div",L,[s[7]||(s[7]=c("span",null,"流量使用",-1)),d(ra,null,{default:f((()=>[d(ia)])),_:1})])])),default:f((()=>{var a,l,e,n,r,u,i,o,f,v,p,_,g;return[c("div",T,[c("div",B,[d(oa,{percentage:(null==(l=null==(a=t.userInfo)?void 0:a.trafficStats)?void 0:l.usagePercent)||0,status:t.getTrafficStatus(null==(n=null==(e=t.userInfo)?void 0:e.trafficStats)?void 0:n.usagePercent),"stroke-width":12},null,8,["percentage","status"])]),c("div",F,[c("div",N,[s[8]||(s[8]=c("span",{class:"label"},"已使用:",-1)),c("span",null,m((null==(u=null==(r=t.userInfo)?void 0:r.trafficStats)?void 0:u.usedTrafficFormatted)||"0 B"),1)]),c("div",R,[s[9]||(s[9]=c("span",{class:"label"},"总配额:",-1)),c("span",null,m((null==(o=null==(i=t.userInfo)?void 0:i.trafficStats)?void 0:o.trafficQuotaFormatted)||"无限制"),1)]),c("div",j,[s[10]||(s[10]=c("span",{class:"label"},"使用率:",-1)),c("span",{class:h(t.getUsageClass(null==(v=null==(f=t.userInfo)?void 0:f.trafficStats)?void 0:v.usagePercent))},m((null==(g=null==(_=null==(p=t.userInfo)?void 0:p.trafficStats)?void 0:_.usagePercent)?void 0:g.toFixed(1))||0)+"% ",3)])])])]})),_:1})])),_:1}),d(ua,{span:8},{default:f((()=>[d(ea,{class:"port-card"},{header:f((()=>[c("div",Q,[s[11]||(s[11]=c("span",null,"端口范围",-1)),d(ra,null,{default:f((()=>[d(da)])),_:1})])])),default:f((()=>{var a,l,e,n;return[c("div",H,[c("div",V,[s[12]||(s[12]=c("span",{class:"label"},"端口范围:",-1)),d(p,{type:"info"},{default:f((()=>{var a,s,l,e;return[y(m(null==(s=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:s.startPort)+" - "+m(null==(e=null==(l=t.userInfo)?void 0:l.portInfo)?void 0:e.endPort),1)]})),_:1})]),c("div",W,[s[13]||(s[13]=c("span",{class:"label"},"可用端口:",-1)),c("span",null,m((null==(l=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:l.availablePorts)||0)+" 个",1)]),c("div",q,[s[14]||(s[14]=c("span",{class:"label"},"端口范围:",-1)),c("div",null,[d(p,{type:"info",size:"small"},{default:f((()=>{var a,s,l,e;return[y(m((null==(s=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:s.startPort)||"N/A")+" - "+m((null==(e=null==(l=t.userInfo)?void 0:l.portInfo)?void 0:e.endPort)||"N/A"),1)]})),_:1}),c("span",G," (共 "+m((null==(n=null==(e=t.userInfo)?void 0:e.portInfo)?void 0:n.availablePorts)||0)+" 个可用端口) ",1)])])])]})),_:1})])),_:1})])),_:1}),d(ca,{style:{"margin-top":"20px"}},{default:f((()=>[d(ua,{span:24},{default:f((()=>[d(ea,null,{header:f((()=>[c("div",J,[s[15]||(s[15]=c("span",null,"转发规则统计",-1)),d(ra,null,{default:f((()=>[d(fa)])),_:1})])])),default:f((()=>[d(ca,{gutter:20},{default:f((()=>[d(ua,{span:6},{default:f((()=>{var a,l;return[c("div",K,[c("div",M,m((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.total)||0),1),s[16]||(s[16]=c("div",{class:"stat-label"},"总规则数",-1))])]})),_:1}),d(ua,{span:6},{default:f((()=>{var a,l;return[c("div",O,[c("div",X,m((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.active)||0),1),s[17]||(s[17]=c("div",{class:"stat-label"},"活跃规则",-1))])]})),_:1}),d(ua,{span:6},{default:f((()=>{var a,l;return[c("div",Y,[c("div",Z,m((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.inactive)||0),1),s[18]||(s[18]=c("div",{class:"stat-label"},"非活跃规则",-1))])]})),_:1}),d(ua,{span:6},{default:f((()=>{var a,l;return[c("div",$,[c("div",aa,m((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.expired)||0),1),s[19]||(s[19]=c("div",{class:"stat-label"},"过期规则",-1))])]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(ca,{style:{"margin-top":"20px"}},{default:f((()=>[d(ua,{span:24},{default:f((()=>[d(ea,null,{header:f((()=>[c("div",sa,[s[20]||(s[20]=c("span",null,"我的转发规则",-1)),d(ra,null,{default:f((()=>[d(va)])),_:1})])])),default:f((()=>{var a;return[d(ga,{data:(null==(a=t.userInfo)?void 0:a.forwardRules)||[],stripe:"",style:{width:"100%"}},{default:f((()=>[d(pa,{prop:"name",label:"规则名称"}),d(pa,{prop:"protocol",label:"协议",width:"80"}),d(pa,{label:"转发规则",width:"200"},{default:f((a=>[d(p,{type:"primary"},{default:f((()=>[y(m(a.row.sourcePort)+" ",1),d(ra,null,{default:f((()=>[d(_a)])),_:1}),y(" "+m(a.row.targetHost)+":"+m(a.row.targetPort),1)])),_:2},1024)])),_:1}),d(pa,{label:"状态",width:"100"},{default:f((a=>[d(p,{type:a.row.isActive?"success":"info",size:"small"},{default:f((()=>[y(m(a.row.isActive?"活跃":"非活跃"),1)])),_:2},1032,["type"])])),_:1}),d(pa,{label:"到期时间",width:"150"},{default:f((a=>[a.row.expiresAt?(g(),o("span",la,m(t.formatDate(a.row.expiresAt)),1)):(g(),o("span",ta,"无期限"))])),_:1}),d(pa,{label:"创建时间",width:"150"},{default:f((a=>[y(m(t.formatDate(a.row.createdAt)),1)])),_:1})])),_:1},8,["data"])]})),_:1})])),_:1})])),_:1})])):(g(),o("div",b,[d(i,{description:"无法获取用户信息"},{default:f((()=>[d(u,{type:"primary",onClick:t.fetchUserInfo},{default:f((()=>s[1]||(s[1]=[y("重新加载")]))),_:1,__:[1]},8,["onClick"])])),_:1})]))])}],["__scopeId","data-v-82a10759"]]);export{ea as default};
