# GOST管理系统测试指南

本文档介绍如何使用保留的测试脚本来验证GOST管理系统的功能和性能。

## 🚀 快速开始

### 1. 准备环境
```bash
# 启动后端服务
npm run dev

# 创建测试用户和规则
node create-test-users.js
```

### 2. 系统诊断
```bash
# 检查系统健康状态
node diagnose-system.js
```

## 🧪 测试脚本说明

### 基础功能测试

#### `debug-observer-simple.js` - 简单观察器测试
**用途**：验证观察器基本功能
**时长**：10秒
**流量**：10MB
**适用场景**：
- 初次部署后的功能验证
- 观察器问题排查
- 快速功能检查

```bash
node debug-observer-simple.js
```

**预期结果**：
- 成功率：100%
- 流量准确性：1.00x
- Admin用户流量增加10MB

---

#### `debug-gentle-test.js` - 温和压力测试
**用途**：验证系统稳定性
**时长**：2分钟
**流量**：~150MB
**连接数**：60次请求
**适用场景**：
- 日常功能验证
- 系统稳定性检查
- 多端口测试

```bash
node debug-gentle-test.js
```

**预期结果**：
- 成功率：100%
- 流量准确性：1.00x
- 数据一致性：✅ 优秀

---

### 高级性能测试

#### `test-streaming-pressure.js` - 流媒体压力测试
**用途**：验证真实流媒体场景
**时长**：2分30秒
**流量**：~5GB
**连接数**：每用户最多300个
**适用场景**：
- 流媒体服务部署前验证
- 高并发场景测试
- 网络性能评估

```bash
node test-streaming-pressure.js
```

**预期结果**：
- 成功率：100%
- 流量准确性：1.000x
- 平均吞吐量：>25MB/s

---

#### `test-real-1tb.js` - 1TB极限测试
**用途**：验证企业级处理能力
**时长**：12分钟
**流量**：~1TB
**连接数**：每用户最多300个
**适用场景**：
- 企业级部署前验证
- 系统极限能力测试
- 长时间稳定性验证

```bash
node test-real-1tb.js
```

**预期结果**：
- 成功率：100%
- 流量准确性：1.000005x
- 1TB目标达成：>95%

## 🛠️ 运维工具

### 系统诊断
```bash
# 全面系统诊断
node diagnose-system.js

# 检查数据库迁移状态
node check-migration-status.js

# 检查数据库表结构
node check-table-structure.js
```

### 数据管理
```bash
# 重置所有流量统计
node reset-all-stats.js

# 创建测试用户和规则
node create-test-users.js
```

### 数据库修复
```bash
# 修复表约束问题（如需要）
node fix-table-constraints.js
```

## 📊 测试流程建议

### 新部署验证流程
1. **基础验证**：`debug-observer-simple.js`
2. **稳定性验证**：`debug-gentle-test.js`
3. **性能验证**：`test-streaming-pressure.js`
4. **极限验证**：`test-real-1tb.js`（可选）

### 日常维护流程
1. **健康检查**：`diagnose-system.js`
2. **功能验证**：`debug-gentle-test.js`
3. **问题排查**：根据需要使用相应工具

### 生产环境部署前
1. **完整测试**：运行所有测试脚本
2. **长时间验证**：`test-real-1tb.js`
3. **系统诊断**：`diagnose-system.js`

## ⚠️ 注意事项

### 测试环境要求
- 确保后端服务正常运行
- 数据库连接正常
- 有足够的磁盘空间（1TB测试需要）

### 测试数据清理
```bash
# 测试完成后重置统计数据
node reset-all-stats.js
```

### 性能考虑
- 1TB测试会产生大量数据库写入
- 建议在非生产时间进行极限测试
- 测试期间系统资源使用率会较高

## 🔧 故障排除

### 常见问题

#### 观察器测试失败
1. 检查后端服务是否运行
2. 检查用户和规则是否创建
3. 运行 `diagnose-system.js` 诊断

#### 数据库错误
1. 检查数据库连接
2. 运行 `check-table-structure.js`
3. 如需要运行 `fix-table-constraints.js`

#### 流量统计不准确
1. 检查观察器配置
2. 验证端口用户映射
3. 检查GOST配置同步

### 获取帮助
- 查看后端服务日志
- 运行系统诊断脚本
- 检查数据库状态

## 📈 性能基准

### 系统性能指标
- **基础功能**：1.00x流量准确性
- **温和压力**：100%成功率，1.00x准确性
- **流媒体场景**：>25MB/s吞吐量，1.000x准确性
- **企业级极限**：>1.5GB/s吞吐量，1.000005x准确性

### 硬件要求
- **CPU**：多核处理器（推荐4核以上）
- **内存**：4GB以上（1TB测试推荐8GB以上）
- **磁盘**：SSD推荐，足够的可用空间
- **网络**：稳定的网络连接

---

**注意**：这些测试脚本是为了验证系统功能和性能，请根据实际需求选择合适的测试级别。
