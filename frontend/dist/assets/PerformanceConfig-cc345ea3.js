var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a,l)=>new Promise(((t,s)=>{var n=e=>{try{i(l.next(e))}catch(a){s(a)}},o=e=>{try{i(l.throw(e))}catch(a){s(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,o);i((l=l.apply(e,a)).next())}));import{_ as c,u,a as d,m as r,E as m,r as p,c as g,n as h,d as f,g as v,e as y,w as C,q as b,s as T,C as S,f as _,o as P,k as M,t as V,F as k,D as w}from"./index-5e784131.js";import{a as x}from"./api-88fce923.js";const I={class:"performance-config"},O={class:"card-header"},L={class:"mode-content"},U={class:"mode-description"},z={key:0,class:"simple-mode-info"},H={class:"manual-sync-section"},G={key:1,class:"auto-mode-info"},j={class:"mode-switch"},B={class:"preset-buttons"},F={class:"preset-descriptions"},A={class:"card-header"},$={class:"protocol-content"},D={class:"protocol-checkboxes"},E={class:"card-header"},N={class:"config-section"},R={class:"config-item"},q={class:"param-help"},K={class:"config-item"},J={class:"param-help"},Q={class:"config-item"},W={class:"config-item"},X={class:"param-help"},Y={class:"config-section"},Z={class:"config-item"},ee={class:"param-help"},ae={class:"config-item"},le={class:"param-help"},te={class:"config-item"},se={class:"config-section"},ne={class:"config-item"},oe={class:"param-help"},ie={class:"config-item"},ce={class:"param-help"},ue={class:"card-header"},de={class:"status-content"},re={class:"status-item"},me={class:"status-item"},pe={class:"status-item"},ge={key:0,class:"last-updated"};const he=c({name:"PerformanceConfig",setup(){const e=u(),c=d();if(!r((()=>e.getters["user/isAdmin"])).value)return m.error("此功能仅限管理员使用"),c.push("/dashboard"),{};const f=p(!1),v=p(!1),y=p(!1),C=p(!1),b=p(!1),T=p(""),_=p(!1),P=p("plugins"),M=p([]),V=p({}),k=g({systemMode:{isSimpleMode:!1},gostPlugins:{authTimeout:5,observerTimeout:10,limiterTimeout:5},cacheConfig:{authCacheTimeout:6e5,limiterCacheTimeout:3e5,multiInstanceCacheTTL:12e4},syncConfig:{autoSyncInterval:3e5,healthCheckInterval:12e4},observerPeriod:120}),w=p({}),I=p({}),O=p({}),L=r({get:()=>k.systemMode.isSimpleMode,set:e=>{k.systemMode.isSimpleMode=e}}),U=r((()=>L.value?"simple":"auto")),z=r({get:()=>Math.round(k.cacheConfig.authCacheTimeout/6e4),set:e=>{k.cacheConfig.authCacheTimeout=6e4*e}}),H=r({get:()=>k.cacheConfig.limiterCacheTimeout/6e4,set:e=>{k.cacheConfig.limiterCacheTimeout=6e4*e}}),G=r({get:()=>k.cacheConfig.multiInstanceCacheTTL/6e4,set:e=>{k.cacheConfig.multiInstanceCacheTTL=6e4*e}}),j=r({get:()=>k.syncConfig.autoSyncInterval/6e4,set:e=>{k.syncConfig.autoSyncInterval=6e4*e}}),B=r({get:()=>k.syncConfig.healthCheckInterval/6e4,set:e=>{k.syncConfig.healthCheckInterval=6e4*e}}),F=r({get:()=>{var e;return(null==(e=k.gostPlugins)?void 0:e.observerPeriod)||120},set:e=>{k.gostPlugins||(k.gostPlugins={}),k.gostPlugins.observerPeriod=e}}),A=()=>i(this,null,(function*(){try{f.value=!0;const e=yield x.get("/performance-config");e.data.success&&(V.value=e.data.data.config,w.value=e.data.data.modeStatus,Object.assign(k,e.data.data.config)),yield $()}catch(e){m.error("加载配置失败: "+e.message)}finally{f.value=!1}})),$=()=>i(this,null,(function*(){try{const e=yield x.get("/system-config/disabledProtocols");e.data.success&&e.data.data&&(M.value=e.data.data.value||[])}catch(e){M.value=[]}})),D=()=>i(this,null,(function*(){try{const e=yield x.get("/performance-config/help");e.data.success&&(I.value=e.data.data.presets||{},O.value=e.data.data.parameterHelp||{})}catch(e){}})),E=()=>i(this,null,(function*(){try{y.value=!0;const e=yield x.get("/performance-config/status");e.data.success&&(w.value=e.data.data)}catch(e){m.error("刷新状态失败: "+e.message)}finally{y.value=!1}}));return h((()=>i(this,null,(function*(){yield A(),yield D(),yield E()})))),{loading:f,saveLoading:v,statusLoading:y,modeSwitchLoading:C,manualSyncLoading:b,presetLoading:T,protocolSaveLoading:_,activeTab:P,config:V,configForm:k,systemStatus:w,presets:I,parameterHelp:O,isSimpleMode:L,currentMode:U,authCacheMinutes:z,limiterCacheMinutes:H,multiInstanceCacheMinutes:G,autoSyncMinutes:j,healthCheckMinutes:B,observerPeriodSeconds:F,disabledProtocols:M,loadConfig:A,loadProtocolConfig:$,refreshStatus:E,saveConfig:()=>i(this,null,(function*(){try{v.value=!0;const c=yield x.put("/performance-config",(e=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&o(e,l,a[l]);return e})({},k),i={description:"管理员更新性能配置"},a(e,l(i))));c.data.success&&(m.success("配置保存成功"),yield A(),c.data.data.modeChanged&&m.info("系统模式已切换到"+("simple"===c.data.data.newMode?"单机模式":"自动模式")))}catch(c){m.error("保存配置失败: "+c.message)}finally{v.value=!1}var e,i})),saveProtocolConfig:()=>i(this,null,(function*(){try{_.value=!0;(yield x.put("/system-config/disabledProtocols",{value:M.value,description:"管理员更新禁用协议配置",category:"security"})).data.success&&(m.success("协议屏蔽配置保存成功"),yield $())}catch(e){m.error("保存协议屏蔽配置失败: "+e.message)}finally{_.value=!1}})),handleModeSwitch:e=>i(this,null,(function*(){try{C.value=!0;yield S.confirm(`确定要切换到${e?"单机模式":"自动模式"}吗？\n\n${e?"单机模式将禁用所有自动化功能，需要手动同步配置":"自动模式将启用所有自动化功能，配置变更将自动同步"}`,"确认模式切换",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=yield x.post("/performance-config/switch-mode",{isSimpleMode:e,description:"管理员切换到"+(e?"单机模式":"自动模式")});a.data.success&&(m.success(a.data.message),yield A(),yield E())}catch(a){"cancel"!==a&&m.error("切换模式失败: "+a.message),k.systemMode.isSimpleMode=!e}finally{C.value=!1}})),handleManualSync:()=>i(this,null,(function*(){try{b.value=!0;yield S.confirm("确定要手动同步GOST配置吗？\n\n这将重新生成配置文件并重启GOST服务，可能会短暂中断现有连接。","确认手动同步",{confirmButtonText:"确定同步",cancelButtonText:"取消",type:"warning"});(yield x.post("/performance-config/manual-sync")).data.success&&(m.success("GOST配置同步成功"),yield E())}catch(e){"cancel"!==e&&m.error("手动同步失败: "+e.message)}finally{b.value=!1}})),applyPreset:e=>i(this,null,(function*(){var a,l;try{if(T.value=e,L.value)return void m.error("性能预设只能在自动模式下应用，请先切换到自动模式");const a=I.value[e];yield S.confirm(`确定要应用"${a.name}"预设配置吗？\n\n${a.description}\n\n这将覆盖当前的详细配置参数。`,"确认应用预设",{confirmButtonText:"确定应用",cancelButtonText:"取消",type:"info"});(yield x.post("/performance-config/apply-preset",{presetName:e,description:`应用预设配置: ${a.name}`})).data.success&&(m.success(`预设配置"${a.name}"应用成功`),yield A(),yield E())}catch(t){if("cancel"!==t){const e=(null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message||"应用预设失败";m.error(e)}}finally{T.value=""}})),getPresetButtonType:e=>"highPerformance"===e?"danger":"balanced"===e?"primary":"highAvailability"===e?"success":"default",getParamHelp:(e,a)=>{var l,t;return(null==(t=null==(l=O.value[e])?void 0:l[a])?void 0:t.description)||""},formatTime:e=>e?new Date(e).toLocaleString("zh-CN"):"未知",updateAuthCacheTimeout:e=>{k.cacheConfig.authCacheTimeout=6e4*e},updateLimiterCacheTimeout:e=>{k.cacheConfig.limiterCacheTimeout=6e4*e},updateMultiInstanceCacheTTL:e=>{k.cacheConfig.multiInstanceCacheTTL=6e4*e},updateAutoSyncInterval:e=>{k.syncConfig.autoSyncInterval=6e4*e},updateHealthCheckInterval:e=>{k.syncConfig.healthCheckInterval=6e4*e},updateObserverPeriod:()=>{}}}},[["render",function(e,a,l,t,s,n){const o=_("el-tag"),i=_("el-alert"),c=_("el-button"),u=_("el-switch"),d=_("el-card"),r=_("el-checkbox"),m=_("el-checkbox-group"),p=_("el-input-number"),g=_("el-col"),h=_("el-row"),S=_("el-tab-pane"),x=_("el-tabs");return P(),f("div",I,[a[46]||(a[46]=v("div",{class:"page-header"},[v("h1",null,"🎛️ 性能配置管理"),v("p",{class:"description"},"管理GOST系统的性能参数和运行模式")],-1)),y(d,{class:"mode-card",shadow:"hover"},{header:C((()=>[v("div",O,[a[12]||(a[12]=v("span",null,"🔧 系统运行模式",-1)),y(o,{type:"simple"===t.currentMode?"danger":"success"},{default:C((()=>[M(V("simple"===t.currentMode?"单机模式":"自动模式"),1)])),_:1},8,["type"])])])),default:C((()=>[v("div",L,[v("div",U,["simple"===t.currentMode?(P(),f("div",z,[y(i,{title:"单机模式已启用",type:"warning",description:"所有自动化功能已禁用，需要手动重启GOST服务来同步配置","show-icon":"",closable:!1}),v("div",H,[y(c,{type:"primary",size:"large",loading:t.manualSyncLoading,onClick:t.handleManualSync},{default:C((()=>a[13]||(a[13]=[v("i",{class:"el-icon-refresh"},null,-1),M(" 手动同步GOST配置 ")]))),_:1,__:[13]},8,["loading","onClick"]),a[14]||(a[14]=v("p",{class:"sync-tip"},"点击此按钮将重新生成GOST配置并重启服务",-1))])])):(P(),f("div",G,[y(i,{title:"自动模式已启用",type:"success",description:"所有自动化功能正常运行，配置变更将自动同步","show-icon":"",closable:!1})]))]),v("div",j,[y(u,{modelValue:t.isSimpleMode,"onUpdate:modelValue":a[0]||(a[0]=e=>t.isSimpleMode=e),"active-text":"单机模式","inactive-text":"自动模式","active-color":"#f56c6c","inactive-color":"#67c23a",loading:t.modeSwitchLoading,onChange:t.handleModeSwitch},null,8,["modelValue","loading","onChange"])])])])),_:1}),t.isSimpleMode?T("",!0):(P(),b(d,{key:0,class:"preset-card",shadow:"hover"},{header:C((()=>a[15]||(a[15]=[v("span",null,"🎯 性能预设配置",-1)]))),default:C((()=>[v("div",B,[(P(!0),f(k,null,w(t.presets,((e,a)=>(P(),b(c,{key:a,type:t.getPresetButtonType(a),loading:t.presetLoading===a,onClick:e=>t.applyPreset(a)},{default:C((()=>[M(V(e.name),1)])),_:2},1032,["type","loading","onClick"])))),128))]),v("div",F,[(P(!0),f(k,null,w(t.presets,((e,a)=>(P(),f("div",{key:a,class:"preset-item"},[v("h4",null,V(e.name),1),v("p",null,V(e.description),1)])))),128))]),y(i,{title:"提示",type:"info",description:"性能预设会覆盖当前的详细配置参数，应用后可以在下方详细配置中进一步调整","show-icon":"",closable:!1,style:{"margin-top":"15px"}})])),_:1})),y(d,{class:"protocol-card",shadow:"hover"},{header:C((()=>[v("div",A,[a[17]||(a[17]=v("span",null,"🚫 协议屏蔽配置",-1)),y(c,{type:"primary",size:"small",onClick:t.saveProtocolConfig,loading:t.protocolSaveLoading},{default:C((()=>a[16]||(a[16]=[M(" 保存配置 ")]))),_:1,__:[16]},8,["onClick","loading"])])])),default:C((()=>[v("div",$,[a[21]||(a[21]=v("p",{class:"section-desc"},"选择需要禁用的转发协议，被禁用的协议将无法创建新规则或转发流量",-1)),v("div",D,[y(m,{modelValue:t.disabledProtocols,"onUpdate:modelValue":a[1]||(a[1]=e=>t.disabledProtocols=e)},{default:C((()=>[y(r,{label:"socks"},{default:C((()=>a[18]||(a[18]=[M("SOCKS 协议")]))),_:1,__:[18]}),y(r,{label:"http"},{default:C((()=>a[19]||(a[19]=[M("HTTP 协议")]))),_:1,__:[19]}),y(r,{label:"tls"},{default:C((()=>a[20]||(a[20]=[M("TLS 协议")]))),_:1,__:[20]})])),_:1},8,["modelValue"])]),t.disabledProtocols.length>0?(P(),b(i,{key:0,title:"警告：禁用协议将立即生效",type:"warning",description:"禁用协议后，所有使用该协议的转发规则将停止工作，直到重新启用该协议","show-icon":"",closable:!1,style:{"margin-top":"15px"}})):T("",!0)])])),_:1}),t.isSimpleMode?T("",!0):(P(),b(d,{key:1,class:"config-card",shadow:"hover"},{header:C((()=>[v("div",E,[a[23]||(a[23]=v("span",null,"⚙️ 详细配置参数",-1)),y(c,{type:"primary",size:"small",onClick:t.saveConfig,loading:t.saveLoading},{default:C((()=>a[22]||(a[22]=[M(" 保存配置 ")]))),_:1,__:[22]},8,["onClick","loading"])])])),default:C((()=>[y(x,{modelValue:t.activeTab,"onUpdate:modelValue":a[11]||(a[11]=e=>t.activeTab=e),type:"border-card"},{default:C((()=>[y(S,{label:"🔌 GOST插件",name:"plugins"},{default:C((()=>[v("div",N,[a[29]||(a[29]=v("h3",null,"插件超时配置",-1)),a[30]||(a[30]=v("p",{class:"section-desc"},"控制GOST插件的响应超时时间，直接影响转发性能",-1)),y(h,{gutter:20},{default:C((()=>[y(g,{span:8},{default:C((()=>[v("div",R,[a[24]||(a[24]=v("label",null,"认证器超时 (秒)",-1)),y(p,{modelValue:t.configForm.gostPlugins.authTimeout,"onUpdate:modelValue":a[2]||(a[2]=e=>t.configForm.gostPlugins.authTimeout=e),min:1,max:60,size:"small"},null,8,["modelValue"]),v("p",q,V(t.getParamHelp("gostPlugins","authTimeout")),1)])])),_:1}),y(g,{span:8},{default:C((()=>[v("div",K,[a[25]||(a[25]=v("label",null,"观察器超时 (秒)",-1)),y(p,{modelValue:t.configForm.gostPlugins.observerTimeout,"onUpdate:modelValue":a[3]||(a[3]=e=>t.configForm.gostPlugins.observerTimeout=e),min:1,max:60,size:"small"},null,8,["modelValue"]),v("p",J,V(t.getParamHelp("gostPlugins","observerTimeout")),1)])])),_:1})])),_:1}),y(h,{gutter:20,style:{"margin-top":"20px"}},{default:C((()=>[y(g,{span:8},{default:C((()=>[v("div",Q,[a[26]||(a[26]=v("label",null,"观察器周期 (秒)",-1)),y(p,{modelValue:t.observerPeriodSeconds,"onUpdate:modelValue":a[4]||(a[4]=e=>t.observerPeriodSeconds=e),min:5,max:300,size:"small",onChange:t.updateObserverPeriod},null,8,["modelValue","onChange"]),a[27]||(a[27]=v("p",{class:"param-help"},"GOST观察器报告流量统计的周期，影响流量统计的实时性",-1))])])),_:1}),y(g,{span:8},{default:C((()=>[v("div",W,[a[28]||(a[28]=v("label",null,"限制器超时 (秒)",-1)),y(p,{modelValue:t.configForm.gostPlugins.limiterTimeout,"onUpdate:modelValue":a[5]||(a[5]=e=>t.configForm.gostPlugins.limiterTimeout=e),min:1,max:60,size:"small"},null,8,["modelValue"]),v("p",X,V(t.getParamHelp("gostPlugins","limiterTimeout")),1)])])),_:1})])),_:1})])])),_:1}),y(S,{label:"💾 缓存配置",name:"cache"},{default:C((()=>[v("div",Y,[a[35]||(a[35]=v("h3",null,"缓存超时配置",-1)),a[36]||(a[36]=v("p",{class:"section-desc"},"控制各种缓存的生存时间，影响查询性能和实时性",-1)),y(h,{gutter:20},{default:C((()=>[y(g,{span:8},{default:C((()=>[v("div",Z,[a[31]||(a[31]=v("label",null,"认证器缓存 (分钟)",-1)),y(p,{modelValue:t.authCacheMinutes,"onUpdate:modelValue":a[6]||(a[6]=e=>t.authCacheMinutes=e),min:1,max:60,size:"small",onChange:t.updateAuthCacheTimeout},null,8,["modelValue","onChange"]),v("p",ee,V(t.getParamHelp("cacheConfig","authCacheTimeout")),1)])])),_:1}),y(g,{span:8},{default:C((()=>[v("div",ae,[a[32]||(a[32]=v("label",null,"限制器缓存 (分钟)",-1)),y(p,{modelValue:t.limiterCacheMinutes,"onUpdate:modelValue":a[7]||(a[7]=e=>t.limiterCacheMinutes=e),min:.5,max:30,step:.5,size:"small",onChange:t.updateLimiterCacheTimeout},null,8,["modelValue","onChange"]),v("p",le,V(t.getParamHelp("cacheConfig","limiterCacheTimeout")),1)])])),_:1}),y(g,{span:8},{default:C((()=>[v("div",te,[a[33]||(a[33]=v("label",null,"多实例缓存 (分钟)",-1)),y(p,{modelValue:t.multiInstanceCacheMinutes,"onUpdate:modelValue":a[8]||(a[8]=e=>t.multiInstanceCacheMinutes=e),min:.5,max:10,step:.5,size:"small",onChange:t.updateMultiInstanceCacheTTL},null,8,["modelValue","onChange"]),a[34]||(a[34]=v("p",{class:"param-help"},"多实例缓存的生存时间",-1))])])),_:1})])),_:1})])])),_:1}),y(S,{label:"🔄 同步配置",name:"sync"},{default:C((()=>[v("div",se,[a[39]||(a[39]=v("h3",null,"同步频率配置",-1)),a[40]||(a[40]=v("p",{class:"section-desc"},"控制各种自动同步的频率，影响系统响应速度和资源消耗",-1)),y(h,{gutter:20},{default:C((()=>[y(g,{span:12},{default:C((()=>[v("div",ne,[a[37]||(a[37]=v("label",null,"自动同步间隔 (分钟)",-1)),y(p,{modelValue:t.autoSyncMinutes,"onUpdate:modelValue":a[9]||(a[9]=e=>t.autoSyncMinutes=e),min:1,max:60,size:"small",onChange:t.updateAutoSyncInterval},null,8,["modelValue","onChange"]),v("p",oe,V(t.getParamHelp("syncConfig","autoSyncInterval")),1)])])),_:1}),y(g,{span:12},{default:C((()=>[v("div",ie,[a[38]||(a[38]=v("label",null,"健康检查间隔 (分钟)",-1)),y(p,{modelValue:t.healthCheckMinutes,"onUpdate:modelValue":a[10]||(a[10]=e=>t.healthCheckMinutes=e),min:.5,max:10,step:.5,size:"small",onChange:t.updateHealthCheckInterval},null,8,["modelValue","onChange"]),v("p",ce,V(t.getParamHelp("syncConfig","healthCheckInterval")),1)])])),_:1})])),_:1})])])),_:1})])),_:1},8,["modelValue"])])),_:1})),y(d,{class:"status-card",shadow:"hover"},{header:C((()=>[v("div",ue,[a[42]||(a[42]=v("span",null,"📊 系统状态",-1)),y(c,{size:"small",onClick:t.refreshStatus,loading:t.statusLoading},{default:C((()=>a[41]||(a[41]=[M(" 刷新状态 ")]))),_:1,__:[41]},8,["onClick","loading"])])])),default:C((()=>{var e;return[v("div",de,[y(h,{gutter:20},{default:C((()=>[y(g,{span:8},{default:C((()=>{var e;return[v("div",re,[a[43]||(a[43]=v("h4",null,"🎛️ 运行模式",-1)),y(o,{type:(null==(e=t.systemStatus.mode)?void 0:e.isSimpleMode)?"danger":"success"},{default:C((()=>{var e;return[M(V((null==(e=t.systemStatus.mode)?void 0:e.isSimpleMode)?"单机模式":"自动模式"),1)]})),_:1},8,["type"])])]})),_:1}),y(g,{span:8},{default:C((()=>{var e,l;return[v("div",me,[a[44]||(a[44]=v("h4",null,"🚀 GOST服务",-1)),y(o,{type:(null==(l=null==(e=t.systemStatus.services)?void 0:e.gost)?void 0:l.isRunning)?"success":"danger"},{default:C((()=>{var e,a;return[M(V((null==(a=null==(e=t.systemStatus.services)?void 0:e.gost)?void 0:a.isRunning)?"运行中":"已停止"),1)]})),_:1},8,["type"])])]})),_:1}),y(g,{span:8},{default:C((()=>{var e;return[v("div",pe,[a[45]||(a[45]=v("h4",null,"🔧 配置版本",-1)),v("span",null,"v"+V((null==(e=t.systemStatus.config)?void 0:e.configVersion)||0),1)])]})),_:1})])),_:1}),(null==(e=t.systemStatus.config)?void 0:e.lastUpdated)?(P(),f("div",ge,[v("p",null,"最后更新: "+V(t.formatTime(t.systemStatus.config.lastUpdated)),1),v("p",null,"更新者: "+V(t.systemStatus.config.lastUpdatedBy||"未知"),1)])):T("",!0)])]})),_:1})])}],["__scopeId","data-v-2b23941e"]]);export{he as default};
