import{ax as e,ay as a,aB as s,r,X as l,z as o,P as t,H as u,ag as n,y as d,A as i,V as m,u as p,L as c,M as g}from"./vue-55dd3248.js";import{u as f,d as _,E as v}from"./element-plus-0a16f2db.js";import{_ as w}from"./index-75dfb4d4.js";import"./utils-d4f80f06.js";const y={class:"login-container"},b=w({__name:"Login",setup(w){const b=e(),h=a(),x=s(),V=r(null),j=r(!1),q=l({username:"",password:""}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:1,max:20,message:"密码不能为空",trigger:"blur"}]},U=async()=>{if(V.value)try{await V.value.validate(),j.value=!0,await b.dispatch("user/login",q);const e=await b.dispatch("user/getCurrentUser");console.log("Current user:",e),v.success("登录成功");const a=x.query.redirect||("admin"===e.role?"/admin":"/dashboard");h.push(a)}catch(e){console.error("Login error:",e),v.error(e.message||"登录失败")}finally{j.value=!1}};return(e,a)=>{const s=n("el-icon"),r=n("el-input"),l=n("el-form-item"),v=n("el-button"),w=n("el-form"),b=n("el-card");return d(),o("div",y,[t(b,{class:"login-card"},{default:u((()=>[a[2]||(a[2]=i("div",{class:"title"},"GOST 管理系统",-1)),t(w,{model:q,rules:L,ref_key:"loginFormRef",ref:V,class:"login-form",onSubmit:m(U,["prevent"])},{default:u((()=>[t(l,{prop:"username"},{default:u((()=>[t(r,{modelValue:q.username,"onUpdate:modelValue":a[0]||(a[0]=e=>q.username=e),placeholder:"请输入用户名"},{prefix:u((()=>[t(s,null,{default:u((()=>[t(p(f))])),_:1})])),_:1},8,["modelValue"])])),_:1}),t(l,{prop:"password"},{default:u((()=>[t(r,{modelValue:q.password,"onUpdate:modelValue":a[1]||(a[1]=e=>q.password=e),type:"password",placeholder:"请输入密码","show-password":""},{prefix:u((()=>[t(s,null,{default:u((()=>[t(p(_))])),_:1})])),_:1},8,["modelValue"])])),_:1}),t(l,null,{default:u((()=>[t(v,{type:"primary",loading:j.value,"native-type":"submit",class:"login-button"},{default:u((()=>[c(g(j.value?"登录中...":"登录"),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1,__:[2]})])}}},[["__scopeId","data-v-d4f89640"]]);export{b as default};
