var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,n=(e,l)=>{for(var t in l||(l={}))r.call(l,t)&&o(e,t,l[t]);if(a)for(var t of a(l))s.call(l,t)&&o(e,t,l[t]);return e},d=(e,a)=>l(e,t(a)),i=(e,l,t)=>new Promise(((a,r)=>{var s=e=>{try{n(t.next(e))}catch(l){r(l)}},o=e=>{try{n(t.throw(e))}catch(l){r(l)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,o);n((t=t.apply(e,l)).next())}));import{_ as u,B as c,G as p,x as v,H as f,b as g,u as m,r as h,m as y,c as P,I as b,n as w,d as _,g as R,t as A,e as k,w as I,q as C,s as S,F as x,D as E,E as T,C as $,f as U,v as V,o as F,k as j,z as D,y as B}from"./index-6147da2c.js";import{n as O,a as q,p as z}from"./api-c772489f.js";const G={class:"user-forward-rules"},L={class:"header"},N={class:"header-actions"},W={class:"user-info"},M={class:"info-item"},H={class:"value"},J={class:"info-item"},K={class:"value"},Z={key:0,class:"info-item"},Q={class:"value additional-ports"},X={key:1,class:"info-item"},Y={key:2},ee={class:"group-header"},le={class:"group-info"},te={key:0,class:"additional-ports-tag"},ae={key:1,class:"expired-tag"},re={class:"rule-status"},se={key:0,class:"traffic-stats"},oe={class:"traffic-value"},ne={key:1,class:"text-muted"},de={key:3},ie={class:"rule-status"},ue={key:0,class:"traffic-stats"},ce={class:"traffic-value"},pe={key:1,class:"text-muted"},ve={key:0,class:"disabled-hint"},fe={key:0,class:"form-tip"},ge={key:1,class:"form-tip"},me={key:0},he={key:1},ye={key:2},Pe={key:0,class:"form-tip info-tip"},be={key:1,class:"form-tip success-tip"},we={key:0,class:"form-tip warning-tip"};const _e=u({name:"UserForwardRules",components:{Plus:c,Delete:p,Refresh:v,InfoFilled:f},setup(){const e=g(),l=m(),t=h(!1),a=h(!1),r=h([]),s=h([]),o=h([]),u=h(!1),c=h(null),p=h(null),v=h(null),f=h({ipv6Supported:!1,recommendedIPv4:"127.0.0.1",recommendedIPv6:"::1",supportedListenModes:["ipv4"]}),_=h([]),R=y((()=>l.getters["user/currentUser"])),A=y((()=>l.getters["user/isAdmin"])),k=y((()=>{var l;return A.value?e.query.userId:null==(l=R.value)?void 0:l.id})),I=y((()=>A.value&&!e.query.userId)),C=y((()=>{var l;return A.value&&e.query.userId?`规则管理 - ${(null==(l=p.value)?void 0:l.username)||"用户"}`:I.value?"规则管理 - 所有用户":"规则管理"})),S=y((()=>{var e,l,t,a,r;if(I.value)return{start:1,end:65535,additionalPorts:[],allPorts:[]};const s=G(null==(e=p.value)?void 0:e.additionalPorts),o=[];if((null==(l=p.value)?void 0:l.portRangeStart)&&(null==(t=p.value)?void 0:t.portRangeEnd))for(let d=p.value.portRangeStart;d<=p.value.portRangeEnd;d++)o.push(d);s&&s.length>0&&o.push(...s);const n=[...new Set(o)].sort(((e,l)=>e-l));return{start:(null==(a=p.value)?void 0:a.portRangeStart)||1,end:(null==(r=p.value)?void 0:r.portRangeEnd)||65535,additionalPorts:s,allPorts:n}})),x=P({name:"",sourcePort:null,targetAddress:"",protocol:"tcp",description:"",listenAddressType:"ipv4",listenAddress:""}),E=y((()=>{var e;return!A.value&&((null==(e=p.value)?void 0:e.isExpired)||!1)})),U=()=>i(this,null,(function*(){try{const e=yield O.getNetworkInfo();e.data.success&&(f.value=e.data.data)}catch(e){T.warning("获取网络配置失败，将使用默认配置")}})),V=()=>i(this,null,(function*(){try{const e=yield q.get("/system-config/disabledProtocols");e.data.success&&e.data.data&&(_.value=e.data.data.value||[])}catch(e){_.value=[]}})),F=e=>{if(!e)return!1;const l=e.includes("[")?e.split("]:")[0]+"]":e.split(":")[0];return j(l)},j=e=>{const l=e.replace(/[\\[\\]]/g,"");if(/^(\d{1,3}\.){3}\d{1,3}$/.test(l)){const e=l.split(".").map(Number);return 10===e[0]||172===e[0]&&e[1]>=16&&e[1]<=31||192===e[0]&&168===e[1]||127===e[0]||"localhost"===l}return l.includes(":")?"::1"===l||l.startsWith("fc")||l.startsWith("fd"):"localhost"===l},D={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:1,max:100,message:"规则名称长度在 1 到 100 个字符",trigger:"blur"}],sourcePort:[{required:!0,message:"请输入源端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围在 1-65535",trigger:"blur"},{validator:(e,l,t)=>{if(!l)return void t(new Error("请输入源端口"));if(A.value)return void t();const a=S.value.allPorts;if(a.length>0&&!a.includes(l)){let e="端口不在允许范围内",l=[];return S.value.start&&S.value.end&&l.push(`可用范围: ${S.value.start}-${S.value.end}`),S.value.additionalPorts.length>0&&l.push(`可用额外端口: ${S.value.additionalPorts.join(", ")}`),l.length>0&&(e+=`。${l.join("，")}`),void t(new Error(e))}t()},trigger:"blur"}],targetAddress:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(e,l,t)=>{if(!l)return void t(new Error("请输入目标地址"));/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/.test(l)||/^\[([0-9a-fA-F:]+)\]:\d{1,5}$/.test(l)||/^[a-zA-Z0-9.-]+:\d{1,5}$/.test(l)?t():t(new Error("请输入正确的地址格式"))},trigger:"blur"},{validator:(e,l,t)=>i(this,null,(function*(){if(l)if(A.value||!F(l))try{const e=yield z.validateTarget({targetAddress:l,userRole:A.value?"admin":"user"});if(e.data.success&&!e.data.data.valid){const l=e.data.data.errors||[];let a="目标地址不符合要求";return l.length>0&&(1===l.length?a=l[0]:a+="："+l.join("；")),void t(new Error(a))}t()}catch(e){t()}else t(new Error("不允许使用本地地址"));else t()})),trigger:"blur"}],protocol:[{required:!0,message:"请选择协议",trigger:"change"}]},B=()=>i(this,null,(function*(){var e,l;t.value=!0;try{const e=k.value?{userId:k.value}:{},l=yield q.get("/user-forward-rules",{params:e});I.value?(o.value=(l.data.groupedRules||[]).map((e=>d(n({},e),{rules:e.rules.map((e=>d(n({},e),{switching:!1})))}))),o.value.forEach((e=>{})),r.value=[]):(r.value=(l.data.rules||[]).map((e=>d(n({},e),{switching:!1}))),p.value=l.data.user,o.value=[]),l.data.cleanedCount>0&&T.warning(`清理了 ${l.data.cleanedCount} 个重复端口规则`)}catch(a){T.error("获取规则列表失败: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message))}finally{t.value=!1}})),G=e=>{if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e)try{const l=JSON.parse(e);return Array.isArray(l)?l:[]}catch(l){return[]}return[]};return b((()=>e.query.userId),(()=>{B()})),w((()=>i(this,null,(function*(){yield U(),yield V(),yield B(),p.value,o.value.length>0&&o.value.forEach((e=>{}))})))),{loading:t,saving:a,rules:r,selectedRules:s,groupedRules:o,showCreateDialog:u,editingRule:c,userInfo:p,userExpired:E,isAdmin:A,showGroupedView:I,pageTitle:C,currentUserPortRange:S,ruleForm:x,ruleRules:D,ruleFormRef:v,networkInfo:f,loadRules:B,saveRule:()=>i(this,null,(function*(){var e,l;if(v.value){try{yield v.value.validate()}catch(t){return}if(_.value.includes(x.protocol))T.error(`无法创建规则：协议 ${x.protocol.toUpperCase()} 已被管理员禁用`);else{a.value=!0;try{const e=n({},x);A.value&&k.value&&(e.userId=k.value),c.value?(yield q.put(`/user-forward-rules/${c.value.id}`,e),T.success("规则更新成功")):(yield q.post("/user-forward-rules",e),T.success("规则创建成功")),u.value=!1,yield B()}catch(r){T.error("保存规则失败: "+((null==(l=null==(e=r.response)?void 0:e.data)?void 0:l.message)||r.message))}finally{a.value=!1}}}})),editRule:e=>{c.value=e,Object.assign(x,{name:e.name,sourcePort:e.sourcePort,targetAddress:e.targetAddress,protocol:e.protocol,description:e.description||"",listenAddressType:e.listenAddressType||"ipv4",listenAddress:e.listenAddress||("ipv6"===e.listenAddressType?"::1":"127.0.0.1")}),u.value=!0},deleteRule:e=>i(this,null,(function*(){var l,t;try{yield $.confirm(`确定要删除规则 "${e.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield q.delete(`/user-forward-rules/${e.id}`),T.success("规则删除成功"),yield B()}catch(a){"cancel"!==a&&T.error("删除规则失败: "+((null==(t=null==(l=a.response)?void 0:l.data)?void 0:t.message)||a.message))}})),batchDelete:()=>i(this,null,(function*(){var e,l;if(0!==s.value.length)try{yield $.confirm(`确定要删除选中的 ${s.value.length} 个规则吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=s.value.map((e=>e.id));yield q.post("/user-forward-rules/batch-delete",{ids:e}),T.success("批量删除成功"),yield B()}catch(t){"cancel"!==t&&T.error("批量删除失败: "+((null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.message)||t.message))}})),handleSelectionChange:e=>{s.value=e},handleGroupSelectionChange:(e,l)=>{s.value=[...s.value.filter((e=>e.userId!==l)),...e]},resetForm:()=>{c.value=null;let e="tcp";_.value.includes("tcp")&&(_.value.includes("udp")?_.value.includes("tls")||(e="tls"):e="udp"),Object.assign(x,{name:"",sourcePort:null,targetAddress:"",protocol:e,description:"",listenAddressType:"ipv4",listenAddress:f.value.recommendedIPv4||"127.0.0.1"}),v.value&&v.value.clearValidate()},getProtocolType:e=>({tcp:"primary",udp:"success",tls:"warning"}[e]||"info"),formatTraffic:e=>{if(!e||0===e)return"0B";const l=["B","KB","MB","GB","TB"];let t=e,a=0;for(;t>=1024&&a<l.length-1;)t/=1024,a++;return`${t.toFixed(0===a?0:1)}${l[a]}`},getRuleStatusReason:(e,l)=>{var t,a,r,s,o,n,d;if(e.isActive)return"规则已激活，正在转发流量";const i=[];if(_.value.includes(e.protocol)&&i.push(`协议 ${e.protocol.toUpperCase()} 已被管理员禁用`),((null==l?void 0:l.isExpired)||E.value)&&i.push("用户已过期"),"suspended"!==(null==l?void 0:l.userStatus)&&"suspended"!==(null==(t=p.value)?void 0:t.userStatus)||i.push("用户已被暂停"),!1!==(null==l?void 0:l.isActive)&&!1!==(null==(a=p.value)?void 0:a.isActive)||i.push("用户已被禁用"),((null==l?void 0:l.usagePercent)>100||(null==(r=p.value)?void 0:r.usagePercent)>100)&&i.push("用户流量配额已超限"),e.sourcePort){let t=!1,a=[];l?a=Array.isArray(l.additionalPorts)?l.additionalPorts:[]:p.value&&(a=Array.isArray(p.value.additionalPorts)?p.value.additionalPorts:[]),(null==l?void 0:l.portRangeStart)&&(null==l?void 0:l.portRangeEnd)?t=e.sourcePort>=l.portRangeStart&&e.sourcePort<=l.portRangeEnd:(null==(s=p.value)?void 0:s.portRangeStart)&&(null==(o=p.value)?void 0:o.portRangeEnd)&&(t=e.sourcePort>=p.value.portRangeStart&&e.sourcePort<=p.value.portRangeEnd);const r=a.includes(e.sourcePort);if(!t&&!r){let t="";(null==l?void 0:l.portRangeStart)&&(null==l?void 0:l.portRangeEnd)?t=`${l.portRangeStart}-${l.portRangeEnd}`:(null==(n=p.value)?void 0:n.portRangeStart)&&(null==(d=p.value)?void 0:d.portRangeEnd)&&(t=`${p.value.portRangeStart}-${p.value.portRangeEnd}`);let r=`端口 ${e.sourcePort} 超出允许范围`;t&&(r+=` (${t})`),a.length>0&&(r+=` 且不在额外端口列表中 (${a.join(", ")})`),i.push(r)}}return i.length>0?`规则已禁用：${i.join("、")}`:"规则已禁用（系统自动判断）"},loadNetworkInfo:U,onListenAddressTypeChange:e=>{if("ipv6"===e){if(!f.value.ipv6Supported)return T.warning("系统不支持IPv6，已切换回IPv4"),void(x.listenAddressType="ipv4");x.listenAddress=f.value.recommendedIPv6||"::1"}else x.listenAddress=f.value.recommendedIPv4||"127.0.0.1"},parseAdditionalPorts:G,isPrivateTargetAddress:F,disabledProtocols:_}}},[["render",function(e,l,t,a,r,s){const o=U("Plus"),n=U("el-icon"),d=U("el-button"),i=U("Delete"),u=U("Refresh"),c=U("el-tag"),p=U("el-card"),v=U("el-alert"),f=U("el-table-column"),g=U("InfoFilled"),m=U("el-tooltip"),h=U("el-table"),y=U("el-input"),P=U("el-form-item"),b=U("el-radio"),w=U("el-radio-group"),T=U("el-input-number"),$=U("el-option"),O=U("el-select"),q=U("el-form"),z=U("el-dialog"),_e=V("loading");return F(),_("div",G,[R("div",L,[R("h2",null,A(a.pageTitle),1),R("div",N,[k(d,{type:"primary",onClick:l[0]||(l[0]=e=>a.showCreateDialog=!0),disabled:a.userExpired},{default:I((()=>[k(n,null,{default:I((()=>[k(o)])),_:1}),l[9]||(l[9]=j(" 添加规则 "))])),_:1,__:[9]},8,["disabled"]),k(d,{type:"danger",onClick:a.batchDelete,disabled:0===a.selectedRules.length},{default:I((()=>[k(n,null,{default:I((()=>[k(i)])),_:1}),l[10]||(l[10]=j(" 批量删除 "))])),_:1,__:[10]},8,["onClick","disabled"]),k(d,{onClick:a.loadRules},{default:I((()=>[k(n,null,{default:I((()=>[k(u)])),_:1}),l[11]||(l[11]=j(" 刷新 "))])),_:1,__:[11]},8,["onClick"])])]),a.userInfo&&!a.showGroupedView?(F(),C(p,{key:0,class:"user-info-card"},{default:I((()=>[R("div",W,[R("div",M,[l[12]||(l[12]=R("span",{class:"label"},"用户名:",-1)),R("span",H,A(a.userInfo.username),1)]),R("div",J,[l[13]||(l[13]=R("span",{class:"label"},"端口范围:",-1)),R("span",K,A(a.userInfo.portRangeStart&&a.userInfo.portRangeEnd?`${a.userInfo.portRangeStart}-${a.userInfo.portRangeEnd}`:"未设置"),1)]),a.userInfo.additionalPorts&&a.parseAdditionalPorts(a.userInfo.additionalPorts).length>0?(F(),_("div",Z,[l[14]||(l[14]=R("span",{class:"label"},"额外端口:",-1)),R("span",Q,A(a.parseAdditionalPorts(a.userInfo.additionalPorts).join(", ")),1)])):S("",!0),a.isAdmin?S("",!0):(F(),_("div",X,[l[16]||(l[16]=R("span",{class:"label"},"过期时间:",-1)),R("span",{class:D(["value",{expired:a.userInfo.isExpired}])},[j(A(a.userInfo.expiryDate?new Date(a.userInfo.expiryDate).toLocaleDateString():"永不过期")+" ",1),a.userInfo.isExpired?(F(),C(c,{key:0,type:"danger",size:"small"},{default:I((()=>l[15]||(l[15]=[j("已过期")]))),_:1,__:[15]})):S("",!0)],2)]))])])),_:1})):S("",!0),a.userExpired?(F(),C(v,{key:1,title:"用户已过期",type:"warning",description:"您的账户已过期，无法创建或修改转发规则。请联系管理员续期。","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}})):S("",!0),a.showGroupedView?(F(),_("div",Y,[(F(!0),_(x,null,E(a.groupedRules,(e=>(F(),_("div",{key:e.userId,class:"user-group"},[R("div",ee,[R("h3",null,A(e.username)+" ("+A(e.rules.length)+"个规则)",1),R("div",le,[R("span",null,"端口范围: "+A(e.portRange),1),e.additionalPorts&&a.parseAdditionalPorts(e.additionalPorts).length>0?(F(),_("span",te," 额外端口: "+A(a.parseAdditionalPorts(e.additionalPorts).join(", ")),1)):S("",!0),e.isExpired?(F(),_("span",ae,"已过期")):S("",!0)])]),B((F(),C(h,{data:e.rules,onSelectionChange:l=>a.handleGroupSelectionChange(l,e.userId),style:{width:"100%","margin-bottom":"20px"},stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"}},{default:I((()=>[k(f,{type:"selection",width:"55"}),k(f,{prop:"name",label:"规则名称","min-width":"120"}),k(f,{prop:"sourcePort",label:"源端口",width:"100"}),k(f,{prop:"targetAddress",label:"目标地址","min-width":"180"}),k(f,{prop:"protocol",label:"协议",width:"80"},{default:I((({row:e})=>[k(c,{type:a.getProtocolType(e.protocol)},{default:I((()=>[j(A(e.protocol.toUpperCase()),1)])),_:2},1032,["type"])])),_:1}),k(f,{prop:"isActive",label:"状态",width:"120"},{default:I((({row:l})=>[R("div",re,[k(c,{type:l.isActive?"success":"info",size:"small"},{default:I((()=>[j(A(l.isActive?"已激活":"已禁用"),1)])),_:2},1032,["type"]),k(m,{content:a.getRuleStatusReason(l,e),placement:"top",effect:"dark"},{default:I((()=>[k(n,{class:"status-info"},{default:I((()=>[k(g)])),_:1})])),_:2},1032,["content"])])])),_:2},1024),k(f,{label:"流量统计",width:"120"},{default:I((({row:e})=>[e.trafficStats?(F(),_("div",se,[R("div",oe,[k(m,{content:"总流量统计",placement:"top"},{default:I((()=>[R("span",null,A(a.formatTraffic(e.trafficStats.totalBytes||0)),1)])),_:2},1024)])])):(F(),_("span",ne,"无数据"))])),_:1}),k(f,{prop:"createdAt",label:"创建时间",width:"160"},{default:I((({row:e})=>[j(A(new Date(e.createdAt).toLocaleString()),1)])),_:1}),k(f,{label:"操作",width:"150",fixed:"right"},{default:I((({row:t})=>[k(d,{type:"primary",size:"small",onClick:e=>a.editRule(t),disabled:e.isExpired},{default:I((()=>l[17]||(l[17]=[j(" 编辑 ")]))),_:2,__:[17]},1032,["onClick","disabled"]),k(d,{type:"danger",size:"small",onClick:e=>a.deleteRule(t)},{default:I((()=>l[18]||(l[18]=[j(" 删除 ")]))),_:2,__:[18]},1032,["onClick"])])),_:2},1024)])),_:2},1032,["data","onSelectionChange"])),[[_e,a.loading]])])))),128))])):(F(),_("div",de,[k(p,{class:"table-card"},{default:I((()=>[B((F(),C(h,{data:a.rules,onSelectionChange:a.handleSelectionChange,style:{width:"100%"},stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"}},{default:I((()=>[k(f,{type:"selection",width:"55"}),k(f,{prop:"name",label:"规则名称","min-width":"120"}),k(f,{prop:"sourcePort",label:"源端口",width:"100"}),k(f,{prop:"targetAddress",label:"目标地址","min-width":"180"}),k(f,{prop:"protocol",label:"协议",width:"80"},{default:I((({row:e})=>[k(c,{type:a.getProtocolType(e.protocol)},{default:I((()=>[j(A(e.protocol.toUpperCase()),1)])),_:2},1032,["type"])])),_:1}),k(f,{prop:"isActive",label:"状态",width:"120"},{default:I((({row:e})=>[R("div",ie,[k(c,{type:e.isActive?"success":"info",size:"small"},{default:I((()=>[j(A(e.isActive?"已激活":"已禁用"),1)])),_:2},1032,["type"]),k(m,{content:a.getRuleStatusReason(e,{isExpired:a.userExpired}),placement:"top",effect:"dark"},{default:I((()=>[k(n,{class:"status-info"},{default:I((()=>[k(g)])),_:1})])),_:2},1032,["content"])])])),_:1}),k(f,{label:"流量统计",width:"120"},{default:I((({row:e})=>[e.trafficStats?(F(),_("div",ue,[R("div",ce,[k(m,{content:"总流量统计",placement:"top"},{default:I((()=>[R("span",null,A(a.formatTraffic(e.trafficStats.totalBytes||0)),1)])),_:2},1024)])])):(F(),_("span",pe,"无数据"))])),_:1}),k(f,{prop:"createdAt",label:"创建时间",width:"160"},{default:I((({row:e})=>[j(A(new Date(e.createdAt).toLocaleString()),1)])),_:1}),k(f,{label:"操作",width:"150",fixed:"right"},{default:I((({row:e})=>[k(d,{type:"primary",size:"small",onClick:l=>a.editRule(e),disabled:a.userExpired&&!a.isAdmin},{default:I((()=>l[19]||(l[19]=[j(" 编辑 ")]))),_:2,__:[19]},1032,["onClick","disabled"]),k(d,{type:"danger",size:"small",onClick:l=>a.deleteRule(e)},{default:I((()=>l[20]||(l[20]=[j(" 删除 ")]))),_:2,__:[20]},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[_e,a.loading]])])),_:1})])),k(z,{title:a.editingRule?"编辑规则":"创建规则",modelValue:a.showCreateDialog,"onUpdate:modelValue":l[8]||(l[8]=e=>a.showCreateDialog=e),width:"700px",onClose:a.resetForm,class:"rule-dialog"},{footer:I((()=>[k(d,{onClick:l[7]||(l[7]=e=>a.showCreateDialog=!1)},{default:I((()=>l[24]||(l[24]=[j("取消")]))),_:1,__:[24]}),k(d,{type:"primary",onClick:a.saveRule,loading:a.saving},{default:I((()=>[j(A(a.editingRule?"更新":"创建"),1)])),_:1},8,["onClick","loading"])])),default:I((()=>[k(q,{ref:"ruleFormRef",model:a.ruleForm,rules:a.ruleRules,"label-width":"120px"},{default:I((()=>[k(P,{label:"规则名称",prop:"name"},{default:I((()=>[k(y,{modelValue:a.ruleForm.name,"onUpdate:modelValue":l[1]||(l[1]=e=>a.ruleForm.name=e),placeholder:"请输入规则名称"},null,8,["modelValue"])])),_:1}),k(P,{label:"监听地址",prop:"listenAddressType"},{default:I((()=>[k(w,{modelValue:a.ruleForm.listenAddressType,"onUpdate:modelValue":l[2]||(l[2]=e=>a.ruleForm.listenAddressType=e),onChange:a.onListenAddressTypeChange},{default:I((()=>[k(b,{label:"ipv4"},{default:I((()=>[j("IPv4 ("+A(a.networkInfo.recommendedIPv4||"127.0.0.1")+")",1)])),_:1}),k(b,{label:"ipv6",disabled:!a.networkInfo.ipv6Supported},{default:I((()=>[j(" IPv6 ("+A(a.networkInfo.recommendedIPv6||"::1")+") ",1),a.networkInfo.ipv6Supported?S("",!0):(F(),_("span",ve,"系统不支持"))])),_:1},8,["disabled"])])),_:1},8,["modelValue","onChange"]),l[21]||(l[21]=R("div",{class:"form-tip"}," 选择规则监听的网络协议类型。IPv4适用于大多数情况，IPv6需要系统支持。 ",-1))])),_:1,__:[21]}),k(P,{label:"源端口",prop:"sourcePort"},{default:I((()=>[k(T,{modelValue:a.ruleForm.sourcePort,"onUpdate:modelValue":l[3]||(l[3]=e=>a.ruleForm.sourcePort=e),min:1,max:65535,placeholder:"请输入源端口",style:{width:"100%"}},null,8,["modelValue"]),a.isAdmin?(F(),_("div",fe," 管理员权限：可使用任意端口 (1-65535) ")):(F(),_("div",ge,[a.currentUserPortRange.start&&a.currentUserPortRange.end?(F(),_("div",me," 端口范围: "+A(a.currentUserPortRange.start)+"-"+A(a.currentUserPortRange.end),1)):S("",!0),a.currentUserPortRange.additionalPorts&&a.currentUserPortRange.additionalPorts.length>0?(F(),_("div",he," 额外端口: "+A(a.currentUserPortRange.additionalPorts.join(", ")),1)):S("",!0),a.currentUserPortRange.allPorts&&a.currentUserPortRange.allPorts.length>0?(F(),_("div",ye," 总计可用端口: "+A(a.currentUserPortRange.allPorts.length)+" 个 ",1)):S("",!0)]))])),_:1}),k(P,{label:"目标地址",prop:"targetAddress"},{default:I((()=>[k(y,{modelValue:a.ruleForm.targetAddress,"onUpdate:modelValue":l[4]||(l[4]=e=>a.ruleForm.targetAddress=e),placeholder:"例如: 8.8.8.8:80 或 example.com:80"},null,8,["modelValue"]),l[23]||(l[23]=R("div",{class:"form-tip"}," 支持 IPv4:端口、[IPv6]:端口 或 域名:端口 格式 ",-1)),a.isAdmin?S("",!0):(F(),_("div",Pe,l[22]||(l[22]=[R("i",{class:"el-icon-info"},null,-1),j(" 提示：请使用公网IPv4地址，如 8.8.8.8、1.1.1.1 等（不允许使用本地地址） ")]))),a.isAdmin?(F(),_("div",be," 管理员权限：可以转发任何地址 ")):S("",!0)])),_:1,__:[23]}),k(P,{label:"协议",prop:"protocol"},{default:I((()=>[k(O,{modelValue:a.ruleForm.protocol,"onUpdate:modelValue":l[5]||(l[5]=e=>a.ruleForm.protocol=e),style:{width:"100%"}},{default:I((()=>[k($,{label:"TCP",value:"tcp",disabled:a.disabledProtocols.includes("tcp")},null,8,["disabled"]),k($,{label:"UDP",value:"udp",disabled:a.disabledProtocols.includes("udp")},null,8,["disabled"]),k($,{label:"TLS",value:"tls",disabled:a.disabledProtocols.includes("tls")},null,8,["disabled"])])),_:1},8,["modelValue"]),a.disabledProtocols.length>0?(F(),_("div",we," 注意：管理员已禁用以下协议："+A(a.disabledProtocols.join(", ").toUpperCase()),1)):S("",!0)])),_:1}),k(P,{label:"描述",prop:"description"},{default:I((()=>[k(y,{modelValue:a.ruleForm.description,"onUpdate:modelValue":l[6]||(l[6]=e=>a.ruleForm.description=e),type:"textarea",rows:3,placeholder:"请输入规则描述（可选）"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue","onClose"])])}],["__scopeId","data-v-688ba46c"]]);export{_e as default};
