import{ax as e,ay as a,aB as s,r,X as l,z as t,P as o,H as u,ag as d,y as i,A as n,V as m,u as p,L as c,M as g}from"./vue-9e38bd25.js";import{u as f,d as _,E as v}from"./element-plus-a98c71bf.js";import{_ as w}from"./index-1003864c.js";import"./utils-c29d00eb.js";const y={class:"login-container"},b=w({__name:"Login",setup(w){const b=e(),h=a(),x=s(),V=r(null),j=r(!1),q=l({username:"",password:""}),U={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:1,max:20,message:"密码不能为空",trigger:"blur"}]},L=async()=>{if(V.value)try{await V.value.validate(),j.value=!0,await b.dispatch("user/login",q);const e=await b.dispatch("user/getCurrentUser");v.success("登录成功");const a=x.query.redirect||("admin"===e.role?"/admin":"/dashboard");h.push(a)}catch(e){v.error(e.message||"登录失败")}finally{j.value=!1}};return(e,a)=>{const s=d("el-icon"),r=d("el-input"),l=d("el-form-item"),v=d("el-button"),w=d("el-form"),b=d("el-card");return i(),t("div",y,[o(b,{class:"login-card"},{default:u((()=>[a[2]||(a[2]=n("div",{class:"title"},"GOST 管理系统",-1)),o(w,{model:q,rules:U,ref_key:"loginFormRef",ref:V,class:"login-form",onSubmit:m(L,["prevent"])},{default:u((()=>[o(l,{prop:"username"},{default:u((()=>[o(r,{modelValue:q.username,"onUpdate:modelValue":a[0]||(a[0]=e=>q.username=e),placeholder:"请输入用户名"},{prefix:u((()=>[o(s,null,{default:u((()=>[o(p(f))])),_:1})])),_:1},8,["modelValue"])])),_:1}),o(l,{prop:"password"},{default:u((()=>[o(r,{modelValue:q.password,"onUpdate:modelValue":a[1]||(a[1]=e=>q.password=e),type:"password",placeholder:"请输入密码","show-password":""},{prefix:u((()=>[o(s,null,{default:u((()=>[o(p(_))])),_:1})])),_:1},8,["modelValue"])])),_:1}),o(l,null,{default:u((()=>[o(v,{type:"primary",loading:j.value,"native-type":"submit",class:"login-button"},{default:u((()=>[c(g(j.value?"登录中...":"登录"),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1,__:[2]})])}}},[["__scopeId","data-v-d4f89640"]]);export{b as default};
