var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&i(e,l,a[l]);return e},n=(e,a,l)=>new Promise(((t,r)=>{var s=e=>{try{o(l.next(e))}catch(a){r(a)}},i=e=>{try{o(l.throw(e))}catch(a){r(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,i);o((l=l.apply(e,a)).next())}));import{_ as d,B as u,a as f,u as c,r as m,m as p,c as g,n as v,d as y,g as w,q as h,w as _,s as b,y as x,e as V,E as P,p as k,C as R,f as U,v as C,o as E,k as T,t as S,z as D,F as A,D as B}from"./index-5e784131.js";import{a as G}from"./api-88fce923.js";const Q={class:"user-management"},M={class:"page-header"},$={class:"table-container"},j={key:0,class:"text-muted"},O={key:1},F={key:0,class:"port-range"},z={key:1,class:"additional-ports"},Y={key:2,class:"text-muted"},q={key:0},I={key:1,class:"text-muted"},H={key:0},N={class:"traffic-usage"},L={class:"used"},J={class:"quota"},K={class:"remaining"},W={class:"traffic-type"},X={key:1,class:"text-muted"},Z={key:1,class:"text-muted"},ee={key:0,class:"form-tip"},ae={style:{display:"flex",gap:"10px","align-items":"center"}},le={key:0,class:"conflict-message"},te={key:0,class:"form-tip"},re={class:"reset-traffic-content"},se={class:"user-info"},ie={class:"traffic-info"},oe={class:"rules-info"};const ne=d({name:"UserManagement",components:{Plus:u},setup(){const e=f(),t=c(),r=m(!1),s=m(!1),i=m(!1),d=m(!1),u=m([]),y=m(!1),w=m(!1),h=m(!1),_=m(!1),b=m(null),x=m(null),V=m(1),U=m(""),C=m(null),E=m(""),T=m(!1),S=p((()=>t.getters["user/currentUser"])),D=p((()=>t.getters["user/isAdmin"])),A=p((()=>D.value?u.value:u.value.filter((e=>{var a;return e.id===(null==(a=S.value)?void 0:a.id)})))),B=g({username:"",email:"",password:"",newPassword:"",role:"user",portRangeStart:null,portRangeEnd:null,additionalPorts:[],expiryDate:null,trafficQuota:100,isActive:!0}),Q=p((()=>_.value?"编辑用户":"添加用户")),M=e=>{var a;return!!D.value||e.id===(null==(a=S.value)?void 0:a.id)},$=p((()=>{const e={username:[{required:!0,message:"请输入用户名",trigger:["blur","change"]},{min:3,max:30,message:"用户名长度在 3 到 30 个字符",trigger:["blur","change"]}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]};return _.value||(e.password=[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}]),"user"===B.role&&(e.portRange=[{validator:(e,a,l)=>{B.portRangeStart&&B.portRangeEnd?B.portRangeStart>=B.portRangeEnd?l(new Error("起始端口必须小于结束端口")):l():l(new Error("请设置端口范围"))},trigger:["blur","change"]}],e.trafficQuota=[{required:!0,message:"请设置流量限额",trigger:"blur"},{type:"number",min:.001,max:10240,message:"流量限额范围在 0.001-10240 GB",trigger:"blur"}]),e}));let j=null;const O=()=>{j&&clearTimeout(j),j=setTimeout((()=>{F()}),500)},F=()=>n(this,null,(function*(){if(!B.portRangeStart||!B.portRangeEnd||"user"!==B.role)return E.value="",void(T.value=!1);if(B.portRangeStart>=B.portRangeEnd)return E.value="起始端口必须小于结束端口",void(T.value=!0);try{const e=_.value?b.value.id:null,a=yield G.post("/users/check-port-conflicts",{portRangeStart:B.portRangeStart,portRangeEnd:B.portRangeEnd,excludeUserId:e});if(a.data.hasConflict){const e=a.data.conflicts.map((e=>"user_range"===e.type?`与用户 "${e.username}" 的端口范围 ${e.portRange} 重叠`:"used_port"===e.type?`端口 ${e.port} 已被用户 "${e.username}" 的规则占用`:e.message));E.value=`端口配置冲突：${e.join("；")}`,T.value=!0}else E.value="",T.value=!1}catch(e){E.value="",T.value=!1}})),z=()=>n(this,null,(function*(){var e,t;r.value=!0;try{const e=yield G.users.getUsers();u.value=e.data.map((e=>{const t=(e.usedTraffic/1073741824).toFixed(2),r=e.trafficQuota||0,s=r>0?Math.min(e.usedTraffic/(1024*r*1024*1024)*100,100):0,i=r>0?Math.max(r-parseFloat(t),0).toFixed(2)+"GB":"Unlimited";return n=o({},e),d={trafficStats:{usedTrafficGB:parseFloat(t),trafficQuotaGB:r,usagePercent:Math.round(s),remainingGB:i}},a(n,l(d));var n,d}))}catch(s){P.error("获取用户列表失败: "+((null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||s.message))}finally{r.value=!1}})),Y=e=>{if(!e||!e.additionalPorts)return[];if(Array.isArray(e.additionalPorts))return e.additionalPorts;if("string"==typeof e.additionalPorts)try{const a=JSON.parse(e.additionalPorts);return Array.isArray(a)?a:[]}catch(a){return[]}return[]};return v((()=>{z()})),{loading:r,submitting:s,extending:i,resettingTraffic:d,users:u,displayUsers:A,dialogVisible:y,extendDialogVisible:w,resetTrafficDialogVisible:h,isEdit:_,isAdmin:D,currentUser:b,resetTrafficUser:x,extendMonths:V,resetTrafficReason:U,form:B,rules:$,formRef:C,dialogTitle:Q,portConflictMessage:E,hasPortConflict:T,canEditUser:M,loadUsers:z,handleAdd:()=>{D.value?(_.value=!1,y.value=!0):P.error("没有权限添加用户")},handleEdit:e=>{M(e)?(_.value=!0,b.value=e,Object.assign(B,{username:e.username,email:e.email,password:"",newPassword:"",role:e.role,portRangeStart:e.portRangeStart,portRangeEnd:e.portRangeEnd,additionalPorts:Y(e),expiryDate:e.expiryDate,trafficQuota:e.trafficQuota||1,isActive:e.isActive}),E.value="",T.value=!1,y.value=!0,k((()=>{C.value&&(C.value.clearValidate(),setTimeout((()=>{B.username&&C.value.validateField("username"),"user"===B.role&&B.portRangeStart&&B.portRangeEnd&&(C.value.validateField("portRange"),O()),"user"===B.role&&B.trafficQuota&&C.value.validateField("trafficQuota")}),100))}))):P.error("没有权限编辑此用户")},handleSubmit:()=>n(this,null,(function*(){var e,a,l,t,r,i,n;if(C.value){try{yield C.value.validate()}catch(d){return}if(T.value)P.error("存在端口冲突，请修改端口范围");else{s.value=!0;try{const e=o({},B);e.additionalPorts&&Array.isArray(e.additionalPorts)?e.additionalPorts=e.additionalPorts.map((e=>"string"==typeof e?parseInt(e):e)).filter((e=>!isNaN(e)&&e>0&&e<=65535)):e.additionalPorts=[],_.value?(D.value&&B.newPassword?e.password=B.newPassword:delete e.password,delete e.newPassword,yield G.users.updateUser(b.value.id,e),P.success("用户更新成功")):(yield G.users.createUser(e),P.success("用户创建成功")),y.value=!1,yield z()}catch(u){if(400===(null==(e=u.response)?void 0:e.status)&&(null==(l=null==(a=u.response)?void 0:a.data)?void 0:l.needsConfirmation)&&"admin"===B.username&&B.newPassword)try{yield R.confirm(u.response.data.warning||"警告：修改管理员密码后，如果忘记密码将无法通过界面找回。找回管理员密码需要通过服务器命令行操作。请确认您已经记住了新密码。","确认修改管理员密码",{confirmButtonText:"确认修改",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1});const e=o({},B);e.additionalPorts&&Array.isArray(e.additionalPorts)?e.additionalPorts=e.additionalPorts.map((e=>"string"==typeof e?parseInt(e):e)).filter((e=>!isNaN(e)&&e>0&&e<=65535)):e.additionalPorts=[],D.value&&B.newPassword?e.password=B.newPassword:delete e.password,delete e.newPassword,e.confirmAdminPasswordChange=!0,yield G.users.updateUser(b.value.id,e),P.success("管理员密码修改成功"),y.value=!1,yield z()}catch(f){"cancel"!==f&&P.error("修改密码失败: "+((null==(r=null==(t=f.response)?void 0:t.data)?void 0:r.message)||f.message))}else P.error("操作失败: "+((null==(n=null==(i=u.response)?void 0:i.data)?void 0:n.message)||u.message))}finally{s.value=!1}}}})),handleDelete:e=>n(this,null,(function*(){var a,l;if(D.value)if("admin"!==e.username)try{yield R.confirm(`确定要删除用户 "${e.username}" 吗？此操作将同时删除该用户的所有转发规则。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield G.users.deleteUser(e.id),P.success("用户删除成功"),yield z()}catch(t){"cancel"!==t&&P.error("删除用户失败: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message))}else P.error("不能删除admin用户");else P.error("没有权限删除用户")})),handleExtendExpiry:e=>{D.value?(b.value=e,V.value=1,w.value=!0):P.error("没有权限延长用户过期时间")},confirmExtendExpiry:()=>n(this,null,(function*(){var e,a;i.value=!0;try{yield G.users.extendUserExpiry(b.value.id,{months:V.value}),P.success(`成功延长 ${V.value} 个月`),w.value=!1,yield z()}catch(l){P.error("延长过期时间失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}finally{i.value=!1}})),viewUserRules:a=>{e.push({name:"UserForwardRules",query:{userId:a.id}})},handleResetTraffic:e=>{D.value?(x.value=e,U.value="",h.value=!0):P.error("没有权限重置用户流量")},confirmResetTraffic:()=>n(this,null,(function*(){var e,a;if(x.value)try{yield R.confirm(`确定要重置用户 "${x.value.username}" 的流量统计吗？\n\n此操作将：\n• 用户总流量归零\n• 所有规则流量归零\n• 清理历史流量记录\n• 保留所有转发规则\n\n此操作不可撤销！`,"确认重置流量",{confirmButtonText:"确认重置",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),d.value=!0;const e=yield G.users.resetUserTraffic(x.value.id,{reason:U.value||"管理员重置"});if(e.data.success){P.success({message:`成功重置用户 ${x.value.username} 的流量统计`,duration:5e3});e.data.data.resetSummary;h.value=!1,yield z()}else P.error("重置流量失败: "+(e.data.message||"未知错误"))}catch(l){"cancel"!==l&&P.error("重置流量失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}finally{d.value=!1}})),resetForm:()=>{Object.assign(B,{username:"",email:"",password:"",newPassword:"",role:"user",portRangeStart:null,portRangeEnd:null,additionalPorts:[],expiryDate:null,trafficQuota:1,isActive:!0}),E.value="",T.value=!1,C.value&&C.value.clearValidate()},checkPortConflictsDebounced:O,formatQuota:e=>{if(!e||0===e)return"0GB";if(e>=1&&e%1==0)return`${e}GB`;if(e>=1)return`${e}GB`;if(e>=.001){const a=1024*e;return a>=1&&a%1==0?`${a}MB`:`${e}GB`}return`${e}GB`},getAdditionalPorts:Y}}},[["render",function(e,a,l,t,r,s){const i=U("Plus"),o=U("el-icon"),n=U("el-button"),d=U("el-table-column"),u=U("el-progress"),f=U("el-tag"),c=U("el-tooltip"),m=U("el-button-group"),p=U("el-table"),g=U("el-input"),v=U("el-form-item"),P=U("el-option"),k=U("el-select"),R=U("el-input-number"),G=U("el-date-picker"),ne=U("el-switch"),de=U("el-form"),ue=U("el-dialog"),fe=U("el-alert"),ce=C("loading");return E(),y("div",Q,[w("div",M,[a[21]||(a[21]=w("h2",null,"用户管理",-1)),t.isAdmin?(E(),h(n,{key:0,type:"primary",onClick:t.handleAdd},{default:_((()=>[V(o,null,{default:_((()=>[V(i)])),_:1}),a[20]||(a[20]=T(" 添加用户 "))])),_:1,__:[20]},8,["onClick"])):b("",!0)]),w("div",$,[x((E(),h(p,{data:t.displayUsers,border:"",style:{width:"100%"},class:"user-table"},{default:_((()=>[V(d,{prop:"id",label:"ID",width:"80"}),V(d,{prop:"username",label:"用户名",width:"120"}),V(d,{prop:"email",label:"邮箱",width:"180"}),V(d,{label:"端口配置",width:"200"},{default:_((({row:e})=>["admin"===e.role?(E(),y("div",j," 管理员 (无限制) ")):(E(),y("div",O,[e.portRangeStart&&e.portRangeEnd?(E(),y("div",F," 范围: "+S(e.portRangeStart)+"-"+S(e.portRangeEnd),1)):b("",!0),t.getAdditionalPorts(e).length>0?(E(),y("div",z," 额外: "+S(t.getAdditionalPorts(e).join(", ")),1)):b("",!0),e.portRangeStart||e.portRangeEnd||0!==t.getAdditionalPorts(e).length?b("",!0):(E(),y("div",Y," 未设置 "))]))])),_:1}),V(d,{label:"流量限额",width:"100"},{default:_((({row:e})=>[e.trafficQuota?(E(),y("span",q,S(t.formatQuota(e.trafficQuota)),1)):(E(),y("span",I,"未设置"))])),_:1}),V(d,{label:"流量使用 (双向)",width:"180"},{default:_((({row:e})=>[e.trafficStats?(E(),y("div",H,[w("div",N,[w("span",L,S(e.trafficStats.usedTrafficGB)+"GB",1),a[22]||(a[22]=w("span",{class:"separator"},"/",-1)),w("span",J,S(t.formatQuota(e.trafficStats.trafficQuotaGB)||"Unlimited"),1)]),V(u,{percentage:e.trafficStats.usagePercent,status:e.trafficStats.usagePercent>=90?"exception":e.trafficStats.usagePercent>=70?"warning":"success","stroke-width":6,"show-text":!1},null,8,["percentage","status"]),w("div",K," 剩余: "+S(e.trafficStats.remainingGB),1),w("div",W,[V(c,{content:"包含上行流量(客户端→服务器)和下行流量(服务器→客户端)",placement:"top"},{default:_((()=>[V(f,{size:"small",type:"info"},{default:_((()=>a[23]||(a[23]=[T("双向流量")]))),_:1,__:[23]})])),_:1})])])):(E(),y("span",X,"无数据"))])),_:1}),V(d,{label:"过期时间",width:"120"},{default:_((({row:e})=>[e.expiryDate?(E(),y("span",{key:0,class:D({expired:e.isExpired})},S(new Date(e.expiryDate).toLocaleDateString()),3)):(E(),y("span",Z,"永不过期")),e.isExpired?(E(),h(f,{key:2,type:"danger",size:"small",style:{"margin-left":"5px"}},{default:_((()=>a[24]||(a[24]=[T(" 已过期 ")]))),_:1,__:[24]})):b("",!0)])),_:1}),V(d,{label:"转发规则",width:"100"},{default:_((({row:e})=>[w("span",null,S(e.activeRuleCount||0)+"/"+S(e.forwardRuleCount||0),1)])),_:1}),V(d,{prop:"role",label:"角色",width:"100"},{default:_((({row:e})=>[V(f,{type:"admin"===e.role?"danger":"success"},{default:_((()=>[T(S("admin"===e.role?"管理员":"普通用户"),1)])),_:2},1032,["type"])])),_:1}),V(d,{prop:"isActive",label:"状态",width:"80"},{default:_((({row:e})=>[V(f,{type:e.isActive?"success":"info"},{default:_((()=>[T(S(e.isActive?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),V(d,{label:"操作",width:"280",fixed:"right"},{default:_((({row:e})=>[V(m,null,{default:_((()=>[t.canEditUser(e)?(E(),h(n,{key:0,type:"primary",size:"small",onClick:a=>t.handleEdit(e)},{default:_((()=>a[25]||(a[25]=[T(" 编辑 ")]))),_:2,__:[25]},1032,["onClick"])):b("",!0),"admin"!==e.role&&t.isAdmin?(E(),h(n,{key:1,type:"warning",size:"small",onClick:a=>t.handleExtendExpiry(e)},{default:_((()=>a[26]||(a[26]=[T(" 续期 ")]))),_:2,__:[26]},1032,["onClick"])):b("",!0),V(n,{type:"info",size:"small",onClick:a=>t.viewUserRules(e)},{default:_((()=>a[27]||(a[27]=[T(" 规则 ")]))),_:2,__:[27]},1032,["onClick"]),t.isAdmin?(E(),h(n,{key:2,type:"warning",size:"small",onClick:a=>t.handleResetTraffic(e),title:`重置 ${e.username} 的流量统计`},{default:_((()=>a[28]||(a[28]=[T(" 重置流量 ")]))),_:2,__:[28]},1032,["onClick","title"])):b("",!0),"admin"!==e.username&&t.isAdmin?(E(),h(n,{key:3,type:"danger",size:"small",onClick:a=>t.handleDelete(e),disabled:"admin"===e.username},{default:_((()=>a[29]||(a[29]=[T(" 删除 ")]))),_:2,__:[29]},1032,["onClick","disabled"])):b("",!0)])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[ce,t.loading]])]),V(ue,{title:t.dialogTitle,modelValue:t.dialogVisible,"onUpdate:modelValue":a[13]||(a[13]=e=>t.dialogVisible=e),width:"600px",onClose:t.resetForm},{footer:_((()=>[V(n,{onClick:a[12]||(a[12]=e=>t.dialogVisible=!1)},{default:_((()=>a[38]||(a[38]=[T("取消")]))),_:1,__:[38]}),V(n,{type:"primary",onClick:t.handleSubmit,loading:t.submitting,disabled:t.hasPortConflict},{default:_((()=>[T(S(t.isEdit?"更新":"创建"),1)])),_:1},8,["onClick","loading","disabled"])])),default:_((()=>[V(de,{ref:"formRef",model:t.form,rules:t.rules,"label-width":"120px"},{default:_((()=>[V(v,{label:"用户名",prop:"username"},{default:_((()=>[V(g,{modelValue:t.form.username,"onUpdate:modelValue":a[0]||(a[0]=e=>t.form.username=e),placeholder:"请输入用户名",disabled:t.isEdit},null,8,["modelValue","disabled"]),t.isEdit?(E(),y("div",ee," 用户名创建后不可修改 ")):b("",!0)])),_:1}),V(v,{label:"邮箱",prop:"email"},{default:_((()=>[V(g,{modelValue:t.form.email,"onUpdate:modelValue":a[1]||(a[1]=e=>t.form.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),t.isEdit&&t.isAdmin&&"admin"!==t.form.username?(E(),h(v,{key:0,label:"重置密码",prop:"newPassword"},{default:_((()=>[V(g,{modelValue:t.form.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.newPassword=e),type:"password",placeholder:"输入新密码（留空表示不修改）","show-password":"",clearable:""},null,8,["modelValue"]),a[30]||(a[30]=w("div",{class:"form-tip"}," 留空表示不修改密码，输入新密码将重置用户密码 ",-1))])),_:1,__:[30]})):b("",!0),t.isEdit?b("",!0):(E(),h(v,{key:1,label:"密码",prop:"password"},{default:_((()=>[V(g,{modelValue:t.form.password,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})),t.isEdit&&"admin"===t.form.username?(E(),h(v,{key:2,label:"新密码",prop:"newPassword"},{default:_((()=>[V(g,{modelValue:t.form.newPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>t.form.newPassword=e),type:"password",placeholder:"留空表示不修改密码","show-password":""},null,8,["modelValue"]),a[31]||(a[31]=w("div",{class:"form-tip"}," 修改管理员密码需要二次确认，请谨慎操作 ",-1))])),_:1,__:[31]})):b("",!0),V(v,{label:"角色",prop:"role"},{default:_((()=>[V(k,{modelValue:t.form.role,"onUpdate:modelValue":a[5]||(a[5]=e=>t.form.role=e),style:{width:"100%"},disabled:t.isEdit},{default:_((()=>[V(P,{label:"普通用户",value:"user"}),V(P,{label:"管理员",value:"admin"})])),_:1},8,["modelValue","disabled"]),a[32]||(a[32]=w("div",{class:"form-tip"}," 角色创建后不可修改，确保只有admin用户为管理员 ",-1))])),_:1,__:[32]}),"user"===t.form.role?(E(),h(v,{key:3,label:"端口范围",prop:"portRange"},{default:_((()=>[w("div",ae,[V(R,{modelValue:t.form.portRangeStart,"onUpdate:modelValue":a[6]||(a[6]=e=>t.form.portRangeStart=e),min:1,max:65535,placeholder:"起始端口",style:{width:"150px"},onChange:t.checkPortConflictsDebounced},null,8,["modelValue","onChange"]),a[33]||(a[33]=w("span",null,"-",-1)),V(R,{modelValue:t.form.portRangeEnd,"onUpdate:modelValue":a[7]||(a[7]=e=>t.form.portRangeEnd=e),min:1,max:65535,placeholder:"结束端口",style:{width:"150px"},onChange:t.checkPortConflictsDebounced},null,8,["modelValue","onChange"])]),a[34]||(a[34]=w("div",{class:"form-tip"}," 设置连续端口范围，例如：10001-10100 ",-1)),t.portConflictMessage?(E(),y("div",le,S(t.portConflictMessage),1)):b("",!0)])),_:1,__:[34]})):b("",!0),"user"===t.form.role?(E(),h(v,{key:4,label:"额外端口"},{default:_((()=>[V(k,{modelValue:t.form.additionalPorts,"onUpdate:modelValue":a[8]||(a[8]=e=>t.form.additionalPorts=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"输入额外端口号，按回车添加",style:{width:"100%"},onChange:t.checkPortConflictsDebounced},{default:_((()=>[(E(!0),y(A,null,B(t.form.additionalPorts,(e=>(E(),h(P,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),a[35]||(a[35]=w("div",{class:"form-tip"}," 可选：添加额外的单独端口，例如：12001, 12005, 12008 ",-1))])),_:1,__:[35]})):b("",!0),"user"===t.form.role?(E(),h(v,{key:5,label:"过期时间"},{default:_((()=>[V(G,{modelValue:t.form.expiryDate,"onUpdate:modelValue":a[9]||(a[9]=e=>t.form.expiryDate=e),type:"datetime",placeholder:"选择过期时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"]),a[36]||(a[36]=w("div",{class:"form-tip"}," 留空表示永不过期，新用户默认一个月后过期 ",-1))])),_:1,__:[36]})):b("",!0),"user"===t.form.role?(E(),h(v,{key:6,label:"流量限额",prop:"trafficQuota"},{default:_((()=>[V(R,{modelValue:t.form.trafficQuota,"onUpdate:modelValue":a[10]||(a[10]=e=>t.form.trafficQuota=e),min:.001,max:10240,step:.001,precision:3,placeholder:"GB",style:{width:"100%"}},null,8,["modelValue"]),a[37]||(a[37]=w("div",{class:"form-tip"}," 必须设置流量限额，单位：GB，范围：0.001-10240（支持小数，如0.1GB=100MB） ",-1))])),_:1,__:[37]})):b("",!0),V(v,{label:"状态",prop:"isActive"},{default:_((()=>[V(ne,{modelValue:t.form.isActive,"onUpdate:modelValue":a[11]||(a[11]=e=>t.form.isActive=e),disabled:"admin"===t.form.username},null,8,["modelValue","disabled"]),"admin"===t.form.username?(E(),y("div",te," admin用户状态不可禁用 ")):b("",!0)])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue","onClose"]),V(ue,{title:"延长用户过期时间",modelValue:t.extendDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>t.extendDialogVisible=e),width:"400px"},{footer:_((()=>[V(n,{onClick:a[15]||(a[15]=e=>t.extendDialogVisible=!1)},{default:_((()=>a[39]||(a[39]=[T("取消")]))),_:1,__:[39]}),V(n,{type:"primary",onClick:t.confirmExtendExpiry,loading:t.extending},{default:_((()=>a[40]||(a[40]=[T(" 确认延长 ")]))),_:1,__:[40]},8,["onClick","loading"])])),default:_((()=>[V(de,{"label-width":"100px"},{default:_((()=>[V(v,{label:"用户名"},{default:_((()=>{var e;return[w("span",null,S(null==(e=t.currentUser)?void 0:e.username),1)]})),_:1}),V(v,{label:"当前过期时间"},{default:_((()=>{var e;return[w("span",null,S((null==(e=t.currentUser)?void 0:e.expiryDate)?new Date(t.currentUser.expiryDate).toLocaleString():"永不过期"),1)]})),_:1}),V(v,{label:"延长月数"},{default:_((()=>[V(R,{modelValue:t.extendMonths,"onUpdate:modelValue":a[14]||(a[14]=e=>t.extendMonths=e),min:1,max:12,style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),V(ue,{title:"重置用户流量统计",modelValue:t.resetTrafficDialogVisible,"onUpdate:modelValue":a[19]||(a[19]=e=>t.resetTrafficDialogVisible=e),width:"500px"},{footer:_((()=>[V(n,{onClick:a[18]||(a[18]=e=>t.resetTrafficDialogVisible=!1)},{default:_((()=>a[42]||(a[42]=[T("取消")]))),_:1,__:[42]}),V(n,{type:"danger",onClick:t.confirmResetTraffic,loading:t.resettingTraffic},{default:_((()=>a[43]||(a[43]=[T(" 确认重置 ")]))),_:1,__:[43]},8,["onClick","loading"])])),default:_((()=>[w("div",re,[V(fe,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:_((()=>a[41]||(a[41]=[w("p",null,"此操作将重置用户的所有流量统计数据，包括：",-1),w("ul",null,[w("li",null,"✅ 用户总流量归零"),w("li",null,"✅ 所有规则流量归零"),w("li",null,"✅ 清理历史流量记录"),w("li",null,[T("🔒 "),w("strong",null,"保留所有转发规则")])],-1),w("p",null,[w("strong",null,"此操作不可撤销，请谨慎操作！")],-1)]))),_:1}),V(de,{"label-width":"100px",style:{"margin-top":"20px"}},{default:_((()=>[V(v,{label:"用户名"},{default:_((()=>{var e;return[w("span",se,S(null==(e=t.resetTrafficUser)?void 0:e.username),1)]})),_:1}),V(v,{label:"当前流量"},{default:_((()=>{var e,a,l,r;return[w("span",ie,S((null==(a=null==(e=t.resetTrafficUser)?void 0:e.trafficStats)?void 0:a.usedTrafficGB)||0)+"GB / "+S(t.formatQuota(null==(r=null==(l=t.resetTrafficUser)?void 0:l.trafficStats)?void 0:r.trafficQuotaGB)||"Unlimited"),1)]})),_:1}),V(v,{label:"转发规则"},{default:_((()=>{var e;return[w("span",oe,S((null==(e=t.resetTrafficUser)?void 0:e.forwardRuleCount)||0)+" 个规则将被保留 ",1)]})),_:1}),V(v,{label:"重置原因"},{default:_((()=>[V(g,{modelValue:t.resetTrafficReason,"onUpdate:modelValue":a[17]||(a[17]=e=>t.resetTrafficReason=e),type:"textarea",rows:3,placeholder:"请输入重置原因（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-6d980771"]]);export{ne as default};
