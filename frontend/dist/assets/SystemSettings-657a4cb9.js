var l=(l,e,s)=>new Promise(((t,a)=>{var n=l=>{try{r(s.next(l))}catch(e){a(e)}},i=l=>{try{r(s.throw(l))}catch(e){a(e)}},r=l=>l.done?t(l.value):Promise.resolve(l.value).then(n,i);r((s=s.apply(l,e)).next())}));import{s as e}from"./api-25d551a2.js";import{_ as s,r as t,n as a,d as n,g as i,e as r,w as c,E as u,f as d,o,k as v,t as p,C as g}from"./index-9f3a3f15.js";const y={class:"system-settings"},h={class:"settings-section"},f={class:"setting-item"},m={class:"setting-control"},w={class:"setting-item"},x={class:"setting-info"},P={class:"status-info"},I={class:"status-details"},_={key:0},b={key:1},C={class:"help-section"},k={class:"security-notice"},A=s({__name:"SystemSettings",setup(s){const A=t(!0),E=t(!1),S=[{address:"0.0.0.0:端口",type:"IPv4",external:!0,description:"监听所有IPv4接口，外部设备可以访问"},{address:"127.0.0.1:端口",type:"IPv4",external:!1,description:"仅监听IPv4回环接口，只有本机可以访问"},{address:"[::]:端口",type:"IPv6",external:!0,description:"监听所有IPv6接口，外部设备可以访问"},{address:"[::1]:端口",type:"IPv6",external:!1,description:"仅监听IPv6回环接口，只有本机可以访问"}],T=()=>l(this,null,(function*(){try{const l=yield e.getConfig("allowUserExternalAccess");A.value=l.data.value}catch(l){u.error("加载配置失败")}})),U=s=>l(this,null,(function*(){try{yield g.confirm(`确定要${s?"启用":"禁用"}普通用户外部访问吗？\n\n${s?"启用后，普通用户的转发规则将监听所有网络接口，外部设备可以访问。":"禁用后，普通用户的转发规则将仅监听本地接口，外部设备无法访问。"}\n\n此操作将立即生效并重新生成GOST配置。`,"确认配置变更",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),E.value=!0,yield e.updateConfig("allowUserExternalAccess",{value:s,description:"允许普通用户的转发规则被外部访问",category:"security"}),u.success(`已${s?"启用":"禁用"}普通用户外部访问`)}catch(l){"cancel"!==l?(u.error("更新配置失败"),A.value=!s):A.value=!s}finally{E.value=!1}}));return a((()=>{T()})),(l,e)=>{const s=d("el-switch"),t=d("el-tag"),a=d("el-card"),u=d("el-table-column"),g=d("el-table"),T=d("el-alert");return o(),n("div",y,[e[12]||(e[12]=i("div",{class:"page-header"},[i("h1",null,"系统设置"),i("p",null,"管理系统全局配置和安全策略")],-1)),r(a,{class:"settings-card"},{header:c((()=>e[1]||(e[1]=[i("div",{class:"card-header"},[i("span",null,"🔒 安全配置")],-1)]))),default:c((()=>[i("div",h,[i("div",f,[e[2]||(e[2]=i("div",{class:"setting-info"},[i("h3",null,"普通用户外部访问控制"),i("p",{class:"setting-description"},[v(" 控制普通用户创建的转发规则是否允许外部IP访问。 "),i("br"),i("strong",null,"启用"),v("：普通用户规则监听所有接口 (0.0.0.0)，外部可访问 "),i("br"),i("strong",null,"禁用"),v("：普通用户规则仅监听本地接口 (127.0.0.1)，仅本地访问 "),i("br"),i("em",null,"注意：管理员用户不受此限制，始终允许外部访问")])],-1)),i("div",m,[r(s,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=l=>A.value=l),loading:E.value,"active-text":"允许","inactive-text":"禁止","active-color":"#67C23A","inactive-color":"#F56C6C",onChange:U},null,8,["modelValue","loading"])])]),i("div",w,[i("div",x,[e[8]||(e[8]=i("h3",null,"当前配置状态",-1)),i("div",P,[r(t,{type:A.value?"success":"warning",size:"large"},{default:c((()=>[v(p(A.value?"✅ 允许外部访问":"🔒 仅本地访问"),1)])),_:1},8,["type"]),i("div",I,[e[5]||(e[5]=i("p",null,[i("strong",null,"管理员用户规则：")],-1)),e[6]||(e[6]=i("ul",null,[i("li",null,[v("IPv4: "),i("code",null,"0.0.0.0:端口"),v(" (所有接口)")]),i("li",null,[v("IPv6: "),i("code",null,"[::]:端口"),v(" (所有接口)")])],-1)),e[7]||(e[7]=i("p",null,[i("strong",null,"普通用户规则：")],-1)),A.value?(o(),n("ul",_,e[3]||(e[3]=[i("li",null,[v("IPv4: "),i("code",null,"0.0.0.0:端口"),v(" (所有接口)")],-1),i("li",null,[v("IPv6: "),i("code",null,"[::]:端口"),v(" (所有接口)")],-1)]))):(o(),n("ul",b,e[4]||(e[4]=[i("li",null,[v("IPv4: "),i("code",null,"127.0.0.1:端口"),v(" (仅本地)")],-1),i("li",null,[v("IPv6: "),i("code",null,"[::1]:端口"),v(" (仅本地)")],-1)])))])])])])])])),_:1}),r(a,{class:"settings-card"},{header:c((()=>e[9]||(e[9]=[i("div",{class:"card-header"},[i("span",null,"ℹ️ 配置说明")],-1)]))),default:c((()=>[i("div",C,[e[11]||(e[11]=i("h3",null,"网络监听地址说明",-1)),r(g,{data:S,style:{width:"100%"}},{default:c((()=>[r(u,{prop:"address",label:"监听地址",width:"200"},{default:c((l=>[i("code",null,p(l.row.address),1)])),_:1}),r(u,{prop:"type",label:"类型",width:"100"}),r(u,{prop:"external",label:"外部访问",width:"100"},{default:c((l=>[r(t,{type:l.row.external?"success":"danger",size:"small"},{default:c((()=>[v(p(l.row.external?"✅ 可访问":"❌ 不可访问"),1)])),_:2},1032,["type"])])),_:1}),r(u,{prop:"description",label:"说明"})])),_:1}),i("div",k,[r(T,{title:"安全提醒",type:"warning",closable:!1,"show-icon":""},{default:c((()=>e[10]||(e[10]=[i("p",null,[i("strong",null,"启用外部访问的安全考虑：")],-1),i("ul",null,[i("li",null,"普通用户的转发端口将直接暴露到公网"),i("li",null,"请确保用户创建的转发规则是安全的"),i("li",null,"建议配合防火墙和端口范围限制使用"),i("li",null,"可以随时通过此开关禁用普通用户的外部访问")],-1)]))),_:1})])])])),_:1})])}}},[["__scopeId","data-v-0c4b2a17"]]);export{A as default};
