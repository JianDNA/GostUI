import{u as a,w as s,c as l,x as e,l as t,e as r,E as n}from"./element-plus-0a16f2db.js";import{_ as u,r as o}from"./index-75dfb4d4.js";import{r as i,k as d,z as c,P as f,A as v,H as p,ag as g,y as _,L as m,M as I,K as y,C as h}from"./vue-55dd3248.js";import"./utils-d4f80f06.js";const b={class:"profile-container"},w={key:0,class:"loading-container"},x={key:1,class:"error-container"},S={key:2},P={class:"user-info"},A={class:"user-details"},k={class:"user-role"},D={class:"card-header"},C={class:"status-content"},U={class:"status-item"},E={key:0,class:"status-item"},z={key:1,class:"status-item"},L={class:"card-header"},j={class:"traffic-content"},B={class:"traffic-progress"},F={class:"traffic-details"},N={class:"traffic-item"},R={class:"traffic-item"},T={class:"traffic-item"},H={class:"card-header"},K={class:"port-content"},M={class:"port-item"},Q={class:"port-item"},q={class:"port-item"},G={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},J={class:"card-header"},O={class:"stat-item"},V={class:"stat-value"},W={class:"stat-item"},X={class:"stat-value success"},Y={class:"stat-item"},Z={class:"stat-value warning"},$={class:"stat-item"},aa={class:"stat-value danger"},sa={class:"card-header"},la={key:0},ea={key:1,class:"no-expiry"};const ta=u({name:"Profile",components:{User:a,DataLine:s,Connection:l,DataBoard:e,List:t,Right:r},setup(){const a=i(null),s=i(!1),l=async()=>{var l;try{s.value=!0,console.log("🔍 开始获取用户信息...");const l=await o.get("/users/me");console.log("🔍 API响应:",l),l&&l.data?l.data.success&&l.data.data?(a.value=l.data.data,console.log("✅ 用户信息设置成功:",a.value)):l.data.data?(a.value=l.data,console.log("✅ 用户信息设置成功(兼容模式):",a.value)):(console.error("❌ API响应格式不正确:",l.data),n.error("用户信息格式错误")):(console.error("❌ API响应为空"),n.error("获取用户信息失败"))}catch(e){console.error("❌ 获取用户信息失败:",e),401===(null==(l=e.response)?void 0:l.status)?n.error("登录已过期，请重新登录"):n.error("获取用户信息失败")}finally{s.value=!1}};return d((()=>{l()})),{userInfo:a,loading:s,fetchUserInfo:l,formatDate:a=>a?new Date(a).toLocaleString("zh-CN"):"-",getDaysClass:a=>a<=0?"expired":a<=7?"warning":a<=30?"caution":"normal",getTrafficStatus:a=>a>=90?"exception":a>=70?"warning":"success",getUsageClass:a=>a>=90?"danger":a>=70?"warning":"success"}}},[["render",function(a,s,l,e,t,r){const n=g("el-loading-spinner"),u=g("el-button"),o=g("el-empty"),i=g("el-avatar"),d=g("el-tag"),ta=g("el-card"),ra=g("User"),na=g("el-icon"),ua=g("el-col"),oa=g("DataLine"),ia=g("el-progress"),da=g("Connection"),ca=g("el-row"),fa=g("DataBoard"),va=g("List"),pa=g("el-table-column"),ga=g("Right"),_a=g("el-table");return _(),c("div",b,[e.loading?(_(),c("div",w,[f(n,{size:"50"}),s[0]||(s[0]=v("p",null,"正在加载用户信息...",-1))])):e.userInfo?(_(),c("div",S,[f(ta,{class:"profile-header"},{default:p((()=>{var a,l,t,r;return[v("div",P,[f(i,{size:80,class:"user-avatar"},{default:p((()=>s[2]||(s[2]=[v("i",{class:"el-icon-user"},null,-1)]))),_:1,__:[2]}),v("div",A,[v("h2",null,I(null==(a=e.userInfo)?void 0:a.username),1),f(d,{type:(null==(t=null==(l=e.userInfo)?void 0:l.accountStatus)?void 0:t.isExpired)?"danger":"success"},{default:p((()=>{var a,s;return[m(I((null==(s=null==(a=e.userInfo)?void 0:a.accountStatus)?void 0:s.isExpired)?"已过期":"正常"),1)]})),_:1},8,["type"]),v("p",k,I("admin"===(null==(r=e.userInfo)?void 0:r.role)?"管理员":"普通用户"),1)])])]})),_:1}),f(ca,{gutter:20,style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:8},{default:p((()=>[f(ta,{class:"status-card"},{header:p((()=>[v("div",D,[s[3]||(s[3]=v("span",null,"账户状态",-1)),f(na,null,{default:p((()=>[f(ra)])),_:1})])])),default:p((()=>{var a,l,t,r,n,u;return[v("div",C,[v("div",U,[s[4]||(s[4]=v("span",{class:"label"},"账户状态:",-1)),f(d,{type:(null==(l=null==(a=e.userInfo)?void 0:a.accountStatus)?void 0:l.isExpired)?"danger":"success"},{default:p((()=>{var a,s;return[m(I((null==(s=null==(a=e.userInfo)?void 0:a.accountStatus)?void 0:s.userStatus)||"正常"),1)]})),_:1},8,["type"])]),(null==(r=null==(t=e.userInfo)?void 0:t.accountStatus)?void 0:r.expiresAt)?(_(),c("div",E,[s[5]||(s[5]=v("span",{class:"label"},"到期时间:",-1)),v("span",null,I(e.formatDate(e.userInfo.accountStatus.expiresAt)),1)])):y("",!0),null!==(null==(u=null==(n=e.userInfo)?void 0:n.accountStatus)?void 0:u.daysUntilExpiry)?(_(),c("div",z,[s[6]||(s[6]=v("span",{class:"label"},"剩余天数:",-1)),v("span",{class:h(e.getDaysClass(e.userInfo.accountStatus.daysUntilExpiry))},I(e.userInfo.accountStatus.daysUntilExpiry>0?e.userInfo.accountStatus.daysUntilExpiry+" 天":"已过期"),3)])):y("",!0)])]})),_:1})])),_:1}),f(ua,{span:8},{default:p((()=>[f(ta,{class:"traffic-card"},{header:p((()=>[v("div",L,[s[7]||(s[7]=v("span",null,"流量使用",-1)),f(na,null,{default:p((()=>[f(oa)])),_:1})])])),default:p((()=>{var a,l,t,r,n,u,o,i,d,c,p,g,_;return[v("div",j,[v("div",B,[f(ia,{percentage:(null==(l=null==(a=e.userInfo)?void 0:a.trafficStats)?void 0:l.usagePercent)||0,status:e.getTrafficStatus(null==(r=null==(t=e.userInfo)?void 0:t.trafficStats)?void 0:r.usagePercent),"stroke-width":12},null,8,["percentage","status"])]),v("div",F,[v("div",N,[s[8]||(s[8]=v("span",{class:"label"},"已使用:",-1)),v("span",null,I((null==(u=null==(n=e.userInfo)?void 0:n.trafficStats)?void 0:u.usedTrafficFormatted)||"0 B"),1)]),v("div",R,[s[9]||(s[9]=v("span",{class:"label"},"总配额:",-1)),v("span",null,I((null==(i=null==(o=e.userInfo)?void 0:o.trafficStats)?void 0:i.trafficQuotaFormatted)||"无限制"),1)]),v("div",T,[s[10]||(s[10]=v("span",{class:"label"},"使用率:",-1)),v("span",{class:h(e.getUsageClass(null==(c=null==(d=e.userInfo)?void 0:d.trafficStats)?void 0:c.usagePercent))},I((null==(_=null==(g=null==(p=e.userInfo)?void 0:p.trafficStats)?void 0:g.usagePercent)?void 0:_.toFixed(1))||0)+"% ",3)])])])]})),_:1})])),_:1}),f(ua,{span:8},{default:p((()=>[f(ta,{class:"port-card"},{header:p((()=>[v("div",H,[s[11]||(s[11]=v("span",null,"端口范围",-1)),f(na,null,{default:p((()=>[f(da)])),_:1})])])),default:p((()=>{var a,l,t,r;return[v("div",K,[v("div",M,[s[12]||(s[12]=v("span",{class:"label"},"端口范围:",-1)),f(d,{type:"info"},{default:p((()=>{var a,s,l,t;return[m(I(null==(s=null==(a=e.userInfo)?void 0:a.portInfo)?void 0:s.startPort)+" - "+I(null==(t=null==(l=e.userInfo)?void 0:l.portInfo)?void 0:t.endPort),1)]})),_:1})]),v("div",Q,[s[13]||(s[13]=v("span",{class:"label"},"可用端口:",-1)),v("span",null,I((null==(l=null==(a=e.userInfo)?void 0:a.portInfo)?void 0:l.availablePorts)||0)+" 个",1)]),v("div",q,[s[14]||(s[14]=v("span",{class:"label"},"端口范围:",-1)),v("div",null,[f(d,{type:"info",size:"small"},{default:p((()=>{var a,s,l,t;return[m(I((null==(s=null==(a=e.userInfo)?void 0:a.portInfo)?void 0:s.startPort)||"N/A")+" - "+I((null==(t=null==(l=e.userInfo)?void 0:l.portInfo)?void 0:t.endPort)||"N/A"),1)]})),_:1}),v("span",G," (共 "+I((null==(r=null==(t=e.userInfo)?void 0:t.portInfo)?void 0:r.availablePorts)||0)+" 个可用端口) ",1)])])])]})),_:1})])),_:1})])),_:1}),f(ca,{style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:24},{default:p((()=>[f(ta,null,{header:p((()=>[v("div",J,[s[15]||(s[15]=v("span",null,"转发规则统计",-1)),f(na,null,{default:p((()=>[f(fa)])),_:1})])])),default:p((()=>[f(ca,{gutter:20},{default:p((()=>[f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",O,[v("div",V,I((null==(l=null==(a=e.userInfo)?void 0:a.rulesStats)?void 0:l.total)||0),1),s[16]||(s[16]=v("div",{class:"stat-label"},"总规则数",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",W,[v("div",X,I((null==(l=null==(a=e.userInfo)?void 0:a.rulesStats)?void 0:l.active)||0),1),s[17]||(s[17]=v("div",{class:"stat-label"},"活跃规则",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",Y,[v("div",Z,I((null==(l=null==(a=e.userInfo)?void 0:a.rulesStats)?void 0:l.inactive)||0),1),s[18]||(s[18]=v("div",{class:"stat-label"},"非活跃规则",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",$,[v("div",aa,I((null==(l=null==(a=e.userInfo)?void 0:a.rulesStats)?void 0:l.expired)||0),1),s[19]||(s[19]=v("div",{class:"stat-label"},"过期规则",-1))])]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),f(ca,{style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:24},{default:p((()=>[f(ta,null,{header:p((()=>[v("div",sa,[s[20]||(s[20]=v("span",null,"我的转发规则",-1)),f(na,null,{default:p((()=>[f(va)])),_:1})])])),default:p((()=>{var a;return[f(_a,{data:(null==(a=e.userInfo)?void 0:a.forwardRules)||[],stripe:"",style:{width:"100%"}},{default:p((()=>[f(pa,{prop:"name",label:"规则名称"}),f(pa,{prop:"protocol",label:"协议",width:"80"}),f(pa,{label:"转发规则",width:"200"},{default:p((a=>[f(d,{type:"primary"},{default:p((()=>[m(I(a.row.sourcePort)+" ",1),f(na,null,{default:p((()=>[f(ga)])),_:1}),m(" "+I(a.row.targetHost)+":"+I(a.row.targetPort),1)])),_:2},1024)])),_:1}),f(pa,{label:"状态",width:"100"},{default:p((a=>[f(d,{type:a.row.isActive?"success":"info",size:"small"},{default:p((()=>[m(I(a.row.isActive?"活跃":"非活跃"),1)])),_:2},1032,["type"])])),_:1}),f(pa,{label:"到期时间",width:"150"},{default:p((a=>[a.row.expiresAt?(_(),c("span",la,I(e.formatDate(a.row.expiresAt)),1)):(_(),c("span",ea,"无期限"))])),_:1}),f(pa,{label:"创建时间",width:"150"},{default:p((a=>[m(I(e.formatDate(a.row.createdAt)),1)])),_:1})])),_:1},8,["data"])]})),_:1})])),_:1})])),_:1})])):(_(),c("div",x,[f(o,{description:"无法获取用户信息"},{default:p((()=>[f(u,{type:"primary",onClick:e.fetchUserInfo},{default:p((()=>s[1]||(s[1]=[m("重新加载")]))),_:1,__:[1]},8,["onClick"])])),_:1})]))])}],["__scopeId","data-v-82a10759"]]);export{ta as default};
