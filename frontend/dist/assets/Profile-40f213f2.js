import{u as a,w as s,c as l,x as t,l as e,e as r,E as n}from"./element-plus-a98c71bf.js";import{_ as u,r as i}from"./index-1003864c.js";import{r as o,k as d,z as c,P as f,A as v,H as p,ag as _,y as m,L as g,M as y,K as I,C as h}from"./vue-9e38bd25.js";import"./utils-c29d00eb.js";const b={class:"profile-container"},w={key:0,class:"loading-container"},x={key:1,class:"error-container"},S={key:2},P={class:"user-info"},k={class:"user-details"},D={class:"user-role"},A={class:"card-header"},C={class:"status-content"},U={class:"status-item"},E={key:0,class:"status-item"},z={key:1,class:"status-item"},L={class:"card-header"},j={class:"traffic-content"},B={class:"traffic-progress"},F={class:"traffic-details"},N={class:"traffic-item"},R={class:"traffic-item"},T={class:"traffic-item"},H={class:"card-header"},K={class:"port-content"},M={class:"port-item"},Q={class:"port-item"},q={class:"port-item"},G={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},J={class:"card-header"},O={class:"stat-item"},V={class:"stat-value"},W={class:"stat-item"},X={class:"stat-value success"},Y={class:"stat-item"},Z={class:"stat-value warning"},$={class:"stat-item"},aa={class:"stat-value danger"},sa={class:"card-header"},la={key:0},ta={key:1,class:"no-expiry"};const ea=u({name:"Profile",components:{User:a,DataLine:s,Connection:l,DataBoard:t,List:e,Right:r},setup(){const a=o(null),s=o(!1),l=async()=>{var l;try{s.value=!0;const l=await i.get("/users/me");l&&l.data?l.data.success&&l.data.data?a.value=l.data.data:l.data.data?a.value=l.data:n.error("用户信息格式错误"):n.error("获取用户信息失败")}catch(t){401===(null==(l=t.response)?void 0:l.status)?n.error("登录已过期，请重新登录"):n.error("获取用户信息失败")}finally{s.value=!1}};return d((()=>{l()})),{userInfo:a,loading:s,fetchUserInfo:l,formatDate:a=>a?new Date(a).toLocaleString("zh-CN"):"-",getDaysClass:a=>a<=0?"expired":a<=7?"warning":a<=30?"caution":"normal",getTrafficStatus:a=>a>=90?"exception":a>=70?"warning":"success",getUsageClass:a=>a>=90?"danger":a>=70?"warning":"success"}}},[["render",function(a,s,l,t,e,r){const n=_("el-loading-spinner"),u=_("el-button"),i=_("el-empty"),o=_("el-avatar"),d=_("el-tag"),ea=_("el-card"),ra=_("User"),na=_("el-icon"),ua=_("el-col"),ia=_("DataLine"),oa=_("el-progress"),da=_("Connection"),ca=_("el-row"),fa=_("DataBoard"),va=_("List"),pa=_("el-table-column"),_a=_("Right"),ma=_("el-table");return m(),c("div",b,[t.loading?(m(),c("div",w,[f(n,{size:"50"}),s[0]||(s[0]=v("p",null,"正在加载用户信息...",-1))])):t.userInfo?(m(),c("div",S,[f(ea,{class:"profile-header"},{default:p((()=>{var a,l,e,r;return[v("div",P,[f(o,{size:80,class:"user-avatar"},{default:p((()=>s[2]||(s[2]=[v("i",{class:"el-icon-user"},null,-1)]))),_:1,__:[2]}),v("div",k,[v("h2",null,y(null==(a=t.userInfo)?void 0:a.username),1),f(d,{type:(null==(e=null==(l=t.userInfo)?void 0:l.accountStatus)?void 0:e.isExpired)?"danger":"success"},{default:p((()=>{var a,s;return[g(y((null==(s=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:s.isExpired)?"已过期":"正常"),1)]})),_:1},8,["type"]),v("p",D,y("admin"===(null==(r=t.userInfo)?void 0:r.role)?"管理员":"普通用户"),1)])])]})),_:1}),f(ca,{gutter:20,style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:8},{default:p((()=>[f(ea,{class:"status-card"},{header:p((()=>[v("div",A,[s[3]||(s[3]=v("span",null,"账户状态",-1)),f(na,null,{default:p((()=>[f(ra)])),_:1})])])),default:p((()=>{var a,l,e,r,n,u;return[v("div",C,[v("div",U,[s[4]||(s[4]=v("span",{class:"label"},"账户状态:",-1)),f(d,{type:(null==(l=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:l.isExpired)?"danger":"success"},{default:p((()=>{var a,s;return[g(y((null==(s=null==(a=t.userInfo)?void 0:a.accountStatus)?void 0:s.userStatus)||"正常"),1)]})),_:1},8,["type"])]),(null==(r=null==(e=t.userInfo)?void 0:e.accountStatus)?void 0:r.expiresAt)?(m(),c("div",E,[s[5]||(s[5]=v("span",{class:"label"},"到期时间:",-1)),v("span",null,y(t.formatDate(t.userInfo.accountStatus.expiresAt)),1)])):I("",!0),null!==(null==(u=null==(n=t.userInfo)?void 0:n.accountStatus)?void 0:u.daysUntilExpiry)?(m(),c("div",z,[s[6]||(s[6]=v("span",{class:"label"},"剩余天数:",-1)),v("span",{class:h(t.getDaysClass(t.userInfo.accountStatus.daysUntilExpiry))},y(t.userInfo.accountStatus.daysUntilExpiry>0?t.userInfo.accountStatus.daysUntilExpiry+" 天":"已过期"),3)])):I("",!0)])]})),_:1})])),_:1}),f(ua,{span:8},{default:p((()=>[f(ea,{class:"traffic-card"},{header:p((()=>[v("div",L,[s[7]||(s[7]=v("span",null,"流量使用",-1)),f(na,null,{default:p((()=>[f(ia)])),_:1})])])),default:p((()=>{var a,l,e,r,n,u,i,o,d,c,p,_,m;return[v("div",j,[v("div",B,[f(oa,{percentage:(null==(l=null==(a=t.userInfo)?void 0:a.trafficStats)?void 0:l.usagePercent)||0,status:t.getTrafficStatus(null==(r=null==(e=t.userInfo)?void 0:e.trafficStats)?void 0:r.usagePercent),"stroke-width":12},null,8,["percentage","status"])]),v("div",F,[v("div",N,[s[8]||(s[8]=v("span",{class:"label"},"已使用:",-1)),v("span",null,y((null==(u=null==(n=t.userInfo)?void 0:n.trafficStats)?void 0:u.usedTrafficFormatted)||"0 B"),1)]),v("div",R,[s[9]||(s[9]=v("span",{class:"label"},"总配额:",-1)),v("span",null,y((null==(o=null==(i=t.userInfo)?void 0:i.trafficStats)?void 0:o.trafficQuotaFormatted)||"无限制"),1)]),v("div",T,[s[10]||(s[10]=v("span",{class:"label"},"使用率:",-1)),v("span",{class:h(t.getUsageClass(null==(c=null==(d=t.userInfo)?void 0:d.trafficStats)?void 0:c.usagePercent))},y((null==(m=null==(_=null==(p=t.userInfo)?void 0:p.trafficStats)?void 0:_.usagePercent)?void 0:m.toFixed(1))||0)+"% ",3)])])])]})),_:1})])),_:1}),f(ua,{span:8},{default:p((()=>[f(ea,{class:"port-card"},{header:p((()=>[v("div",H,[s[11]||(s[11]=v("span",null,"端口范围",-1)),f(na,null,{default:p((()=>[f(da)])),_:1})])])),default:p((()=>{var a,l,e,r;return[v("div",K,[v("div",M,[s[12]||(s[12]=v("span",{class:"label"},"端口范围:",-1)),f(d,{type:"info"},{default:p((()=>{var a,s,l,e;return[g(y(null==(s=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:s.startPort)+" - "+y(null==(e=null==(l=t.userInfo)?void 0:l.portInfo)?void 0:e.endPort),1)]})),_:1})]),v("div",Q,[s[13]||(s[13]=v("span",{class:"label"},"可用端口:",-1)),v("span",null,y((null==(l=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:l.availablePorts)||0)+" 个",1)]),v("div",q,[s[14]||(s[14]=v("span",{class:"label"},"端口范围:",-1)),v("div",null,[f(d,{type:"info",size:"small"},{default:p((()=>{var a,s,l,e;return[g(y((null==(s=null==(a=t.userInfo)?void 0:a.portInfo)?void 0:s.startPort)||"N/A")+" - "+y((null==(e=null==(l=t.userInfo)?void 0:l.portInfo)?void 0:e.endPort)||"N/A"),1)]})),_:1}),v("span",G," (共 "+y((null==(r=null==(e=t.userInfo)?void 0:e.portInfo)?void 0:r.availablePorts)||0)+" 个可用端口) ",1)])])])]})),_:1})])),_:1})])),_:1}),f(ca,{style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:24},{default:p((()=>[f(ea,null,{header:p((()=>[v("div",J,[s[15]||(s[15]=v("span",null,"转发规则统计",-1)),f(na,null,{default:p((()=>[f(fa)])),_:1})])])),default:p((()=>[f(ca,{gutter:20},{default:p((()=>[f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",O,[v("div",V,y((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.total)||0),1),s[16]||(s[16]=v("div",{class:"stat-label"},"总规则数",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",W,[v("div",X,y((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.active)||0),1),s[17]||(s[17]=v("div",{class:"stat-label"},"活跃规则",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",Y,[v("div",Z,y((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.inactive)||0),1),s[18]||(s[18]=v("div",{class:"stat-label"},"非活跃规则",-1))])]})),_:1}),f(ua,{span:6},{default:p((()=>{var a,l;return[v("div",$,[v("div",aa,y((null==(l=null==(a=t.userInfo)?void 0:a.rulesStats)?void 0:l.expired)||0),1),s[19]||(s[19]=v("div",{class:"stat-label"},"过期规则",-1))])]})),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),f(ca,{style:{"margin-top":"20px"}},{default:p((()=>[f(ua,{span:24},{default:p((()=>[f(ea,null,{header:p((()=>[v("div",sa,[s[20]||(s[20]=v("span",null,"我的转发规则",-1)),f(na,null,{default:p((()=>[f(va)])),_:1})])])),default:p((()=>{var a;return[f(ma,{data:(null==(a=t.userInfo)?void 0:a.forwardRules)||[],stripe:"",style:{width:"100%"}},{default:p((()=>[f(pa,{prop:"name",label:"规则名称"}),f(pa,{prop:"protocol",label:"协议",width:"80"}),f(pa,{label:"转发规则",width:"200"},{default:p((a=>[f(d,{type:"primary"},{default:p((()=>[g(y(a.row.sourcePort)+" ",1),f(na,null,{default:p((()=>[f(_a)])),_:1}),g(" "+y(a.row.targetHost)+":"+y(a.row.targetPort),1)])),_:2},1024)])),_:1}),f(pa,{label:"状态",width:"100"},{default:p((a=>[f(d,{type:a.row.isActive?"success":"info",size:"small"},{default:p((()=>[g(y(a.row.isActive?"活跃":"非活跃"),1)])),_:2},1032,["type"])])),_:1}),f(pa,{label:"到期时间",width:"150"},{default:p((a=>[a.row.expiresAt?(m(),c("span",la,y(t.formatDate(a.row.expiresAt)),1)):(m(),c("span",ta,"无期限"))])),_:1}),f(pa,{label:"创建时间",width:"150"},{default:p((a=>[g(y(t.formatDate(a.row.createdAt)),1)])),_:1})])),_:1},8,["data"])]})),_:1})])),_:1})])),_:1})])):(m(),c("div",x,[f(i,{description:"无法获取用户信息"},{default:p((()=>[f(u,{type:"primary",onClick:t.fetchUserInfo},{default:p((()=>s[1]||(s[1]=[g("重新加载")]))),_:1,__:[1]},8,["onClick"])])),_:1})]))])}],["__scopeId","data-v-82a10759"]]);export{ea as default};
