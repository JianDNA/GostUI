import{_ as e,u as a,a as s,b as l,r,c as t,d as o,e as u,w as d,f as n,o as i,g as m,h as p,i as c,j as g,l as f,k as _,t as v,E as h}from"./index-e35aab08.js";const y={class:"login-container"},w=e({__name:"Login",setup(e){const w=a(),b=s(),x=l(),V=r(null),q=r(!1),U=t({username:"",password:""}),j={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:1,max:20,message:"密码不能为空",trigger:"blur"}]},k=()=>{return e=this,a=null,s=function*(){if(V.value)try{yield V.value.validate(),q.value=!0,yield w.dispatch("user/login",U);const e=yield w.dispatch("user/getCurrentUser");h.success("登录成功");const a=x.query.redirect||("admin"===e.role?"/admin":"/dashboard");b.push(a)}catch(e){h.error(e.message||"登录失败")}finally{q.value=!1}},new Promise(((l,r)=>{var t=e=>{try{u(s.next(e))}catch(a){r(a)}},o=e=>{try{u(s.throw(e))}catch(a){r(a)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(t,o);u((s=s.apply(e,a)).next())}));var e,a,s};return(e,a)=>{const s=n("el-icon"),l=n("el-input"),r=n("el-form-item"),t=n("el-button"),h=n("el-form"),w=n("el-card");return i(),o("div",y,[u(w,{class:"login-card"},{default:d((()=>[a[2]||(a[2]=m("div",{class:"title"},"GOST 管理系统",-1)),u(h,{model:U,rules:j,ref_key:"loginFormRef",ref:V,class:"login-form",onSubmit:p(k,["prevent"])},{default:d((()=>[u(r,{prop:"username"},{default:d((()=>[u(l,{modelValue:U.username,"onUpdate:modelValue":a[0]||(a[0]=e=>U.username=e),placeholder:"请输入用户名"},{prefix:d((()=>[u(s,null,{default:d((()=>[u(c(g))])),_:1})])),_:1},8,["modelValue"])])),_:1}),u(r,{prop:"password"},{default:d((()=>[u(l,{modelValue:U.password,"onUpdate:modelValue":a[1]||(a[1]=e=>U.password=e),type:"password",placeholder:"请输入密码","show-password":""},{prefix:d((()=>[u(s,null,{default:d((()=>[u(c(f))])),_:1})])),_:1},8,["modelValue"])])),_:1}),u(r,null,{default:d((()=>[u(t,{type:"primary",loading:q.value,"native-type":"submit",class:"login-button"},{default:d((()=>[_(v(q.value?"登录中...":"登录"),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1,__:[2]})])}}},[["__scopeId","data-v-d4f89640"]]);export{w as default};
