var e=(e,l,t)=>new Promise(((a,s)=>{var n=e=>{try{u(t.next(e))}catch(l){s(l)}},i=e=>{try{u(t.throw(e))}catch(l){s(l)}},u=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);u((t=t.apply(e,l)).next())}));import{s as l}from"./api-40a21d9f.js";import{_ as t,r as a,n as s,J as n,d as i,g as u,e as d,w as r,E as c,f as o,o as v,k as p,t as y,C as g}from"./index-e35aab08.js";const h={class:"system-settings"},f={class:"settings-section"},m={class:"setting-item"},w={class:"setting-control"},P={class:"setting-item"},x={class:"setting-info"},I={class:"status-info"},_={class:"status-details"},b={key:0},C={key:1},E={class:"help-section"},T={class:"security-notice"},k=t({__name:"SystemSettings",setup(t){const k=a(!1),A=a(!1),B=a(!1),S=[{address:"0.0.0.0:端口",type:"IPv4",external:!0,description:"监听所有IPv4接口，外部设备可以访问"},{address:"127.0.0.1:端口",type:"IPv4",external:!1,description:"仅监听IPv4回环接口，只有本机可以访问"},{address:"[::]:端口",type:"IPv6",external:!0,description:"监听所有IPv6接口，外部设备可以访问"},{address:"[::1]:端口",type:"IPv6",external:!1,description:"仅监听IPv6回环接口，只有本机可以访问"}],U=()=>e(this,null,(function*(){try{B.value=!0;const e=(yield l.getConfig("allowUserExternalAccess")).data.value;let t=!1;t=!0===e||"true"===e||1===e||"1"===e||!1!==e&&"false"!==e&&0!==e&&"0"!==e&&Boolean(e),k.value=t,yield new Promise((e=>setTimeout(e,0)))}catch(e){c.error("加载配置失败"),k.value=!1}finally{B.value=!1}})),V=t=>e(this,null,(function*(){if(!B.value)try{yield g.confirm(`确定要${t?"启用":"禁用"}普通用户外部访问吗？\n\n${t?"启用后，普通用户的转发规则将监听所有网络接口，外部设备可以访问。":"禁用后，普通用户的转发规则将仅监听本地接口，外部设备无法访问。"}\n\n此操作将立即生效并重新生成GOST配置。`,"确认配置变更",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),A.value=!0;yield l.updateConfig("allowUserExternalAccess",{value:t,description:"允许普通用户的转发规则被外部访问",category:"security"});k.value=t,c.success(`已${t?"启用":"禁用"}普通用户外部访问`)}catch(e){"cancel"!==e?(c.error("更新配置失败"),yield U()):yield U()}finally{A.value=!1}})),$=()=>{document.hidden||B.value||A.value||U()};return s((()=>{U(),document.addEventListener("visibilitychange",$)})),n((()=>{document.removeEventListener("visibilitychange",$)})),(e,l)=>{const t=o("el-switch"),a=o("el-tag"),s=o("el-card"),n=o("el-table-column"),c=o("el-table"),g=o("el-alert");return v(),i("div",h,[l[12]||(l[12]=u("div",{class:"page-header"},[u("h1",null,"系统设置"),u("p",null,"管理系统全局配置和安全策略")],-1)),d(s,{class:"settings-card"},{header:r((()=>l[1]||(l[1]=[u("div",{class:"card-header"},[u("span",null,"🔒 安全配置")],-1)]))),default:r((()=>[u("div",f,[u("div",m,[l[2]||(l[2]=u("div",{class:"setting-info"},[u("h3",null,"普通用户外部访问控制"),u("p",{class:"setting-description"},[p(" 控制普通用户创建的转发规则是否允许外部IP访问。 "),u("br"),u("strong",null,"启用"),p("：普通用户规则监听所有接口 (0.0.0.0)，外部可访问 "),u("br"),u("strong",null,"禁用"),p("：普通用户规则仅监听本地接口 (127.0.0.1)，仅本地访问 "),u("br"),u("em",null,"注意：管理员用户不受此限制，始终允许外部访问")])],-1)),u("div",w,[d(t,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value=e),loading:A.value,"active-text":"允许","inactive-text":"禁止","active-color":"#67C23A","inactive-color":"#F56C6C",onChange:V},null,8,["modelValue","loading"])])]),u("div",P,[u("div",x,[l[8]||(l[8]=u("h3",null,"当前配置状态",-1)),u("div",I,[d(a,{type:k.value?"success":"warning",size:"large"},{default:r((()=>[p(y(k.value?"✅ 允许外部访问":"🔒 仅本地访问"),1)])),_:1},8,["type"]),u("div",_,[l[5]||(l[5]=u("p",null,[u("strong",null,"管理员用户规则：")],-1)),l[6]||(l[6]=u("ul",null,[u("li",null,[p("IPv4: "),u("code",null,"0.0.0.0:端口"),p(" (所有接口)")]),u("li",null,[p("IPv6: "),u("code",null,"[::]:端口"),p(" (所有接口)")])],-1)),l[7]||(l[7]=u("p",null,[u("strong",null,"普通用户规则：")],-1)),k.value?(v(),i("ul",b,l[3]||(l[3]=[u("li",null,[p("IPv4: "),u("code",null,"0.0.0.0:端口"),p(" (所有接口)")],-1),u("li",null,[p("IPv6: "),u("code",null,"[::]:端口"),p(" (所有接口)")],-1)]))):(v(),i("ul",C,l[4]||(l[4]=[u("li",null,[p("IPv4: "),u("code",null,"127.0.0.1:端口"),p(" (仅本地)")],-1),u("li",null,[p("IPv6: "),u("code",null,"[::1]:端口"),p(" (仅本地)")],-1)])))])])])])])])),_:1}),d(s,{class:"settings-card"},{header:r((()=>l[9]||(l[9]=[u("div",{class:"card-header"},[u("span",null,"ℹ️ 配置说明")],-1)]))),default:r((()=>[u("div",E,[l[11]||(l[11]=u("h3",null,"网络监听地址说明",-1)),d(c,{data:S,style:{width:"100%"}},{default:r((()=>[d(n,{prop:"address",label:"监听地址",width:"200"},{default:r((e=>[u("code",null,y(e.row.address),1)])),_:1}),d(n,{prop:"type",label:"类型",width:"100"}),d(n,{prop:"external",label:"外部访问",width:"100"},{default:r((e=>[d(a,{type:e.row.external?"success":"danger",size:"small"},{default:r((()=>[p(y(e.row.external?"✅ 可访问":"❌ 不可访问"),1)])),_:2},1032,["type"])])),_:1}),d(n,{prop:"description",label:"说明"})])),_:1}),u("div",T,[d(g,{title:"安全提醒",type:"warning",closable:!1,"show-icon":""},{default:r((()=>l[10]||(l[10]=[u("p",null,[u("strong",null,"启用外部访问的安全考虑：")],-1),u("ul",null,[u("li",null,"普通用户的转发端口将直接暴露到公网"),u("li",null,"请确保用户创建的转发规则是安全的"),u("li",null,"建议配合防火墙和端口范围限制使用"),u("li",null,"可以随时通过此开关禁用普通用户的外部访问")],-1)]))),_:1})])])])),_:1})])}}},[["__scopeId","data-v-969d0705"]]);export{k as default};
