var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&i(e,l,a[l]);return e},n=(e,t)=>a(e,l(t)),d=(e,a,l)=>new Promise(((t,r)=>{var s=e=>{try{o(l.next(e))}catch(a){r(a)}},i=e=>{try{o(l.throw(e))}catch(a){r(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,i);o((l=l.apply(e,a)).next())}));import{_ as u,B as c,a as f,u as m,r as p,m as g,c as v,n as y,d as w,g as h,q as _,w as b,s as x,y as V,e as P,E as k,p as R,C as U,f as C,v as E,o as T,k as S,t as B,z as D,F as A,D as G}from"./index-9f3a3f15.js";import{a as Q}from"./api-25d551a2.js";const M={class:"user-management"},$={class:"page-header"},j={class:"table-container"},F={key:0,class:"text-muted"},O={key:1},z={key:0,class:"port-range"},q={key:1,class:"additional-ports"},Y={key:2,class:"text-muted"},I={key:0,class:"text-success"},H={key:1},N={key:2,class:"text-muted"},L={key:0},J={class:"traffic-usage"},K={class:"used"},W={class:"traffic-type"},X={key:1},Z={class:"traffic-usage"},ee={class:"used"},ae={class:"quota"},le={class:"remaining"},te={class:"traffic-type"},re={key:2,class:"text-muted"},se={key:1,class:"text-muted"},ie={key:0,class:"form-tip"},oe={style:{display:"flex",gap:"10px","align-items":"center"}},ne={key:0,class:"conflict-message"},de={key:0,class:"form-tip"},ue={class:"reset-traffic-content"},ce={class:"user-info"},fe={class:"traffic-info"},me={class:"rules-info"};const pe=u({name:"UserManagement",components:{Plus:c},setup(){const e=f(),a=m(),l=p(!1),t=p(!1),r=p(!1),s=p(!1),i=p([]),u=p(!1),c=p(!1),w=p(!1),h=p(!1),_=p(null),b=p(null),x=p(1),V=p(""),P=p(null),C=p(""),E=p(!1),T=g((()=>a.getters["user/currentUser"])),S=g((()=>a.getters["user/isAdmin"])),B=g((()=>S.value?i.value:i.value.filter((e=>{var a;return e.id===(null==(a=T.value)?void 0:a.id)})))),D=v({username:"",email:"",password:"",newPassword:"",role:"user",portRangeStart:null,portRangeEnd:null,additionalPorts:[],expiryDate:null,trafficQuota:100,isActive:!0}),A=g((()=>h.value?"ç¼–è¾‘ç”¨æˆ·":"æ·»åŠ ç”¨æˆ·")),G=e=>{var a;return!!S.value||e.id===(null==(a=T.value)?void 0:a.id)},M=g((()=>{const e={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:["blur","change"]},{min:3,max:30,message:"ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 30 ä¸ªå­—ç¬¦",trigger:["blur","change"]}],email:[{type:"email",message:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€",trigger:"blur"}],role:[{required:!0,message:"è¯·é€‰æ‹©è§’è‰²",trigger:"change"}]};return h.value||(e.password=[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç é•¿åº¦ä¸èƒ½å°‘äº 6 ä¸ªå­—ç¬¦",trigger:"blur"}]),"user"===D.role&&(e.portRange=[{validator:(e,a,l)=>{D.portRangeStart&&D.portRangeEnd?D.portRangeStart>=D.portRangeEnd?l(new Error("èµ·å§‹ç«¯å£å¿…é¡»å°äºç»“æŸç«¯å£")):l():l(new Error("è¯·è®¾ç½®ç«¯å£èŒƒå›´"))},trigger:["blur","change"]}],e.trafficQuota=[{required:!0,message:"è¯·è®¾ç½®æµé‡é™é¢",trigger:"blur"},{type:"number",min:.001,max:10240,message:"æµé‡é™é¢èŒƒå›´åœ¨ 0.001-10240 GB",trigger:"blur"}]),e}));let $=null;const j=()=>{$&&clearTimeout($),$=setTimeout((()=>{F()}),500)},F=()=>d(this,null,(function*(){if(!D.portRangeStart||!D.portRangeEnd||"user"!==D.role)return C.value="",void(E.value=!1);if(D.portRangeStart>=D.portRangeEnd)return C.value="èµ·å§‹ç«¯å£å¿…é¡»å°äºç»“æŸç«¯å£",void(E.value=!0);try{const e=h.value?_.value.id:null,a=yield Q.post("/users/check-port-conflicts",{portRangeStart:D.portRangeStart,portRangeEnd:D.portRangeEnd,excludeUserId:e});if(a.data.hasConflict){const e=a.data.conflicts.map((e=>"user_range"===e.type?`ä¸ç”¨æˆ· "${e.username}" çš„ç«¯å£èŒƒå›´ ${e.portRange} é‡å `:"used_port"===e.type?`ç«¯å£ ${e.port} å·²è¢«ç”¨æˆ· "${e.username}" çš„è§„åˆ™å ç”¨`:e.message));C.value=`ç«¯å£é…ç½®å†²çªï¼š${e.join("ï¼›")}`,E.value=!0}else C.value="",E.value=!1}catch(e){C.value="",E.value=!1}})),O=()=>d(this,null,(function*(){var e,a;l.value=!0;try{const e=yield Q.users.getUsers();i.value=e.data.map((e=>{const a=(e.usedTraffic/1073741824).toFixed(2);if("admin"===e.role)return n(o({},e),{trafficStats:{usedTrafficGB:parseFloat(a),trafficQuotaGB:null,usagePercent:0,remainingGB:"æ— é™åˆ¶"}});const l=e.trafficQuota||0,t=l>0?Math.min(e.usedTraffic/(1024*l*1024*1024)*100,100):0,r=l>0?Math.max(l-parseFloat(a),0).toFixed(2)+"GB":"Unlimited";return n(o({},e),{trafficStats:{usedTrafficGB:parseFloat(a),trafficQuotaGB:l,usagePercent:Math.round(t),remainingGB:r}})}))}catch(t){k.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message))}finally{l.value=!1}})),z=e=>{if(!e||!e.additionalPorts)return[];if(Array.isArray(e.additionalPorts))return e.additionalPorts;if("string"==typeof e.additionalPorts)try{const a=JSON.parse(e.additionalPorts);return Array.isArray(a)?a:[]}catch(a){return[]}return[]};return y((()=>{O()})),{loading:l,submitting:t,extending:r,resettingTraffic:s,users:i,displayUsers:B,dialogVisible:u,extendDialogVisible:c,resetTrafficDialogVisible:w,isEdit:h,isAdmin:S,currentUser:_,resetTrafficUser:b,extendMonths:x,resetTrafficReason:V,form:D,rules:M,formRef:P,dialogTitle:A,portConflictMessage:C,hasPortConflict:E,canEditUser:G,loadUsers:O,handleAdd:()=>{S.value?(h.value=!1,u.value=!0):k.error("æ²¡æœ‰æƒé™æ·»åŠ ç”¨æˆ·")},handleEdit:e=>{G(e)?(h.value=!0,_.value=e,Object.assign(D,{username:e.username,email:e.email,password:"",newPassword:"",role:e.role,portRangeStart:e.portRangeStart,portRangeEnd:e.portRangeEnd,additionalPorts:z(e),expiryDate:e.expiryDate,trafficQuota:e.trafficQuota||1,isActive:e.isActive}),C.value="",E.value=!1,u.value=!0,R((()=>{P.value&&(P.value.clearValidate(),setTimeout((()=>{D.username&&P.value.validateField("username"),"user"===D.role&&D.portRangeStart&&D.portRangeEnd&&(P.value.validateField("portRange"),j()),"user"===D.role&&D.trafficQuota&&P.value.validateField("trafficQuota")}),100))}))):k.error("æ²¡æœ‰æƒé™ç¼–è¾‘æ­¤ç”¨æˆ·")},handleSubmit:()=>d(this,null,(function*(){var e,a,l,r,s,i,n;if(P.value){try{yield P.value.validate()}catch(d){return}if(E.value)k.error("å­˜åœ¨ç«¯å£å†²çªï¼Œè¯·ä¿®æ”¹ç«¯å£èŒƒå›´");else{t.value=!0;try{const e=o({},D);e.additionalPorts&&Array.isArray(e.additionalPorts)?e.additionalPorts=e.additionalPorts.map((e=>"string"==typeof e?parseInt(e):e)).filter((e=>!isNaN(e)&&e>0&&e<=65535)):e.additionalPorts=[],h.value?(S.value&&D.newPassword?e.password=D.newPassword:delete e.password,delete e.newPassword,yield Q.users.updateUser(_.value.id,e),k.success("ç”¨æˆ·æ›´æ–°æˆåŠŸ")):(yield Q.users.createUser(e),k.success("ç”¨æˆ·åˆ›å»ºæˆåŠŸ")),u.value=!1,yield O()}catch(c){if(400===(null==(e=c.response)?void 0:e.status)&&(null==(l=null==(a=c.response)?void 0:a.data)?void 0:l.needsConfirmation)&&"admin"===D.username&&D.newPassword)try{yield U.confirm(c.response.data.warning||"è­¦å‘Šï¼šä¿®æ”¹ç®¡ç†å‘˜å¯†ç åï¼Œå¦‚æœå¿˜è®°å¯†ç å°†æ— æ³•é€šè¿‡ç•Œé¢æ‰¾å›ã€‚æ‰¾å›ç®¡ç†å‘˜å¯†ç éœ€è¦é€šè¿‡æœåŠ¡å™¨å‘½ä»¤è¡Œæ“ä½œã€‚è¯·ç¡®è®¤æ‚¨å·²ç»è®°ä½äº†æ–°å¯†ç ã€‚","ç¡®è®¤ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ",{confirmButtonText:"ç¡®è®¤ä¿®æ”¹",cancelButtonText:"å–æ¶ˆ",type:"warning",dangerouslyUseHTMLString:!1});const e=o({},D);e.additionalPorts&&Array.isArray(e.additionalPorts)?e.additionalPorts=e.additionalPorts.map((e=>"string"==typeof e?parseInt(e):e)).filter((e=>!isNaN(e)&&e>0&&e<=65535)):e.additionalPorts=[],S.value&&D.newPassword?e.password=D.newPassword:delete e.password,delete e.newPassword,e.confirmAdminPasswordChange=!0,yield Q.users.updateUser(_.value.id,e),k.success("ç®¡ç†å‘˜å¯†ç ä¿®æ”¹æˆåŠŸ"),u.value=!1,yield O()}catch(f){"cancel"!==f&&k.error("ä¿®æ”¹å¯†ç å¤±è´¥: "+((null==(s=null==(r=f.response)?void 0:r.data)?void 0:s.message)||f.message))}else k.error("æ“ä½œå¤±è´¥: "+((null==(n=null==(i=c.response)?void 0:i.data)?void 0:n.message)||c.message))}finally{t.value=!1}}}})),handleDelete:e=>d(this,null,(function*(){var a,l;if(S.value)if("admin"!==e.username)try{yield U.confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${e.username}" å—ï¼Ÿæ­¤æ“ä½œå°†åŒæ—¶åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰è½¬å‘è§„åˆ™ã€‚`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),yield Q.users.deleteUser(e.id),k.success("ç”¨æˆ·åˆ é™¤æˆåŠŸ"),yield O()}catch(t){"cancel"!==t&&k.error("åˆ é™¤ç”¨æˆ·å¤±è´¥: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message))}else k.error("ä¸èƒ½åˆ é™¤adminç”¨æˆ·");else k.error("æ²¡æœ‰æƒé™åˆ é™¤ç”¨æˆ·")})),handleExtendExpiry:e=>{S.value?(_.value=e,x.value=1,c.value=!0):k.error("æ²¡æœ‰æƒé™å»¶é•¿ç”¨æˆ·è¿‡æœŸæ—¶é—´")},confirmExtendExpiry:()=>d(this,null,(function*(){var e,a;r.value=!0;try{yield Q.users.extendUserExpiry(_.value.id,{months:x.value}),k.success(`æˆåŠŸå»¶é•¿ ${x.value} ä¸ªæœˆ`),c.value=!1,yield O()}catch(l){k.error("å»¶é•¿è¿‡æœŸæ—¶é—´å¤±è´¥: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}finally{r.value=!1}})),viewUserRules:a=>{e.push({name:"UserForwardRules",query:{userId:a.id}})},handleResetTraffic:e=>{S.value?(b.value=e,V.value="",w.value=!0):k.error("æ²¡æœ‰æƒé™é‡ç½®ç”¨æˆ·æµé‡")},confirmResetTraffic:()=>d(this,null,(function*(){var e,a;if(b.value)try{yield U.confirm(`ç¡®å®šè¦é‡ç½®ç”¨æˆ· "${b.value.username}" çš„æµé‡ç»Ÿè®¡å—ï¼Ÿ\n\næ­¤æ“ä½œå°†ï¼š\nâ€¢ ç”¨æˆ·æ€»æµé‡å½’é›¶\nâ€¢ æ‰€æœ‰è§„åˆ™æµé‡å½’é›¶\nâ€¢ æ¸…ç†å†å²æµé‡è®°å½•\nâ€¢ ä¿ç•™æ‰€æœ‰è½¬å‘è§„åˆ™\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`,"ç¡®è®¤é‡ç½®æµé‡",{confirmButtonText:"ç¡®è®¤é‡ç½®",cancelButtonText:"å–æ¶ˆ",type:"warning",dangerouslyUseHTMLString:!1}),s.value=!0;const e=yield Q.users.resetUserTraffic(b.value.id,{reason:V.value||"ç®¡ç†å‘˜é‡ç½®"});if(e.data.success){k.success({message:`æˆåŠŸé‡ç½®ç”¨æˆ· ${b.value.username} çš„æµé‡ç»Ÿè®¡`,duration:5e3});e.data.data.resetSummary;w.value=!1,yield O()}else k.error("é‡ç½®æµé‡å¤±è´¥: "+(e.data.message||"æœªçŸ¥é”™è¯¯"))}catch(l){"cancel"!==l&&k.error("é‡ç½®æµé‡å¤±è´¥: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}finally{s.value=!1}})),resetForm:()=>{Object.assign(D,{username:"",email:"",password:"",newPassword:"",role:"user",portRangeStart:null,portRangeEnd:null,additionalPorts:[],expiryDate:null,trafficQuota:1,isActive:!0}),C.value="",E.value=!1,P.value&&P.value.clearValidate()},checkPortConflictsDebounced:j,formatQuota:e=>{if(!e||0===e)return"0GB";if(e>=1&&e%1==0)return`${e}GB`;if(e>=1)return`${e}GB`;if(e>=.001){const a=1024*e;return a>=1&&a%1==0?`${a}MB`:`${e}GB`}return`${e}GB`},getAdditionalPorts:z}}},[["render",function(e,a,l,t,r,s){const i=C("Plus"),o=C("el-icon"),n=C("el-button"),d=C("el-table-column"),u=C("el-tag"),c=C("el-tooltip"),f=C("el-progress"),m=C("el-button-group"),p=C("el-table"),g=C("el-input"),v=C("el-form-item"),y=C("el-option"),k=C("el-select"),R=C("el-input-number"),U=C("el-date-picker"),Q=C("el-switch"),pe=C("el-form"),ge=C("el-dialog"),ve=C("el-alert"),ye=E("loading");return T(),w("div",M,[h("div",$,[a[21]||(a[21]=h("h2",null,"ç”¨æˆ·ç®¡ç†",-1)),t.isAdmin?(T(),_(n,{key:0,type:"primary",onClick:t.handleAdd},{default:b((()=>[P(o,null,{default:b((()=>[P(i)])),_:1}),a[20]||(a[20]=S(" æ·»åŠ ç”¨æˆ· "))])),_:1,__:[20]},8,["onClick"])):x("",!0)]),h("div",j,[V((T(),_(p,{data:t.displayUsers,border:"",style:{width:"100%"},class:"user-table"},{default:b((()=>[P(d,{prop:"id",label:"ID",width:"80"}),P(d,{prop:"username",label:"ç”¨æˆ·å",width:"120"}),P(d,{prop:"email",label:"é‚®ç®±",width:"180"}),P(d,{label:"ç«¯å£é…ç½®",width:"200"},{default:b((({row:e})=>["admin"===e.role?(T(),w("div",F," ç®¡ç†å‘˜ (æ— é™åˆ¶) ")):(T(),w("div",O,[e.portRangeStart&&e.portRangeEnd?(T(),w("div",z," èŒƒå›´: "+B(e.portRangeStart)+"-"+B(e.portRangeEnd),1)):x("",!0),t.getAdditionalPorts(e).length>0?(T(),w("div",q," é¢å¤–: "+B(t.getAdditionalPorts(e).join(", ")),1)):x("",!0),e.portRangeStart||e.portRangeEnd||0!==t.getAdditionalPorts(e).length?x("",!0):(T(),w("div",Y," æœªè®¾ç½® "))]))])),_:1}),P(d,{label:"æµé‡é™é¢",width:"100"},{default:b((({row:e})=>["admin"===e.role?(T(),w("span",I,"æ— é™åˆ¶")):e.trafficQuota?(T(),w("span",H,B(t.formatQuota(e.trafficQuota)),1)):(T(),w("span",N,"æœªè®¾ç½®"))])),_:1}),P(d,{label:"æµé‡ä½¿ç”¨ (åŒå‘)",width:"180"},{default:b((({row:e})=>["admin"===e.role?(T(),w("div",L,[h("div",J,[h("span",K,B(e.trafficStats?e.trafficStats.usedTrafficGB:0)+"GB",1),a[22]||(a[22]=h("span",{class:"separator"},"/",-1)),a[23]||(a[23]=h("span",{class:"quota text-success"},"æ— é™åˆ¶",-1))]),a[25]||(a[25]=h("div",{class:"remaining text-success"}," æ— é™åˆ¶ ",-1)),h("div",W,[P(c,{content:"ç®¡ç†å‘˜ç”¨æˆ·ä¸å—æµé‡é™åˆ¶",placement:"top"},{default:b((()=>[P(u,{size:"small",type:"success"},{default:b((()=>a[24]||(a[24]=[S("ç®¡ç†å‘˜")]))),_:1,__:[24]})])),_:1})])])):e.trafficStats?(T(),w("div",X,[h("div",Z,[h("span",ee,B(e.trafficStats.usedTrafficGB)+"GB",1),a[26]||(a[26]=h("span",{class:"separator"},"/",-1)),h("span",ae,B(t.formatQuota(e.trafficStats.trafficQuotaGB)||"Unlimited"),1)]),P(f,{percentage:e.trafficStats.usagePercent,status:e.trafficStats.usagePercent>=90?"exception":e.trafficStats.usagePercent>=70?"warning":"success","stroke-width":6,"show-text":!1},null,8,["percentage","status"]),h("div",le," å‰©ä½™: "+B(e.trafficStats.remainingGB),1),h("div",te,[P(c,{content:"åŒ…å«ä¸Šè¡Œæµé‡(å®¢æˆ·ç«¯â†’æœåŠ¡å™¨)å’Œä¸‹è¡Œæµé‡(æœåŠ¡å™¨â†’å®¢æˆ·ç«¯)",placement:"top"},{default:b((()=>[P(u,{size:"small",type:"info"},{default:b((()=>a[27]||(a[27]=[S("åŒå‘æµé‡")]))),_:1,__:[27]})])),_:1})])])):(T(),w("span",re,"æ— æ•°æ®"))])),_:1}),P(d,{label:"è¿‡æœŸæ—¶é—´",width:"120"},{default:b((({row:e})=>[e.expiryDate?(T(),w("span",{key:0,class:D({expired:e.isExpired})},B(new Date(e.expiryDate).toLocaleDateString()),3)):(T(),w("span",se,"æ°¸ä¸è¿‡æœŸ")),e.isExpired?(T(),_(u,{key:2,type:"danger",size:"small",style:{"margin-left":"5px"}},{default:b((()=>a[28]||(a[28]=[S(" å·²è¿‡æœŸ ")]))),_:1,__:[28]})):x("",!0)])),_:1}),P(d,{label:"è½¬å‘è§„åˆ™",width:"100"},{default:b((({row:e})=>[h("span",null,B(e.activeRuleCount||0)+"/"+B(e.forwardRuleCount||0),1)])),_:1}),P(d,{prop:"role",label:"è§’è‰²",width:"100"},{default:b((({row:e})=>[P(u,{type:"admin"===e.role?"danger":"success"},{default:b((()=>[S(B("admin"===e.role?"ç®¡ç†å‘˜":"æ™®é€šç”¨æˆ·"),1)])),_:2},1032,["type"])])),_:1}),P(d,{prop:"isActive",label:"çŠ¶æ€",width:"80"},{default:b((({row:e})=>[P(u,{type:e.isActive?"success":"info"},{default:b((()=>[S(B(e.isActive?"å¯ç”¨":"ç¦ç”¨"),1)])),_:2},1032,["type"])])),_:1}),P(d,{label:"æ“ä½œ",width:"280",fixed:"right"},{default:b((({row:e})=>[P(m,null,{default:b((()=>[t.canEditUser(e)?(T(),_(n,{key:0,type:"primary",size:"small",onClick:a=>t.handleEdit(e)},{default:b((()=>a[29]||(a[29]=[S(" ç¼–è¾‘ ")]))),_:2,__:[29]},1032,["onClick"])):x("",!0),"admin"!==e.role&&t.isAdmin?(T(),_(n,{key:1,type:"warning",size:"small",onClick:a=>t.handleExtendExpiry(e)},{default:b((()=>a[30]||(a[30]=[S(" ç»­æœŸ ")]))),_:2,__:[30]},1032,["onClick"])):x("",!0),P(n,{type:"info",size:"small",onClick:a=>t.viewUserRules(e)},{default:b((()=>a[31]||(a[31]=[S(" è§„åˆ™ ")]))),_:2,__:[31]},1032,["onClick"]),t.isAdmin?(T(),_(n,{key:2,type:"warning",size:"small",onClick:a=>t.handleResetTraffic(e),title:`é‡ç½® ${e.username} çš„æµé‡ç»Ÿè®¡`},{default:b((()=>a[32]||(a[32]=[S(" é‡ç½®æµé‡ ")]))),_:2,__:[32]},1032,["onClick","title"])):x("",!0),"admin"!==e.username&&t.isAdmin?(T(),_(n,{key:3,type:"danger",size:"small",onClick:a=>t.handleDelete(e),disabled:"admin"===e.username},{default:b((()=>a[33]||(a[33]=[S(" åˆ é™¤ ")]))),_:2,__:[33]},1032,["onClick","disabled"])):x("",!0)])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[ye,t.loading]])]),P(ge,{title:t.dialogTitle,modelValue:t.dialogVisible,"onUpdate:modelValue":a[13]||(a[13]=e=>t.dialogVisible=e),width:"600px",onClose:t.resetForm},{footer:b((()=>[P(n,{onClick:a[12]||(a[12]=e=>t.dialogVisible=!1)},{default:b((()=>a[42]||(a[42]=[S("å–æ¶ˆ")]))),_:1,__:[42]}),P(n,{type:"primary",onClick:t.handleSubmit,loading:t.submitting,disabled:t.hasPortConflict},{default:b((()=>[S(B(t.isEdit?"æ›´æ–°":"åˆ›å»º"),1)])),_:1},8,["onClick","loading","disabled"])])),default:b((()=>[P(pe,{ref:"formRef",model:t.form,rules:t.rules,"label-width":"120px"},{default:b((()=>[P(v,{label:"ç”¨æˆ·å",prop:"username"},{default:b((()=>[P(g,{modelValue:t.form.username,"onUpdate:modelValue":a[0]||(a[0]=e=>t.form.username=e),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",disabled:t.isEdit},null,8,["modelValue","disabled"]),t.isEdit?(T(),w("div",ie," ç”¨æˆ·ååˆ›å»ºåä¸å¯ä¿®æ”¹ ")):x("",!0)])),_:1}),P(v,{label:"é‚®ç®±",prop:"email"},{default:b((()=>[P(g,{modelValue:t.form.email,"onUpdate:modelValue":a[1]||(a[1]=e=>t.form.email=e),placeholder:"è¯·è¾“å…¥é‚®ç®±"},null,8,["modelValue"])])),_:1}),t.isEdit&&t.isAdmin&&"admin"!==t.form.username?(T(),_(v,{key:0,label:"é‡ç½®å¯†ç ",prop:"newPassword"},{default:b((()=>[P(g,{modelValue:t.form.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.newPassword=e),type:"password",placeholder:"è¾“å…¥æ–°å¯†ç ï¼ˆç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹ï¼‰","show-password":"",clearable:""},null,8,["modelValue"]),a[34]||(a[34]=h("div",{class:"form-tip"}," ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹å¯†ç ï¼Œè¾“å…¥æ–°å¯†ç å°†é‡ç½®ç”¨æˆ·å¯†ç  ",-1))])),_:1,__:[34]})):x("",!0),t.isEdit?x("",!0):(T(),_(v,{key:1,label:"å¯†ç ",prop:"password"},{default:b((()=>[P(g,{modelValue:t.form.password,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.password=e),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ","show-password":""},null,8,["modelValue"])])),_:1})),t.isEdit&&"admin"===t.form.username?(T(),_(v,{key:2,label:"æ–°å¯†ç ",prop:"newPassword"},{default:b((()=>[P(g,{modelValue:t.form.newPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>t.form.newPassword=e),type:"password",placeholder:"ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹å¯†ç ","show-password":""},null,8,["modelValue"]),a[35]||(a[35]=h("div",{class:"form-tip"}," ä¿®æ”¹ç®¡ç†å‘˜å¯†ç éœ€è¦äºŒæ¬¡ç¡®è®¤ï¼Œè¯·è°¨æ…æ“ä½œ ",-1))])),_:1,__:[35]})):x("",!0),P(v,{label:"è§’è‰²",prop:"role"},{default:b((()=>[P(k,{modelValue:t.form.role,"onUpdate:modelValue":a[5]||(a[5]=e=>t.form.role=e),style:{width:"100%"},disabled:t.isEdit},{default:b((()=>[P(y,{label:"æ™®é€šç”¨æˆ·",value:"user"}),P(y,{label:"ç®¡ç†å‘˜",value:"admin"})])),_:1},8,["modelValue","disabled"]),a[36]||(a[36]=h("div",{class:"form-tip"}," è§’è‰²åˆ›å»ºåä¸å¯ä¿®æ”¹ï¼Œç¡®ä¿åªæœ‰adminç”¨æˆ·ä¸ºç®¡ç†å‘˜ ",-1))])),_:1,__:[36]}),"user"===t.form.role?(T(),_(v,{key:3,label:"ç«¯å£èŒƒå›´",prop:"portRange"},{default:b((()=>[h("div",oe,[P(R,{modelValue:t.form.portRangeStart,"onUpdate:modelValue":a[6]||(a[6]=e=>t.form.portRangeStart=e),min:1,max:65535,placeholder:"èµ·å§‹ç«¯å£",style:{width:"150px"},onChange:t.checkPortConflictsDebounced},null,8,["modelValue","onChange"]),a[37]||(a[37]=h("span",null,"-",-1)),P(R,{modelValue:t.form.portRangeEnd,"onUpdate:modelValue":a[7]||(a[7]=e=>t.form.portRangeEnd=e),min:1,max:65535,placeholder:"ç»“æŸç«¯å£",style:{width:"150px"},onChange:t.checkPortConflictsDebounced},null,8,["modelValue","onChange"])]),a[38]||(a[38]=h("div",{class:"form-tip"}," è®¾ç½®è¿ç»­ç«¯å£èŒƒå›´ï¼Œä¾‹å¦‚ï¼š10001-10100 ",-1)),t.portConflictMessage?(T(),w("div",ne,B(t.portConflictMessage),1)):x("",!0)])),_:1,__:[38]})):x("",!0),"user"===t.form.role?(T(),_(v,{key:4,label:"é¢å¤–ç«¯å£"},{default:b((()=>[P(k,{modelValue:t.form.additionalPorts,"onUpdate:modelValue":a[8]||(a[8]=e=>t.form.additionalPorts=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"è¾“å…¥é¢å¤–ç«¯å£å·ï¼ŒæŒ‰å›è½¦æ·»åŠ ",style:{width:"100%"},onChange:t.checkPortConflictsDebounced},{default:b((()=>[(T(!0),w(A,null,G(t.form.additionalPorts,(e=>(T(),_(y,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),a[39]||(a[39]=h("div",{class:"form-tip"}," å¯é€‰ï¼šæ·»åŠ é¢å¤–çš„å•ç‹¬ç«¯å£ï¼Œä¾‹å¦‚ï¼š12001, 12005, 12008 ",-1))])),_:1,__:[39]})):x("",!0),"user"===t.form.role?(T(),_(v,{key:5,label:"è¿‡æœŸæ—¶é—´"},{default:b((()=>[P(U,{modelValue:t.form.expiryDate,"onUpdate:modelValue":a[9]||(a[9]=e=>t.form.expiryDate=e),type:"datetime",placeholder:"é€‰æ‹©è¿‡æœŸæ—¶é—´",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"]),a[40]||(a[40]=h("div",{class:"form-tip"}," ç•™ç©ºè¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œæ–°ç”¨æˆ·é»˜è®¤ä¸€ä¸ªæœˆåè¿‡æœŸ ",-1))])),_:1,__:[40]})):x("",!0),"user"===t.form.role?(T(),_(v,{key:6,label:"æµé‡é™é¢",prop:"trafficQuota"},{default:b((()=>[P(R,{modelValue:t.form.trafficQuota,"onUpdate:modelValue":a[10]||(a[10]=e=>t.form.trafficQuota=e),min:.001,max:10240,step:.001,precision:3,placeholder:"GB",style:{width:"100%"}},null,8,["modelValue"]),a[41]||(a[41]=h("div",{class:"form-tip"}," å¿…é¡»è®¾ç½®æµé‡é™é¢ï¼Œå•ä½ï¼šGBï¼ŒèŒƒå›´ï¼š0.001-10240ï¼ˆæ”¯æŒå°æ•°ï¼Œå¦‚0.1GB=100MBï¼‰ ",-1))])),_:1,__:[41]})):x("",!0),P(v,{label:"çŠ¶æ€",prop:"isActive"},{default:b((()=>[P(Q,{modelValue:t.form.isActive,"onUpdate:modelValue":a[11]||(a[11]=e=>t.form.isActive=e),disabled:"admin"===t.form.username},null,8,["modelValue","disabled"]),"admin"===t.form.username?(T(),w("div",de," adminç”¨æˆ·çŠ¶æ€ä¸å¯ç¦ç”¨ ")):x("",!0)])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue","onClose"]),P(ge,{title:"å»¶é•¿ç”¨æˆ·è¿‡æœŸæ—¶é—´",modelValue:t.extendDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>t.extendDialogVisible=e),width:"400px"},{footer:b((()=>[P(n,{onClick:a[15]||(a[15]=e=>t.extendDialogVisible=!1)},{default:b((()=>a[43]||(a[43]=[S("å–æ¶ˆ")]))),_:1,__:[43]}),P(n,{type:"primary",onClick:t.confirmExtendExpiry,loading:t.extending},{default:b((()=>a[44]||(a[44]=[S(" ç¡®è®¤å»¶é•¿ ")]))),_:1,__:[44]},8,["onClick","loading"])])),default:b((()=>[P(pe,{"label-width":"100px"},{default:b((()=>[P(v,{label:"ç”¨æˆ·å"},{default:b((()=>{var e;return[h("span",null,B(null==(e=t.currentUser)?void 0:e.username),1)]})),_:1}),P(v,{label:"å½“å‰è¿‡æœŸæ—¶é—´"},{default:b((()=>{var e;return[h("span",null,B((null==(e=t.currentUser)?void 0:e.expiryDate)?new Date(t.currentUser.expiryDate).toLocaleString():"æ°¸ä¸è¿‡æœŸ"),1)]})),_:1}),P(v,{label:"å»¶é•¿æœˆæ•°"},{default:b((()=>[P(R,{modelValue:t.extendMonths,"onUpdate:modelValue":a[14]||(a[14]=e=>t.extendMonths=e),min:1,max:12,style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),P(ge,{title:"é‡ç½®ç”¨æˆ·æµé‡ç»Ÿè®¡",modelValue:t.resetTrafficDialogVisible,"onUpdate:modelValue":a[19]||(a[19]=e=>t.resetTrafficDialogVisible=e),width:"500px"},{footer:b((()=>[P(n,{onClick:a[18]||(a[18]=e=>t.resetTrafficDialogVisible=!1)},{default:b((()=>a[46]||(a[46]=[S("å–æ¶ˆ")]))),_:1,__:[46]}),P(n,{type:"danger",onClick:t.confirmResetTraffic,loading:t.resettingTraffic},{default:b((()=>a[47]||(a[47]=[S(" ç¡®è®¤é‡ç½® ")]))),_:1,__:[47]},8,["onClick","loading"])])),default:b((()=>[h("div",ue,[P(ve,{title:"é‡è¦æé†’",type:"warning",closable:!1,"show-icon":""},{default:b((()=>a[45]||(a[45]=[h("p",null,"æ­¤æ“ä½œå°†é‡ç½®ç”¨æˆ·çš„æ‰€æœ‰æµé‡ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š",-1),h("ul",null,[h("li",null,"âœ… ç”¨æˆ·æ€»æµé‡å½’é›¶"),h("li",null,"âœ… æ‰€æœ‰è§„åˆ™æµé‡å½’é›¶"),h("li",null,"âœ… æ¸…ç†å†å²æµé‡è®°å½•"),h("li",null,[S("ğŸ”’ "),h("strong",null,"ä¿ç•™æ‰€æœ‰è½¬å‘è§„åˆ™")])],-1),h("p",null,[h("strong",null,"æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…æ“ä½œï¼")],-1)]))),_:1}),P(pe,{"label-width":"100px",style:{"margin-top":"20px"}},{default:b((()=>[P(v,{label:"ç”¨æˆ·å"},{default:b((()=>{var e;return[h("span",ce,B(null==(e=t.resetTrafficUser)?void 0:e.username),1)]})),_:1}),P(v,{label:"å½“å‰æµé‡"},{default:b((()=>{var e,a,l,r;return[h("span",fe,B((null==(a=null==(e=t.resetTrafficUser)?void 0:e.trafficStats)?void 0:a.usedTrafficGB)||0)+"GB / "+B(t.formatQuota(null==(r=null==(l=t.resetTrafficUser)?void 0:l.trafficStats)?void 0:r.trafficQuotaGB)||"Unlimited"),1)]})),_:1}),P(v,{label:"è½¬å‘è§„åˆ™"},{default:b((()=>{var e;return[h("span",me,B((null==(e=t.resetTrafficUser)?void 0:e.forwardRuleCount)||0)+" ä¸ªè§„åˆ™å°†è¢«ä¿ç•™ ",1)]})),_:1}),P(v,{label:"é‡ç½®åŸå› "},{default:b((()=>[P(g,{modelValue:t.resetTrafficReason,"onUpdate:modelValue":a[17]||(a[17]=e=>t.resetTrafficReason=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥é‡ç½®åŸå› ï¼ˆå¯é€‰ï¼‰",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-02e8c167"]]);export{pe as default};
