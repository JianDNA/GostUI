import{G as e,H as t,ag as r,y as o,J as a,aw as s,ax as n,ay as l,c as i,z as c,A as d,P as u,L as m,M as p,u as f,K as g,T as h,az as _,aA as v,at as E}from"./vue-55dd3248.js";import{a as S}from"./utils-d4f80f06.js";import{E as T,a as w,m as y,u as I,l as b,b as A,c as R,s as L,t as U,i as O}from"./element-plus-0a16f2db.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const P=(e,t)=>{const r=e.__vccOpts||e;for(const[o,a]of t)r[o]=a;return r};const D=P({name:"App",async created(){if(this.$store.getters["user/token"])try{await this.$store.dispatch("user/initializeAuth")}catch(e){console.error("Failed to initialize auth on app start:",e)}}},[["render",function(s,n,l,i,c,d){const u=r("router-view");return o(),e(u,null,{default:t((({Component:t})=>[(o(),e(a(t)))])),_:1})}]]),k={},G=function(e,t,r){if(!t||0===t.length)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in k)return;k[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(!!r)for(let r=o.length-1;r>=0;r--){const a=o[r];if(a.href===e&&(!t||"stylesheet"===a.rel))return}else if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise(((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))},x={direct:{baseURL:"/api",description:"ç›´è¿åç«¯æœåŠ¡ (ä¸ç»è¿‡ GOST)",useFor:"å¼€å‘è°ƒè¯•"},gost:{baseURL:"http://localhost:6443/api",description:"é€šè¿‡ GOST ç«¯å£ 6443 ä»£ç†",useFor:"æµé‡ç»Ÿè®¡æµ‹è¯•"},production:{baseURL:"/api",description:"ç”Ÿäº§ç¯å¢ƒç›¸å¯¹è·¯å¾„",useFor:"ç”Ÿäº§éƒ¨ç½²"}},F=()=>{if({}.VITE_API_MODE){const e={}.VITE_API_MODE;if(x[e])return console.log(`ğŸ”§ ä½¿ç”¨ç¯å¢ƒå˜é‡æŒ‡å®šçš„ API æ¨¡å¼: ${e}`),x[e]}const e=localStorage.getItem("api_mode");if(e&&x[e])return console.log(`ğŸ”§ ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„ API æ¨¡å¼: ${e}`),x[e];const t="production";return console.log(`ğŸ”§ ä½¿ç”¨é»˜è®¤ API æ¨¡å¼: ${t}`),x[t]},M=(e,t=!1)=>{if(!x[e])return console.error(`âŒ æ— æ•ˆçš„ API æ¨¡å¼: ${e}`),!1;if(localStorage.setItem("api_mode",e),console.log(`âœ… API æ¨¡å¼å·²åˆ‡æ¢åˆ°: ${e} (${x[e].description})`),t)try{G((()=>Promise.resolve().then((()=>H))),void 0).then((({default:t})=>{t.defaults.baseURL=x[e].baseURL,console.log(`ğŸ”„ å·²åŠ¨æ€æ›´æ–°APIåŸºç¡€åœ°å€: ${x[e].baseURL}`)}))}catch(r){console.error("âŒ åŠ¨æ€æ›´æ–°APIé…ç½®å¤±è´¥:",r)}else console.log("ğŸ”„ è¯·åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ–°é…ç½®");return!0},N=()=>{const e=F();return{mode:Object.keys(x).find((t=>x[t].baseURL===e.baseURL)),config:e,allModes:x}},C=F(),$=C.baseURL,B=C,j={endpoints:{status:"/test/status",help:"/test/help",traffic1mb:"/test/traffic-1mb",traffic5mb:"/test/traffic-5mb",traffic10mb:"/test/traffic-10mb",trafficCustom:"/test/traffic-custom"},testScenarios:[{name:"å°æµé‡æµ‹è¯•",endpoint:"/test/traffic-1mb",expectedSize:"1 MB",description:"æµ‹è¯•åŸºç¡€æµé‡ç»Ÿè®¡åŠŸèƒ½"},{name:"ä¸­ç­‰æµé‡æµ‹è¯•",endpoint:"/test/traffic-5mb",expectedSize:"5 MB",description:"æµ‹è¯•ä¸­ç­‰æµé‡å¤„ç†èƒ½åŠ›"},{name:"å¤§æµé‡æµ‹è¯•",endpoint:"/test/traffic-10mb",expectedSize:"10 MB",description:"æµ‹è¯•å¤§æµé‡ç»Ÿè®¡å‡†ç¡®æ€§"},{name:"è‡ªå®šä¹‰æµé‡æµ‹è¯•",endpoint:"/test/traffic-custom?size=2.5",expectedSize:"2.5 MB",description:"æµ‹è¯•è‡ªå®šä¹‰å¤§å°æµé‡"}]},q={showConfig:()=>{const e=N();return console.log("ğŸ“Š å½“å‰ API é…ç½®ä¿¡æ¯:"),console.log(`   æ¨¡å¼: ${e.mode}`),console.log(`   åœ°å€: ${e.config.baseURL}`),console.log(`   æè¿°: ${e.config.description}`),console.log(`   ç”¨é€”: ${e.config.useFor}`),e},enableTrafficTest:()=>{const e=M("gost");return e&&(console.log("ğŸ§ª æµé‡æµ‹è¯•æ¨¡å¼å·²å¯ç”¨"),console.log("ğŸ“ ç°åœ¨æ‰€æœ‰ API è¯·æ±‚éƒ½ä¼šé€šè¿‡ GOST ç«¯å£ 6443"),console.log("ğŸ“Š å¯ä»¥åœ¨ä»ªè¡¨ç›˜ä¸­è§‚å¯Ÿæµé‡ç»Ÿè®¡å˜åŒ–"),console.log("ğŸ”„ è¯·åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ–°é…ç½®")),e},disableTrafficTest:()=>{const e=M("direct");return e&&(console.log("ğŸ”§ å·²åˆ‡æ¢å›ç›´è¿æ¨¡å¼"),console.log("ğŸ“ API è¯·æ±‚ä¸å†ç»è¿‡ GOST ä»£ç†"),console.log("ğŸ”„ è¯·åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ–°é…ç½®")),e},testTrafficEndpoint:async(e=1)=>{try{const t=`${$}/test/traffic-custom?size=${e}`;console.log(`ğŸ§ª æµ‹è¯•æµé‡æ¥å£: ${t}`);const r=await fetch(t),o=await r.json();return console.log("âœ… æµé‡æµ‹è¯•å®Œæˆ:"),console.log(`   è¯·æ±‚å¤§å°: ${e} MB`),console.log(`   å®é™…å¤§å°: ${o.actualSize}`),console.log(`   ç”Ÿæˆæ—¶é—´: ${o.generationTime}`),o}catch(t){return console.error("âŒ æµé‡æµ‹è¯•å¤±è´¥:",t),null}}},z={API_BASE_URL:$,API_CONFIG:B,TRAFFIC_TEST_CONFIG:j,switchApiMode:M,getApiModeInfo:N,devTools:q},V=Object.freeze(Object.defineProperty({__proto__:null,API_BASE_URL:$,API_CONFIG:B,TRAFFIC_TEST_CONFIG:j,default:z,devTools:q,getApiModeInfo:N,switchApiMode:M},Symbol.toStringTag,{value:"Module"})),W=S.create({baseURL:$,timeout:15e3});W.interceptors.request.use((e=>{const t=Y.getters["user/token"];return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>(console.error("Request error:",e),Promise.reject(e))));let K=!1,J=!1;W.interceptors.response.use((e=>e),(async e=>{var t,r;console.error("Response error:",e);const{response:o,config:a}=e;if(o)switch(o.status){case 401:if(K||(null==(t=a.url)?void 0:t.includes("/auth/logout"))){console.log("ğŸ”„ è·³è¿‡401å¤„ç†ï¼Œé¿å…æ­»å¾ªç¯");break}K=!0,console.log("ğŸ” æ”¶åˆ°401é”™è¯¯ï¼Œå¼€å§‹æ¸…ç†ç”¨æˆ·çŠ¶æ€"),Y.commit("user/CLEAR_USER_STATE"),"Login"!==ae.currentRoute.value.name&&(ae.push("/login"),T.error("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•")),setTimeout((()=>{K=!1}),1e3);break;case 403:T.error("æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº");break;case 404:await async function(e){if("gost"!==localStorage.getItem("api_mode")||J)T.error("è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨");else{console.warn("ğŸ”„ æ£€æµ‹åˆ°GOSTä»£ç†ä¸å¯ç”¨ï¼Œå°è¯•è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼..."),J=!0;try{localStorage.setItem("api_mode","direct");const{API_CONFIGS:t}=await G((()=>Promise.resolve().then((()=>V))),void 0);W.defaults.baseURL=t.direct.baseURL,T.warning({message:"æ£€æµ‹åˆ°GOSTä»£ç†ä¸å¯ç”¨ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼",duration:5e3,showClose:!0}),console.log("âœ… å·²è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼"),setTimeout((async()=>{try{const t=await W(e);return console.log("âœ… è¯·æ±‚é‡è¯•æˆåŠŸ"),t}catch(t){console.error("âŒ è¯·æ±‚é‡è¯•å¤±è´¥:",t)}finally{J=!1}}),1e3)}catch(t){console.error("âŒ è‡ªåŠ¨åˆ‡æ¢å¤±è´¥:",t),T.error("GOSTä»£ç†ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼"),J=!1}}}(a);break;case 500:T.error("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");break;default:T.error((null==(r=o.data)?void 0:r.message)||"è¯·æ±‚å¤±è´¥")}else await async function(e,t){if("gost"!==localStorage.getItem("api_mode")||J||"ECONNREFUSED"!==t.code&&!t.message.includes("Network Error"))T.error("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥");else{console.warn("ğŸ”„ æ£€æµ‹åˆ°GOSTä»£ç†è¿æ¥å¤±è´¥ï¼Œå°è¯•è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼..."),J=!0;try{localStorage.setItem("api_mode","direct");const{API_CONFIGS:t}=await G((()=>Promise.resolve().then((()=>V))),void 0);W.defaults.baseURL=t.direct.baseURL,T.warning({message:"GOSTä»£ç†è¿æ¥å¤±è´¥ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼",duration:5e3,showClose:!0}),console.log("âœ… å·²è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´è¿æ¨¡å¼"),setTimeout((async()=>{try{const t=await W(e);return console.log("âœ… è¯·æ±‚é‡è¯•æˆåŠŸ"),t}catch(t){console.error("âŒ è¯·æ±‚é‡è¯•å¤±è´¥:",t)}finally{J=!1}}),1e3)}catch(r){console.error("âŒ è‡ªåŠ¨åˆ‡æ¢å¤±è´¥:",r),T.error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥GOSTæœåŠ¡çŠ¶æ€"),J=!1}}}(a,e);return Promise.reject(e)}));const H=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"})),Y=s({modules:{user:{namespaced:!0,state:{currentUser:JSON.parse(localStorage.getItem("user"))||null,token:localStorage.getItem("token")||null,users:[],loading:!1,error:null},getters:{currentUser:e=>e.currentUser,allUsers:e=>e.users,isAdmin:e=>{var t;return"admin"===(null==(t=e.currentUser)?void 0:t.role)},isLoading:e=>e.loading,error:e=>e.error,isAuthenticated:e=>!!e.token,token:e=>e.token},actions:{async initializeAuth({dispatch:e,state:t}){if(t.token)try{await e("getCurrentUser")}catch(r){console.error("Failed to initialize auth:",r),e("logout")}},async login({commit:e,dispatch:t},r){var o,a;try{const{data:t}=await W.post("/auth/login",r);return e("SET_TOKEN",t.token),e("SET_CURRENT_USER",t.user),t.user}catch(s){throw(null==(a=null==(o=s.response)?void 0:o.data)?void 0:a.message)||"ç™»å½•å¤±è´¥"}},async logout({commit:e},t=!1){var r;try{!t&&(null==(r=e.state)?void 0:r.token)&&await W.post("/auth/logout")}catch(o){console.error("Logout error:",o)}finally{e("CLEAR_USER_STATE")}},async getCurrentUser({commit:e}){try{const t=await W.get("/users/me"),r=t.data.success?t.data.data:t.data;return e("SET_CURRENT_USER",r),r}catch(t){throw console.error("Get current user error:",t),t}},async fetchUsers({commit:e}){var t,r;try{e("setLoading",!0);const{data:t}=await W.get("/users");return e("setUsers",t),t}catch(o){throw console.error("Fetch users error:",o),e("setError",(null==(r=null==(t=o.response)?void 0:t.data)?void 0:r.message)||"è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥"),o}finally{e("setLoading",!1)}},async createUser({commit:e,dispatch:t},r){var o,a;try{const{data:t}=await W.post("/users",r);return e("addUser",t),t}catch(s){throw(null==(a=null==(o=s.response)?void 0:o.data)?void 0:a.message)||"åˆ›å»ºç”¨æˆ·å¤±è´¥"}},async updateUser({commit:e},{id:t,data:r}){var o,a;try{const o=await W.put(`/users/${t}`,r);return e("updateUserInList",o.data),o.data}catch(s){throw(null==(a=null==(o=s.response)?void 0:o.data)?void 0:a.message)||"æ›´æ–°ç”¨æˆ·å¤±è´¥"}},async deleteUser({commit:e},t){var r,o;try{await W.delete(`/users/${t}`),e("removeUser",t)}catch(a){throw(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"åˆ é™¤ç”¨æˆ·å¤±è´¥"}}},mutations:{SET_CURRENT_USER(e,t){e.currentUser=t,t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user"),e.error=null},SET_TOKEN(e,t){e.token=t,t?localStorage.setItem("token",t):localStorage.removeItem("token")},CLEAR_USER_STATE(e){e.currentUser=null,e.token=null,localStorage.removeItem("token"),localStorage.removeItem("user")},setUsers(e,t){e.users=t,e.error=null},addUser(e,t){e.users.push(t),e.error=null},updateUserInList(e,t){var r;const o=e.users.findIndex((e=>e.id===t.id));-1!==o&&e.users.splice(o,1,t),(null==(r=e.currentUser)?void 0:r.id)===t.id&&(e.currentUser=t,localStorage.setItem("user",JSON.stringify(t))),e.error=null},removeUser(e,t){e.users=e.users.filter((e=>e.id!==t)),e.error=null},setLoading(e,t){e.loading=t},setError(e,t){e.error=t}}},rules:{namespaced:!0,state:{rules:[],loading:!1,error:null},getters:{allRules:e=>e.rules,isLoading:e=>e.loading,error:e=>e.error},actions:{async fetchRules({commit:e}){var t,r;try{e("setLoading",!0);const{data:t}=await W.get("/rules");return e("setRules",t),t}catch(o){throw console.error("Fetch rules error:",o),e("setError",(null==(r=null==(t=o.response)?void 0:t.data)?void 0:r.message)||"è·å–è§„åˆ™åˆ—è¡¨å¤±è´¥"),o}finally{e("setLoading",!1)}},async createRule({commit:e},t){var r,o;try{const{data:r}=await W.post("/rules",{data:t});return e("addRule",r),r}catch(a){throw console.error("Create rule error:",a),(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"åˆ›å»ºè§„åˆ™å¤±è´¥"}},async updateRule({commit:e},{id:t,data:r}){var o,a;try{const o=await W.put(`/rules/${t}`,{data:r});return e("updateRuleInList",o.data),o.data}catch(s){throw console.error("Update rule error:",s),(null==(a=null==(o=s.response)?void 0:o.data)?void 0:a.message)||"æ›´æ–°è§„åˆ™å¤±è´¥"}},async deleteRule({commit:e},t){var r,o;try{await W.delete(`/rules/${t}`),e("removeRule",t)}catch(a){throw console.error("Delete rule error:",a),(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"åˆ é™¤è§„åˆ™å¤±è´¥"}}},mutations:{setRules(e,t){e.rules=t,e.error=null},addRule(e,t){e.rules.push(t),e.error=null},updateRuleInList(e,t){const r=e.rules.findIndex((e=>e.id===t.id));-1!==r&&e.rules.splice(r,1,t),e.error=null},removeRule(e,t){e.rules=e.rules.filter((e=>e.id!==t)),e.error=null},setLoading(e,t){e.loading=t},setError(e,t){e.error=t}}},traffic:{namespaced:!0,state:{stats:null,topUsers:[],loading:!1,error:null},mutations:{SET_STATS(e,t){e.stats=t,e.error=null},SET_TOP_USERS(e,t){e.topUsers=t},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t}},actions:{async fetchStats({commit:e}){var t,r;try{e("SET_LOADING",!0);const t=await W.get("/dashboard/overview");console.log("ğŸ“Š Dashboard API response:",t.data);const r=t.data.data,o={activeUsers:r.users.active,totalUsers:r.users.total,activeRules:r.rules.total,totalTraffic:r.traffic.totalUsed,totalBytesIn:Math.floor(.4*r.traffic.totalUsed),totalBytesOut:Math.floor(.6*r.traffic.totalUsed),traffic24h:r.traffic.total24h,activeUsers24h:r.traffic.activeUsers24h};return console.log("ğŸ“ˆ Processed stats:",o),e("SET_STATS",o),o}catch(o){throw console.error("Fetch traffic stats error:",o),e("SET_ERROR",(null==(r=null==(t=o.response)?void 0:t.data)?void 0:r.message)||"è·å–æµé‡ç»Ÿè®¡å¤±è´¥"),o}finally{e("SET_LOADING",!1)}},async fetchTopUsers({commit:e},{period:t=7,limit:r=10}){try{e("SET_LOADING",!0);const o=(await W.get("/dashboard/traffic-ranking",{params:{days:t,limit:r}})).data.data;return e("SET_TOP_USERS",o),o}catch(o){throw e("SET_ERROR",o.message),o}finally{e("SET_LOADING",!1)}},async fetchTrafficLogs({commit:e},t={}){var r,o,a,s,n,l,i,c;try{e("SET_LOADING",!0),console.log("ğŸ“Š Fetching traffic logs with params:",t);const i=await W.get("/traffic/logs",{params:t});console.log("ğŸ“Š Traffic logs API response:",i.data);const c=i.data.data,d={logs:c.logs||[],total:c.total||0,stats:{total:(null==(r=c.stats)?void 0:r.total)||0,upload:(null==(o=c.stats)?void 0:o.upload)||0,download:(null==(a=c.stats)?void 0:a.download)||0},chartData:{timestamps:(null==(s=c.chartData)?void 0:s.timestamps)||[],upload:(null==(n=c.chartData)?void 0:n.upload)||[],download:(null==(l=c.chartData)?void 0:l.download)||[]}};return console.log("ğŸ“Š Formatted traffic logs data:",d),{data:d}}catch(d){throw console.error("âŒ Failed to fetch traffic logs:",d),e("SET_ERROR",(null==(c=null==(i=d.response)?void 0:i.data)?void 0:c.message)||d.message),d}finally{e("SET_LOADING",!1)}}},getters:{trafficStats:e=>e.stats,topUsers:e=>e.topUsers,isLoading:e=>e.loading,hasError:e=>!!e.error,errorMessage:e=>e.error,totalTraffic:e=>e.stats?e.stats.totalBytesIn+e.stats.totalBytesOut:0,formattedTraffic:(e,t)=>{const r=t.totalTraffic;if(0===r)return"0 B";const o=parseInt(Math.floor(Math.log(r)/Math.log(1024)));return Math.round(r/Math.pow(1024,o),2)+" "+["B","KB","MB","GB","TB"][o]}}},gost:{namespaced:!0,state:{status:null,loading:!1,error:null,portForwards:[],systemInfo:null},mutations:{SET_STATUS(e,t){console.log("ğŸ”§ Setting GOST status data:",t),e.status=t,e.error=null,t&&t.portForwards?(e.portForwards=t.portForwards,console.log("ğŸ“Š Port forwards:",t.portForwards)):e.portForwards=[],t&&t.systemInfo?(e.systemInfo=t.systemInfo,console.log("ğŸ’» System info:",t.systemInfo)):e.systemInfo=null},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t}},actions:{async fetchStatus({commit:e,rootGetters:t}){var r,o;try{e("SET_LOADING",!0);const r=t["user/isAdmin"]?"/gost/status":"/gost/status/basic",o=await W.get(r);return e("SET_STATUS",o.data.data),o.data.data}catch(a){throw console.error("è·å–GostçŠ¶æ€å¤±è´¥:",a),e("SET_ERROR",(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"è·å–GostæœåŠ¡çŠ¶æ€å¤±è´¥"),a}finally{e("SET_LOADING",!1)}},async startService({commit:e,dispatch:t}){var r,o;try{return e("SET_LOADING",!0),await W.post("/gost/start"),t("fetchStatus")}catch(a){throw e("SET_ERROR",(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"å¯åŠ¨GostæœåŠ¡å¤±è´¥"),a}finally{e("SET_LOADING",!1)}},async stopService({commit:e,dispatch:t}){var r,o;try{return e("SET_LOADING",!0),await W.post("/gost/stop"),t("fetchStatus")}catch(a){throw e("SET_ERROR",(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"åœæ­¢GostæœåŠ¡å¤±è´¥"),a}finally{e("SET_LOADING",!1)}},async restartService({commit:e,dispatch:t}){var r,o;try{return e("SET_LOADING",!0),await W.post("/gost/restart"),t("fetchStatus")}catch(a){throw e("SET_ERROR",(null==(o=null==(r=a.response)?void 0:r.data)?void 0:o.message)||"é‡å¯GostæœåŠ¡å¤±è´¥"),a}finally{e("SET_LOADING",!1)}}},getters:{isRunning:e=>{var t;return(null==(t=e.status)?void 0:t.isRunning)||!1},pid:e=>{var t;return null==(t=e.status)?void 0:t.pid},portForwards:e=>e.portForwards||[],systemInfo:e=>e.systemInfo,isLoading:e=>e.loading,hasError:e=>!!e.error,errorMessage:e=>e.error}}}}),Q={class:"navbar"},X={class:"right"},Z={class:"el-dropdown-link"},ee=P({__name:"Navbar",setup(e){const a=n(),s=l(),g=i((()=>a.getters["user/currentUser"])),h=async e=>{if("logout"===e)try{await a.dispatch("user/logout"),s.push("/login")}catch(t){T.error("é€€å‡ºç™»å½•å¤±è´¥")}};return(e,a)=>{const s=r("el-icon"),n=r("el-dropdown-item"),l=r("el-dropdown-menu"),i=r("el-dropdown");return o(),c("div",Q,[a[1]||(a[1]=d("div",{class:"left"},[d("h2",null,"GOST ç®¡ç†ç³»ç»Ÿ")],-1)),d("div",X,[u(i,{onCommand:h},{dropdown:t((()=>[u(l,null,{default:t((()=>[u(n,{command:"logout"},{default:t((()=>a[0]||(a[0]=[m("é€€å‡ºç™»å½•")]))),_:1,__:[0]})])),_:1})])),default:t((()=>{var e;return[d("span",Z,[m(p(null==(e=g.value)?void 0:e.username)+" ",1),u(s,{class:"el-icon--right"},{default:t((()=>[u(f(w))])),_:1})])]})),_:1})])])}}},[["__scopeId","data-v-d01f51a7"]]),te=()=>G((()=>import("./UserForwardRules-c93a1fe6.js")),["assets/UserForwardRules-c93a1fe6.js","assets/vue-55dd3248.js","assets/element-plus-0a16f2db.js","assets/api-814d2442.js","assets/utils-d4f80f06.js","assets/UserForwardRules-f0f41cce.css"]),re=[{path:"/login",name:"Login",component:()=>G((()=>import("./Login-a6d5ea80.js")),["assets/Login-a6d5ea80.js","assets/vue-55dd3248.js","assets/element-plus-0a16f2db.js","assets/utils-d4f80f06.js","assets/Login-dd057d76.css"]),meta:{requiresAuth:!1}},{path:"/",component:P({__name:"Layout",setup(s){const l=n(),c=i((()=>l.getters["user/isAdmin"])),m=i((()=>l.getters["user/currentUser"])),p=i((()=>{var e;const t=null==(e=m.value)?void 0:e.username;return"admin"===t||"test"===t}));return(s,n)=>{const l=r("el-icon"),i=r("el-menu-item"),m=r("el-menu"),_=r("el-aside"),v=r("el-header"),E=r("router-view"),S=r("el-main"),T=r("el-container");return o(),e(T,{class:"app-wrapper"},{default:t((()=>[u(_,{width:"200px",class:"sidebar-container"},{default:t((()=>[u(m,{router:!0,"default-active":s.$route.path,class:"el-menu-vertical","background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF"},{default:t((()=>[u(i,{index:"/dashboard"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(y))])),_:1}),n[0]||(n[0]=d("span",null,"ä»ªè¡¨ç›˜",-1))])),_:1,__:[0]}),c.value?(o(),e(i,{key:0,index:"/admin"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(I))])),_:1}),n[1]||(n[1]=d("span",null,"ç”¨æˆ·ç®¡ç†",-1))])),_:1,__:[1]})):g("",!0),u(i,{index:"/rules"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(b))])),_:1}),n[2]||(n[2]=d("span",null,"è§„åˆ™ç®¡ç†",-1))])),_:1,__:[2]}),u(i,{index:"/profile"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(A))])),_:1}),n[3]||(n[3]=d("span",null,"ä¸ªäººä¿¡æ¯",-1))])),_:1,__:[3]}),p.value?(o(),e(i,{key:1,index:"/traffic-test"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(R))])),_:1}),n[4]||(n[4]=d("span",null,"ğŸ§ª APIæµ‹è¯•",-1))])),_:1,__:[4]})):g("",!0),c.value?(o(),e(i,{key:2,index:"/gost-config"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(L))])),_:1}),n[5]||(n[5]=d("span",null,"Gosté…ç½®",-1))])),_:1,__:[5]})):g("",!0),c.value?(o(),e(i,{key:3,index:"/system-status"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(y))])),_:1}),n[6]||(n[6]=d("span",null,"ç³»ç»ŸçŠ¶æ€",-1))])),_:1,__:[6]})):g("",!0),c.value?(o(),e(i,{key:4,index:"/performance-config"},{default:t((()=>[u(l,null,{default:t((()=>[u(f(U))])),_:1}),n[7]||(n[7]=d("span",null,"æ€§èƒ½é…ç½®",-1))])),_:1,__:[7]})):g("",!0)])),_:1},8,["default-active"])])),_:1}),u(T,null,{default:t((()=>[u(v,{height:"60px",class:"header"},{default:t((()=>[u(ee)])),_:1}),u(S,null,{default:t((()=>[u(E,null,{default:t((({Component:r})=>[u(h,{name:"fade",mode:"out-in"},{default:t((()=>[(o(),e(a(r)))])),_:2},1024)])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-6a0b027a"]]),redirect:"/dashboard",children:[{path:"/dashboard",name:"Dashboard",component:()=>G((()=>import("./Dashboard-5130a7b8.js")),["assets/Dashboard-5130a7b8.js","assets/vue-55dd3248.js","assets/element-plus-0a16f2db.js","assets/charts-d42137db.js","assets/utils-d4f80f06.js","assets/Dashboard-da783d02.css"]),meta:{requiresAuth:!0,title:"ä»ªè¡¨ç›˜"}},{path:"/admin",name:"Admin",component:()=>G((()=>import("./UserManagement-2bb892e3.js")),["assets/UserManagement-2bb892e3.js","assets/element-plus-0a16f2db.js","assets/vue-55dd3248.js","assets/api-814d2442.js","assets/utils-d4f80f06.js","assets/UserManagement-f4c22536.css"]),meta:{requiresAuth:!0,requiresAdmin:!0,title:"ç”¨æˆ·ç®¡ç†"}},{path:"/rules",name:"Rules",component:te,meta:{requiresAuth:!0,title:"è§„åˆ™ç®¡ç†"}},{path:"/user-forward-rules",name:"UserForwardRules",component:te,meta:{requiresAuth:!0,title:"è½¬å‘è§„åˆ™"}},{path:"/gost-config",name:"GostConfig",component:()=>G((()=>import("./GostConfig-83de2582.js")),["assets/GostConfig-83de2582.js","assets/vue-55dd3248.js","assets/element-plus-0a16f2db.js","assets/api-814d2442.js","assets/utils-d4f80f06.js","assets/GostConfig-aab359a1.css"]),meta:{requiresAuth:!0,requiresAdmin:!0,title:"Gost é…ç½®"}},{path:"/traffic-test",name:"AdvancedTrafficTest",component:()=>G((()=>import("./AdvancedTrafficTest-faa6f0df.js")),["assets/AdvancedTrafficTest-faa6f0df.js","assets/api-814d2442.js","assets/element-plus-0a16f2db.js","assets/vue-55dd3248.js","assets/utils-d4f80f06.js","assets/AdvancedTrafficTest-6df03544.css"]),meta:{requiresAuth:!0,title:"API & æµé‡æµ‹è¯•",allowedUsers:["admin","test"]}},{path:"/system-status",name:"SystemStatus",component:()=>G((()=>import("./SystemStatus-0518008f.js")),["assets/SystemStatus-0518008f.js","assets/vue-55dd3248.js","assets/element-plus-0a16f2db.js","assets/api-814d2442.js","assets/utils-d4f80f06.js","assets/SystemStatus-61d45cd7.css"]),meta:{requiresAuth:!0,requiresAdmin:!0,title:"ç³»ç»ŸçŠ¶æ€"}},{path:"/performance-config",name:"PerformanceConfig",component:()=>G((()=>import("./PerformanceConfig-63b8c5a1.js")),["assets/PerformanceConfig-63b8c5a1.js","assets/vue-55dd3248.js","assets/api-814d2442.js","assets/element-plus-0a16f2db.js","assets/utils-d4f80f06.js","assets/PerformanceConfig-7e04b715.css"]),meta:{requiresAuth:!0,requiresAdmin:!0,title:"æ€§èƒ½é…ç½®"}},{path:"/profile",name:"Profile",component:()=>G((()=>import("./Profile-ee4c037c.js")),["assets/Profile-ee4c037c.js","assets/element-plus-0a16f2db.js","assets/vue-55dd3248.js","assets/utils-d4f80f06.js","assets/Profile-f4024d93.css"]),meta:{requiresAuth:!0,title:"ä¸ªäººä¿¡æ¯"}}]}],oe=_({history:v(),routes:re});oe.beforeEach((async(e,t,r)=>{Y.getters["user/token"]&&!Y.getters["user/currentUser"]&&await Y.dispatch("user/initializeAuth");const o=Y.getters["user/isAuthenticated"],a=Y.getters["user/isAdmin"];if(e.matched.some((e=>e.meta.requiresAuth))){if(!o)return void r({name:"Login",query:{redirect:e.fullPath}});if(e.matched.some((e=>e.meta.requiresAdmin))&&!a)return void r({name:"Dashboard"});const t=e.matched.find((e=>e.meta.allowedUsers));if(t){const e=Y.getters["user/currentUser"];if(!t.meta.allowedUsers.includes(null==e?void 0:e.username))return void r({name:"Dashboard"})}if("AdminTestPanel"===e.name){if(!(e=>{if(!e||"admin"!==e.role)return!1;{const t=new URLSearchParams(window.location.search).get("api_test"),r=localStorage.getItem("api_test_mode");return("true"===t||"true"===r)&&"admin"===e.role}})(Y.getters["user/currentUser"]))return void r({name:"Dashboard"})}}"Login"===e.name&&o?r({name:a?"Admin":"Dashboard"}):r()}));const ae=oe;const se=new class{constructor(){this.isEnabled=!1,this.checkInterval=null}isAdmin(e){return e&&"admin"===e.role}enable(e,t=null){if(!this.isAdmin(e))return console.error("âŒ åªæœ‰ç®¡ç†å‘˜å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨æµ‹è¯•åŠŸèƒ½"),!1;if(t&&!this.validateAuthCode(t))return console.error("âŒ æˆæƒç æ— æ•ˆ"),!1;const r=(e=>e&&"admin"===e.role?(localStorage.setItem("api_test_mode","true"),console.log("ğŸ§ª APIæµ‹è¯•æ¨¡å¼å·²å¯ç”¨"),!0):(console.warn("âš ï¸ åªæœ‰ç®¡ç†å‘˜å¯ä»¥å¯ç”¨APIæµ‹è¯•æ¨¡å¼"),!1))(e);return r&&(this.isEnabled=!0,this.startMonitoring(),console.log("ğŸ§ª ç”Ÿäº§ç¯å¢ƒæµ‹è¯•åŠŸèƒ½å·²å¯ç”¨"),console.log("âš ï¸ è¯·è°¨æ…ä½¿ç”¨ï¼Œé¿å…å½±å“ç”Ÿäº§ç¯å¢ƒ"),console.log("ğŸ’¡ æµ‹è¯•å®Œæˆåè¯·åŠæ—¶ç¦ç”¨"),this.showProductionWarning()),r}disable(){localStorage.removeItem("api_test_mode"),console.log("ğŸ§ª APIæµ‹è¯•æ¨¡å¼å·²ç¦ç”¨"),this.isEnabled=!1,this.stopMonitoring(),console.log("ğŸ”’ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•åŠŸèƒ½å·²ç¦ç”¨")}validateAuthCode(e){return["ADMIN_TEST_2024","PROD_DEBUG_MODE","EMERGENCY_ACCESS"].includes(e)}startMonitoring(){this.checkInterval&&clearInterval(this.checkInterval),this.checkInterval=setInterval((()=>{console.warn("âš ï¸ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•åŠŸèƒ½ä»åœ¨è¿è¡Œ"),console.log("ğŸ’¡ å¦‚æœæµ‹è¯•å®Œæˆï¼Œè¯·æ‰§è¡Œ window.productionTestEnabler.disable()")}),3e5)}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}showProductionWarning(){const e="\n      background: #ff4757;\n      color: white;\n      padding: 10px;\n      border-radius: 5px;\n      font-weight: bold;\n      font-size: 14px;\n    ";console.log("%câš ï¸ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æ¨¡å¼å·²å¯ç”¨",e),console.log("%cè¯·è°¨æ…æ“ä½œï¼Œé¿å…å½±å“æ­£å¸¸ä¸šåŠ¡",e),console.log("%cæµ‹è¯•å®Œæˆåè¯·ç«‹å³ç¦ç”¨æ­¤åŠŸèƒ½",e),this.showWarningBanner()}showWarningBanner(){const e=document.createElement("div");e.id="production-test-warning",e.innerHTML='\n      <div style="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        background: #ff4757;\n        color: white;\n        padding: 10px;\n        text-align: center;\n        font-weight: bold;\n        z-index: 9999;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n      ">\n        âš ï¸ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æ¨¡å¼å·²å¯ç”¨ - è¯·è°¨æ…æ“ä½œ\n        <button onclick="window.productionTestEnabler.disable(); this.parentElement.parentElement.remove();" \n                style="margin-left: 20px; padding: 5px 10px; background: white; color: #ff4757; border: none; border-radius: 3px; cursor: pointer;">\n          ç¦ç”¨æµ‹è¯•æ¨¡å¼\n        </button>\n      </div>\n    ',document.body.appendChild(e)}getStatus(){return{isProduction:!0,isEnabled:this.isEnabled,hasMonitoring:!!this.checkInterval,enabledAt:localStorage.getItem("api_test_mode_enabled_at"),enabledBy:localStorage.getItem("api_test_mode_enabled_by")}}quickEnable(e){return this.isAdmin(e)?(localStorage.setItem("api_test_mode_enabled_at",(new Date).toISOString()),localStorage.setItem("api_test_mode_enabled_by",e.username),this.enable(e)):(console.error("âŒ æƒé™ä¸è¶³"),!1)}};window.productionTestEnabler=se,console.log("ğŸ”’ ç”Ÿäº§ç¯å¢ƒæµ‹è¯•å¯ç”¨å™¨å·²åŠ è½½"),console.log("ğŸ’¡ ç®¡ç†å‘˜å¯ä½¿ç”¨ window.productionTestEnabler.enable(user) å¯ç”¨æµ‹è¯•åŠŸèƒ½");const ne=E(D);ne.use(O,{locale:{name:"zh-cn",el:{breadcrumb:{label:"é¢åŒ…å±‘"},colorpicker:{confirm:"ç¡®å®š",clear:"æ¸…ç©º",defaultLabel:"é¢œè‰²é€‰æ‹©å™¨",description:"å½“å‰é¢œè‰² {color}ï¼ŒæŒ‰ Enter é”®é€‰æ‹©æ–°é¢œè‰²",alphaLabel:"é€‰æ‹©é€æ˜åº¦çš„å€¼"},datepicker:{now:"æ­¤åˆ»",today:"ä»Šå¤©",cancel:"å–æ¶ˆ",clear:"æ¸…ç©º",confirm:"ç¡®å®š",dateTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©æ—¥æœŸ",monthTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©æœˆä»½",yearTablePrompt:"ä½¿ç”¨æ–¹å‘é”®ä¸ Enter é”®å¯é€‰æ‹©å¹´ä»½",selectedDate:"å·²é€‰æ—¥æœŸ",selectDate:"é€‰æ‹©æ—¥æœŸ",selectTime:"é€‰æ‹©æ—¶é—´",startDate:"å¼€å§‹æ—¥æœŸ",startTime:"å¼€å§‹æ—¶é—´",endDate:"ç»“æŸæ—¥æœŸ",endTime:"ç»“æŸæ—¶é—´",prevYear:"å‰ä¸€å¹´",nextYear:"åä¸€å¹´",prevMonth:"ä¸Šä¸ªæœˆ",nextMonth:"ä¸‹ä¸ªæœˆ",year:"å¹´",month1:"1 æœˆ",month2:"2 æœˆ",month3:"3 æœˆ",month4:"4 æœˆ",month5:"5 æœˆ",month6:"6 æœˆ",month7:"7 æœˆ",month8:"8 æœˆ",month9:"9 æœˆ",month10:"10 æœˆ",month11:"11 æœˆ",month12:"12 æœˆ",weeks:{sun:"æ—¥",mon:"ä¸€",tue:"äºŒ",wed:"ä¸‰",thu:"å››",fri:"äº”",sat:"å…­"},weeksFull:{sun:"æ˜ŸæœŸæ—¥",mon:"æ˜ŸæœŸä¸€",tue:"æ˜ŸæœŸäºŒ",wed:"æ˜ŸæœŸä¸‰",thu:"æ˜ŸæœŸå››",fri:"æ˜ŸæœŸäº”",sat:"æ˜ŸæœŸå…­"},months:{jan:"ä¸€æœˆ",feb:"äºŒæœˆ",mar:"ä¸‰æœˆ",apr:"å››æœˆ",may:"äº”æœˆ",jun:"å…­æœˆ",jul:"ä¸ƒæœˆ",aug:"å…«æœˆ",sep:"ä¹æœˆ",oct:"åæœˆ",nov:"åä¸€æœˆ",dec:"åäºŒæœˆ"}},inputNumber:{decrease:"å‡å°‘æ•°å€¼",increase:"å¢åŠ æ•°å€¼"},select:{loading:"åŠ è½½ä¸­",noMatch:"æ— åŒ¹é…æ•°æ®",noData:"æ— æ•°æ®",placeholder:"è¯·é€‰æ‹©"},dropdown:{toggleDropdown:"åˆ‡æ¢ä¸‹æ‹‰é€‰é¡¹"},mention:{loading:"åŠ è½½ä¸­"},cascader:{noMatch:"æ— åŒ¹é…æ•°æ®",loading:"åŠ è½½ä¸­",placeholder:"è¯·é€‰æ‹©",noData:"æš‚æ— æ•°æ®"},pagination:{goto:"å‰å¾€",pagesize:"æ¡/é¡µ",total:"å…± {total} æ¡",pageClassifier:"é¡µ",page:"é¡µ",prev:"ä¸Šä¸€é¡µ",next:"ä¸‹ä¸€é¡µ",currentPage:"ç¬¬ {pager} é¡µ",prevPages:"å‘å‰ {pager} é¡µ",nextPages:"å‘å {pager} é¡µ",deprecationWarning:"ä½ ä½¿ç”¨äº†ä¸€äº›å·²è¢«åºŸå¼ƒçš„ç”¨æ³•ï¼Œè¯·å‚è€ƒ el-pagination çš„å®˜æ–¹æ–‡æ¡£"},dialog:{close:"å…³é—­æ­¤å¯¹è¯æ¡†"},drawer:{close:"å…³é—­æ­¤å¯¹è¯æ¡†"},messagebox:{title:"æç¤º",confirm:"ç¡®å®š",cancel:"å–æ¶ˆ",error:"è¾“å…¥çš„æ•°æ®ä¸åˆæ³•!",close:"å…³é—­æ­¤å¯¹è¯æ¡†"},upload:{deleteTip:"æŒ‰ Delete é”®å¯åˆ é™¤",delete:"åˆ é™¤",preview:"æŸ¥çœ‹å›¾ç‰‡",continue:"ç»§ç»­ä¸Šä¼ "},slider:{defaultLabel:"æ»‘å—ä»‹äº {min} è‡³ {max}",defaultRangeStartLabel:"é€‰æ‹©èµ·å§‹å€¼",defaultRangeEndLabel:"é€‰æ‹©ç»“æŸå€¼"},table:{emptyText:"æš‚æ— æ•°æ®",confirmFilter:"ç­›é€‰",resetFilter:"é‡ç½®",clearFilter:"å…¨éƒ¨",sumText:"åˆè®¡"},tour:{next:"ä¸‹ä¸€æ­¥",previous:"ä¸Šä¸€æ­¥",finish:"ç»“æŸå¯¼è§ˆ"},tree:{emptyText:"æš‚æ— æ•°æ®"},transfer:{noMatch:"æ— åŒ¹é…æ•°æ®",noData:"æ— æ•°æ®",titles:["åˆ—è¡¨ 1","åˆ—è¡¨ 2"],filterPlaceholder:"è¯·è¾“å…¥æœç´¢å†…å®¹",noCheckedFormat:"å…± {total} é¡¹",hasCheckedFormat:"å·²é€‰ {checked}/{total} é¡¹"},image:{error:"åŠ è½½å¤±è´¥"},pageHeader:{title:"è¿”å›"},popconfirm:{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ"},carousel:{leftArrow:"ä¸Šä¸€å¼ å¹»ç¯ç‰‡",rightArrow:"ä¸‹ä¸€å¼ å¹»ç¯ç‰‡",indicator:"å¹»ç¯ç‰‡åˆ‡æ¢è‡³ç´¢å¼• {index}"}}}}),ne.use(Y),ne.use(ae),Y.dispatch("user/initializeAuth").then((()=>{console.log("ğŸ” ç”¨æˆ·è®¤è¯çŠ¶æ€å·²åˆå§‹åŒ–")})).catch((e=>{console.error("âŒ åˆå§‹åŒ–ç”¨æˆ·è®¤è¯çŠ¶æ€å¤±è´¥:",e)})),ne.mount("#app");export{P as _,N as g,W as r,M as s};
