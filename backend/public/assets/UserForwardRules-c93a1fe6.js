import{aB as e,ax as a,r as l,c as t,X as r,h as s,k as o,z as n,A as d,M as i,P as u,H as c,G as p,K as v,O as g,a4 as f,ag as m,aq as h,y,L as w,C as P,I as b}from"./vue-55dd3248.js";import{p as _,g as R,r as A,h as k,E as I,f as C}from"./element-plus-0a16f2db.js";import{n as S,a as x,p as E}from"./api-814d2442.js";import{_ as $}from"./index-75dfb4d4.js";import"./utils-d4f80f06.js";const T={class:"user-forward-rules"},U={class:"header"},V={class:"header-actions"},F={class:"user-info"},D={class:"info-item"},j={class:"value"},B={class:"info-item"},q={class:"value"},z={key:0,class:"info-item"},L={class:"value additional-ports"},G={key:1,class:"info-item"},N={key:2},O={class:"group-header"},W={class:"group-info"},M={key:0,class:"additional-ports-tag"},K={key:1,class:"expired-tag"},H={class:"rule-status"},J={key:0,class:"traffic-stats"},X={class:"traffic-value"},Z={key:1,class:"text-muted"},Q={key:3},Y={class:"rule-status"},ee={key:0,class:"traffic-stats"},ae={class:"traffic-value"},le={key:1,class:"text-muted"},te={key:0,class:"disabled-hint"},re={key:0,class:"form-tip"},se={key:1,class:"form-tip"},oe={key:0},ne={key:1},de={key:2},ie={key:0,class:"form-tip info-tip"},ue={key:1,class:"form-tip success-tip"},ce={key:0,class:"form-tip warning-tip"};const pe=$({name:"UserForwardRules",components:{Plus:_,Delete:R,Refresh:A,InfoFilled:k},setup(){const n=e(),d=a(),i=l(!1),u=l(!1),c=l([]),p=l([]),v=l([]),g=l(!1),f=l(null),m=l(null),h=l(null),y=l({ipv6Supported:!1,recommendedIPv4:"127.0.0.1",recommendedIPv6:"::1",supportedListenModes:["ipv4"]}),w=l([]),P=t((()=>d.getters["user/currentUser"])),b=t((()=>d.getters["user/isAdmin"])),_=t((()=>{var e;return b.value?n.query.userId:null==(e=P.value)?void 0:e.id})),R=t((()=>b.value&&!n.query.userId)),A=t((()=>{var e;return b.value&&n.query.userId?`规则管理 - ${(null==(e=m.value)?void 0:e.username)||"用户"}`:R.value?"规则管理 - 所有用户":"规则管理"})),k=t((()=>{var e,a,l,t,r;if(R.value)return{start:1,end:65535,additionalPorts:[],allPorts:[]};const s=B(null==(e=m.value)?void 0:e.additionalPorts);console.log("计算属性中解析的额外端口:",s);const o=[];if((null==(a=m.value)?void 0:a.portRangeStart)&&(null==(l=m.value)?void 0:l.portRangeEnd))for(let d=m.value.portRangeStart;d<=m.value.portRangeEnd;d++)o.push(d);s&&s.length>0&&o.push(...s);const n=[...new Set(o)].sort(((e,a)=>e-a));return{start:(null==(t=m.value)?void 0:t.portRangeStart)||1,end:(null==(r=m.value)?void 0:r.portRangeEnd)||65535,additionalPorts:s,allPorts:n}})),$=r({name:"",sourcePort:null,targetAddress:"",protocol:"tcp",description:"",listenAddressType:"ipv4",listenAddress:""}),T=t((()=>{var e;return!b.value&&((null==(e=m.value)?void 0:e.isExpired)||!1)})),U=async()=>{try{const e=await S.getNetworkInfo();e.data.success&&(y.value=e.data.data,console.log("网络配置信息:",y.value))}catch(e){console.warn("获取网络配置失败:",e),I.warning("获取网络配置失败，将使用默认配置")}},V=e=>{if(!e)return!1;const a=e.includes("[")?e.split("]:")[0]+"]":e.split(":")[0];return F(a)},F=e=>{const a=e.replace(/[\\[\\]]/g,"");if(/^(\d{1,3}\.){3}\d{1,3}$/.test(a)){const e=a.split(".").map(Number);return 10===e[0]||172===e[0]&&e[1]>=16&&e[1]<=31||192===e[0]&&168===e[1]||127===e[0]||"localhost"===a}return a.includes(":")?"::1"===a||a.startsWith("fc")||a.startsWith("fd"):"localhost"===a},D={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:1,max:100,message:"规则名称长度在 1 到 100 个字符",trigger:"blur"}],sourcePort:[{required:!0,message:"请输入源端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围在 1-65535",trigger:"blur"},{validator:(e,a,l)=>{if(!a)return void l(new Error("请输入源端口"));if(b.value)return void l();const t=k.value.allPorts;if(t.length>0&&!t.includes(a)){let e="端口不在允许范围内",a=[];return k.value.start&&k.value.end&&a.push(`可用范围: ${k.value.start}-${k.value.end}`),k.value.additionalPorts.length>0&&a.push(`可用额外端口: ${k.value.additionalPorts.join(", ")}`),a.length>0&&(e+=`。${a.join("，")}`),void l(new Error(e))}l()},trigger:"blur"}],targetAddress:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(e,a,l)=>{if(!a)return void l(new Error("请输入目标地址"));/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/.test(a)||/^\[([0-9a-fA-F:]+)\]:\d{1,5}$/.test(a)||/^[a-zA-Z0-9.-]+:\d{1,5}$/.test(a)?l():l(new Error("请输入正确的地址格式"))},trigger:"blur"},{validator:async(e,a,l)=>{if(a)if(b.value||!V(a))try{const e=await E.validateTarget({targetAddress:a,userRole:b.value?"admin":"user"});if(e.data.success&&!e.data.data.valid){const a=e.data.data.errors||[];let t="目标地址不符合要求";return a.length>0&&(1===a.length?t=a[0]:t+="："+a.join("；")),void l(new Error(t))}l()}catch(t){console.warn("目标地址验证失败:",t),l()}else l(new Error("不允许使用本地地址"));else l()},trigger:"blur"}],protocol:[{required:!0,message:"请选择协议",trigger:"change"}]},j=async()=>{var e,a,l;i.value=!0;try{const a=_.value?{userId:_.value}:{},l=await x.get("/user-forward-rules",{params:a});R.value?(v.value=(l.data.groupedRules||[]).map((e=>({...e,rules:e.rules.map((e=>({...e,switching:!1})))}))),console.log("分组规则数据:",v.value),v.value.forEach((e=>{console.log(`用户 ${e.username} 额外端口:`,e.additionalPorts)})),c.value=[]):(c.value=(l.data.rules||[]).map((e=>({...e,switching:!1}))),m.value=l.data.user,console.log("用户信息:",m.value),console.log("用户额外端口:",null==(e=m.value)?void 0:e.additionalPorts),v.value=[]),l.data.cleanedCount>0&&I.warning(`清理了 ${l.data.cleanedCount} 个重复端口规则`)}catch(t){I.error("获取规则列表失败: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message))}finally{i.value=!1}},B=e=>{if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e)try{const a=JSON.parse(e);return Array.isArray(a)?a:[]}catch(a){return console.warn("解析额外端口失败:",a),[]}return[]};return s((()=>n.query.userId),(()=>{j()})),o((async()=>{console.log("组件加载，当前用户ID:",_.value),await U(),await(async()=>{try{const e=await x.get("/system-config/disabledProtocols");e.data.success&&e.data.data&&(w.value=e.data.data.value||[],console.log("禁用协议列表:",w.value))}catch(e){console.warn("获取禁用协议列表失败:",e),w.value=[]}})(),await j(),m.value&&(console.log("用户信息加载完成:",m.value),console.log("额外端口原始数据:",m.value.additionalPorts),console.log("解析后的额外端口:",B(m.value.additionalPorts))),v.value.length>0&&(console.log("分组规则加载完成"),v.value.forEach((e=>{console.log(`用户 ${e.username} 额外端口原始数据:`,e.additionalPorts),console.log(`用户 ${e.username} 解析后的额外端口:`,B(e.additionalPorts))})))})),{loading:i,saving:u,rules:c,selectedRules:p,groupedRules:v,showCreateDialog:g,editingRule:f,userInfo:m,userExpired:T,isAdmin:b,showGroupedView:R,pageTitle:A,currentUserPortRange:k,ruleForm:$,ruleRules:D,ruleFormRef:h,networkInfo:y,loadRules:j,saveRule:async()=>{var e,a;if(h.value){try{await h.value.validate()}catch{return}if(w.value.includes($.protocol))I.error(`无法创建规则：协议 ${$.protocol.toUpperCase()} 已被管理员禁用`);else{u.value=!0;try{const e={...$};b.value&&_.value&&(e.userId=_.value),f.value?(await x.put(`/user-forward-rules/${f.value.id}`,e),I.success("规则更新成功")):(await x.post("/user-forward-rules",e),I.success("规则创建成功")),g.value=!1,await j()}catch(l){I.error("保存规则失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}finally{u.value=!1}}}},editRule:e=>{f.value=e,Object.assign($,{name:e.name,sourcePort:e.sourcePort,targetAddress:e.targetAddress,protocol:e.protocol,description:e.description||"",listenAddressType:e.listenAddressType||"ipv4",listenAddress:e.listenAddress||("ipv6"===e.listenAddressType?"::1":"127.0.0.1")}),g.value=!0},deleteRule:async e=>{var a,l;try{await C.confirm(`确定要删除规则 "${e.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.delete(`/user-forward-rules/${e.id}`),I.success("规则删除成功"),await j()}catch(t){"cancel"!==t&&I.error("删除规则失败: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message))}},batchDelete:async()=>{var e,a;if(0!==p.value.length)try{await C.confirm(`确定要删除选中的 ${p.value.length} 个规则吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=p.value.map((e=>e.id));await x.post("/user-forward-rules/batch-delete",{ids:e}),I.success("批量删除成功"),await j()}catch(l){"cancel"!==l&&I.error("批量删除失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}},handleSelectionChange:e=>{p.value=e},handleGroupSelectionChange:(e,a)=>{p.value=[...p.value.filter((e=>e.userId!==a)),...e]},resetForm:()=>{f.value=null;let e="tcp";w.value.includes("tcp")&&(w.value.includes("udp")?w.value.includes("tls")||(e="tls"):e="udp"),Object.assign($,{name:"",sourcePort:null,targetAddress:"",protocol:e,description:"",listenAddressType:"ipv4",listenAddress:y.value.recommendedIPv4||"127.0.0.1"}),h.value&&h.value.clearValidate()},getProtocolType:e=>({tcp:"primary",udp:"success",tls:"warning"}[e]||"info"),formatTraffic:e=>{if(!e||0===e)return"0B";const a=["B","KB","MB","GB","TB"];let l=e,t=0;for(;l>=1024&&t<a.length-1;)l/=1024,t++;return`${l.toFixed(0===t?0:1)}${a[t]}`},getRuleStatusReason:(e,a)=>{var l,t,r,s,o,n,d;if(e.isActive)return"规则已激活，正在转发流量";const i=[];if(w.value.includes(e.protocol)&&i.push(`协议 ${e.protocol.toUpperCase()} 已被管理员禁用`),((null==a?void 0:a.isExpired)||T.value)&&i.push("用户已过期"),"suspended"!==(null==a?void 0:a.userStatus)&&"suspended"!==(null==(l=m.value)?void 0:l.userStatus)||i.push("用户已被暂停"),!1!==(null==a?void 0:a.isActive)&&!1!==(null==(t=m.value)?void 0:t.isActive)||i.push("用户已被禁用"),((null==a?void 0:a.usagePercent)>100||(null==(r=m.value)?void 0:r.usagePercent)>100)&&i.push("用户流量配额已超限"),e.sourcePort){let l=!1,t=[];a?t=Array.isArray(a.additionalPorts)?a.additionalPorts:[]:m.value&&(t=Array.isArray(m.value.additionalPorts)?m.value.additionalPorts:[]),(null==a?void 0:a.portRangeStart)&&(null==a?void 0:a.portRangeEnd)?l=e.sourcePort>=a.portRangeStart&&e.sourcePort<=a.portRangeEnd:(null==(s=m.value)?void 0:s.portRangeStart)&&(null==(o=m.value)?void 0:o.portRangeEnd)&&(l=e.sourcePort>=m.value.portRangeStart&&e.sourcePort<=m.value.portRangeEnd);const r=t.includes(e.sourcePort);if(!l&&!r){let l="";(null==a?void 0:a.portRangeStart)&&(null==a?void 0:a.portRangeEnd)?l=`${a.portRangeStart}-${a.portRangeEnd}`:(null==(n=m.value)?void 0:n.portRangeStart)&&(null==(d=m.value)?void 0:d.portRangeEnd)&&(l=`${m.value.portRangeStart}-${m.value.portRangeEnd}`);let r=`端口 ${e.sourcePort} 超出允许范围`;l&&(r+=` (${l})`),t.length>0&&(r+=` 且不在额外端口列表中 (${t.join(", ")})`),i.push(r)}}return i.length>0?`规则已禁用：${i.join("、")}`:"规则已禁用（系统自动判断）"},loadNetworkInfo:U,onListenAddressTypeChange:e=>{if("ipv6"===e){if(!y.value.ipv6Supported)return I.warning("系统不支持IPv6，已切换回IPv4"),void($.listenAddressType="ipv4");$.listenAddress=y.value.recommendedIPv6||"::1"}else $.listenAddress=y.value.recommendedIPv4||"127.0.0.1"},parseAdditionalPorts:B,isPrivateTargetAddress:V,disabledProtocols:w}}},[["render",function(e,a,l,t,r,s){const o=m("Plus"),_=m("el-icon"),R=m("el-button"),A=m("Delete"),k=m("Refresh"),I=m("el-tag"),C=m("el-card"),S=m("el-alert"),x=m("el-table-column"),E=m("InfoFilled"),$=m("el-tooltip"),pe=m("el-table"),ve=m("el-input"),ge=m("el-form-item"),fe=m("el-radio"),me=m("el-radio-group"),he=m("el-input-number"),ye=m("el-option"),we=m("el-select"),Pe=m("el-form"),be=m("el-dialog"),_e=h("loading");return y(),n("div",T,[d("div",U,[d("h2",null,i(t.pageTitle),1),d("div",V,[u(R,{type:"primary",onClick:a[0]||(a[0]=e=>t.showCreateDialog=!0),disabled:t.userExpired},{default:c((()=>[u(_,null,{default:c((()=>[u(o)])),_:1}),a[9]||(a[9]=w(" 添加规则 "))])),_:1,__:[9]},8,["disabled"]),u(R,{type:"danger",onClick:t.batchDelete,disabled:0===t.selectedRules.length},{default:c((()=>[u(_,null,{default:c((()=>[u(A)])),_:1}),a[10]||(a[10]=w(" 批量删除 "))])),_:1,__:[10]},8,["onClick","disabled"]),u(R,{onClick:t.loadRules},{default:c((()=>[u(_,null,{default:c((()=>[u(k)])),_:1}),a[11]||(a[11]=w(" 刷新 "))])),_:1,__:[11]},8,["onClick"])])]),t.userInfo&&!t.showGroupedView?(y(),p(C,{key:0,class:"user-info-card"},{default:c((()=>[d("div",F,[d("div",D,[a[12]||(a[12]=d("span",{class:"label"},"用户名:",-1)),d("span",j,i(t.userInfo.username),1)]),d("div",B,[a[13]||(a[13]=d("span",{class:"label"},"端口范围:",-1)),d("span",q,i(t.userInfo.portRangeStart&&t.userInfo.portRangeEnd?`${t.userInfo.portRangeStart}-${t.userInfo.portRangeEnd}`:"未设置"),1)]),t.userInfo.additionalPorts&&t.parseAdditionalPorts(t.userInfo.additionalPorts).length>0?(y(),n("div",z,[a[14]||(a[14]=d("span",{class:"label"},"额外端口:",-1)),d("span",L,i(t.parseAdditionalPorts(t.userInfo.additionalPorts).join(", ")),1)])):v("",!0),t.isAdmin?v("",!0):(y(),n("div",G,[a[16]||(a[16]=d("span",{class:"label"},"过期时间:",-1)),d("span",{class:P(["value",{expired:t.userInfo.isExpired}])},[w(i(t.userInfo.expiryDate?new Date(t.userInfo.expiryDate).toLocaleDateString():"永不过期")+" ",1),t.userInfo.isExpired?(y(),p(I,{key:0,type:"danger",size:"small"},{default:c((()=>a[15]||(a[15]=[w("已过期")]))),_:1,__:[15]})):v("",!0)],2)]))])])),_:1})):v("",!0),t.userExpired?(y(),p(S,{key:1,title:"用户已过期",type:"warning",description:"您的账户已过期，无法创建或修改转发规则。请联系管理员续期。","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}})):v("",!0),t.showGroupedView?(y(),n("div",N,[(y(!0),n(g,null,f(t.groupedRules,(e=>(y(),n("div",{key:e.userId,class:"user-group"},[d("div",O,[d("h3",null,i(e.username)+" ("+i(e.rules.length)+"个规则)",1),d("div",W,[d("span",null,"端口范围: "+i(e.portRange),1),e.additionalPorts&&t.parseAdditionalPorts(e.additionalPorts).length>0?(y(),n("span",M," 额外端口: "+i(t.parseAdditionalPorts(e.additionalPorts).join(", ")),1)):v("",!0),e.isExpired?(y(),n("span",K,"已过期")):v("",!0)])]),b((y(),p(pe,{data:e.rules,onSelectionChange:a=>t.handleGroupSelectionChange(a,e.userId),style:{width:"100%","margin-bottom":"20px"},stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"}},{default:c((()=>[u(x,{type:"selection",width:"55"}),u(x,{prop:"name",label:"规则名称","min-width":"120"}),u(x,{prop:"sourcePort",label:"源端口",width:"100"}),u(x,{prop:"targetAddress",label:"目标地址","min-width":"180"}),u(x,{prop:"protocol",label:"协议",width:"80"},{default:c((({row:e})=>[u(I,{type:t.getProtocolType(e.protocol)},{default:c((()=>[w(i(e.protocol.toUpperCase()),1)])),_:2},1032,["type"])])),_:1}),u(x,{prop:"isActive",label:"状态",width:"120"},{default:c((({row:a})=>[d("div",H,[u(I,{type:a.isActive?"success":"info",size:"small"},{default:c((()=>[w(i(a.isActive?"已激活":"已禁用"),1)])),_:2},1032,["type"]),u($,{content:t.getRuleStatusReason(a,e),placement:"top",effect:"dark"},{default:c((()=>[u(_,{class:"status-info"},{default:c((()=>[u(E)])),_:1})])),_:2},1032,["content"])])])),_:2},1024),u(x,{label:"流量统计",width:"120"},{default:c((({row:e})=>[e.trafficStats?(y(),n("div",J,[d("div",X,[u($,{content:"总流量统计",placement:"top"},{default:c((()=>[d("span",null,i(t.formatTraffic(e.trafficStats.totalBytes||0)),1)])),_:2},1024)])])):(y(),n("span",Z,"无数据"))])),_:1}),u(x,{prop:"createdAt",label:"创建时间",width:"160"},{default:c((({row:e})=>[w(i(new Date(e.createdAt).toLocaleString()),1)])),_:1}),u(x,{label:"操作",width:"150",fixed:"right"},{default:c((({row:l})=>[u(R,{type:"primary",size:"small",onClick:e=>t.editRule(l),disabled:e.isExpired},{default:c((()=>a[17]||(a[17]=[w(" 编辑 ")]))),_:2,__:[17]},1032,["onClick","disabled"]),u(R,{type:"danger",size:"small",onClick:e=>t.deleteRule(l)},{default:c((()=>a[18]||(a[18]=[w(" 删除 ")]))),_:2,__:[18]},1032,["onClick"])])),_:2},1024)])),_:2},1032,["data","onSelectionChange"])),[[_e,t.loading]])])))),128))])):(y(),n("div",Q,[u(C,{class:"table-card"},{default:c((()=>[b((y(),p(pe,{data:t.rules,onSelectionChange:t.handleSelectionChange,style:{width:"100%"},stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266",fontWeight:"600"}},{default:c((()=>[u(x,{type:"selection",width:"55"}),u(x,{prop:"name",label:"规则名称","min-width":"120"}),u(x,{prop:"sourcePort",label:"源端口",width:"100"}),u(x,{prop:"targetAddress",label:"目标地址","min-width":"180"}),u(x,{prop:"protocol",label:"协议",width:"80"},{default:c((({row:e})=>[u(I,{type:t.getProtocolType(e.protocol)},{default:c((()=>[w(i(e.protocol.toUpperCase()),1)])),_:2},1032,["type"])])),_:1}),u(x,{prop:"isActive",label:"状态",width:"120"},{default:c((({row:e})=>[d("div",Y,[u(I,{type:e.isActive?"success":"info",size:"small"},{default:c((()=>[w(i(e.isActive?"已激活":"已禁用"),1)])),_:2},1032,["type"]),u($,{content:t.getRuleStatusReason(e,{isExpired:t.userExpired}),placement:"top",effect:"dark"},{default:c((()=>[u(_,{class:"status-info"},{default:c((()=>[u(E)])),_:1})])),_:2},1032,["content"])])])),_:1}),u(x,{label:"流量统计",width:"120"},{default:c((({row:e})=>[e.trafficStats?(y(),n("div",ee,[d("div",ae,[u($,{content:"总流量统计",placement:"top"},{default:c((()=>[d("span",null,i(t.formatTraffic(e.trafficStats.totalBytes||0)),1)])),_:2},1024)])])):(y(),n("span",le,"无数据"))])),_:1}),u(x,{prop:"createdAt",label:"创建时间",width:"160"},{default:c((({row:e})=>[w(i(new Date(e.createdAt).toLocaleString()),1)])),_:1}),u(x,{label:"操作",width:"150",fixed:"right"},{default:c((({row:e})=>[u(R,{type:"primary",size:"small",onClick:a=>t.editRule(e),disabled:t.userExpired&&!t.isAdmin},{default:c((()=>a[19]||(a[19]=[w(" 编辑 ")]))),_:2,__:[19]},1032,["onClick","disabled"]),u(R,{type:"danger",size:"small",onClick:a=>t.deleteRule(e)},{default:c((()=>a[20]||(a[20]=[w(" 删除 ")]))),_:2,__:[20]},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[_e,t.loading]])])),_:1})])),u(be,{title:t.editingRule?"编辑规则":"创建规则",modelValue:t.showCreateDialog,"onUpdate:modelValue":a[8]||(a[8]=e=>t.showCreateDialog=e),width:"700px",onClose:t.resetForm,class:"rule-dialog"},{footer:c((()=>[u(R,{onClick:a[7]||(a[7]=e=>t.showCreateDialog=!1)},{default:c((()=>a[24]||(a[24]=[w("取消")]))),_:1,__:[24]}),u(R,{type:"primary",onClick:t.saveRule,loading:t.saving},{default:c((()=>[w(i(t.editingRule?"更新":"创建"),1)])),_:1},8,["onClick","loading"])])),default:c((()=>[u(Pe,{ref:"ruleFormRef",model:t.ruleForm,rules:t.ruleRules,"label-width":"120px"},{default:c((()=>[u(ge,{label:"规则名称",prop:"name"},{default:c((()=>[u(ve,{modelValue:t.ruleForm.name,"onUpdate:modelValue":a[1]||(a[1]=e=>t.ruleForm.name=e),placeholder:"请输入规则名称"},null,8,["modelValue"])])),_:1}),u(ge,{label:"监听地址",prop:"listenAddressType"},{default:c((()=>[u(me,{modelValue:t.ruleForm.listenAddressType,"onUpdate:modelValue":a[2]||(a[2]=e=>t.ruleForm.listenAddressType=e),onChange:t.onListenAddressTypeChange},{default:c((()=>[u(fe,{label:"ipv4"},{default:c((()=>[w("IPv4 ("+i(t.networkInfo.recommendedIPv4||"127.0.0.1")+")",1)])),_:1}),u(fe,{label:"ipv6",disabled:!t.networkInfo.ipv6Supported},{default:c((()=>[w(" IPv6 ("+i(t.networkInfo.recommendedIPv6||"::1")+") ",1),t.networkInfo.ipv6Supported?v("",!0):(y(),n("span",te,"系统不支持"))])),_:1},8,["disabled"])])),_:1},8,["modelValue","onChange"]),a[21]||(a[21]=d("div",{class:"form-tip"}," 选择规则监听的网络协议类型。IPv4适用于大多数情况，IPv6需要系统支持。 ",-1))])),_:1,__:[21]}),u(ge,{label:"源端口",prop:"sourcePort"},{default:c((()=>[u(he,{modelValue:t.ruleForm.sourcePort,"onUpdate:modelValue":a[3]||(a[3]=e=>t.ruleForm.sourcePort=e),min:1,max:65535,placeholder:"请输入源端口",style:{width:"100%"}},null,8,["modelValue"]),t.isAdmin?(y(),n("div",re," 管理员权限：可使用任意端口 (1-65535) ")):(y(),n("div",se,[t.currentUserPortRange.start&&t.currentUserPortRange.end?(y(),n("div",oe," 端口范围: "+i(t.currentUserPortRange.start)+"-"+i(t.currentUserPortRange.end),1)):v("",!0),t.currentUserPortRange.additionalPorts&&t.currentUserPortRange.additionalPorts.length>0?(y(),n("div",ne," 额外端口: "+i(t.currentUserPortRange.additionalPorts.join(", ")),1)):v("",!0),t.currentUserPortRange.allPorts&&t.currentUserPortRange.allPorts.length>0?(y(),n("div",de," 总计可用端口: "+i(t.currentUserPortRange.allPorts.length)+" 个 ",1)):v("",!0)]))])),_:1}),u(ge,{label:"目标地址",prop:"targetAddress"},{default:c((()=>[u(ve,{modelValue:t.ruleForm.targetAddress,"onUpdate:modelValue":a[4]||(a[4]=e=>t.ruleForm.targetAddress=e),placeholder:"例如: 8.8.8.8:80 或 example.com:80"},null,8,["modelValue"]),a[23]||(a[23]=d("div",{class:"form-tip"}," 支持 IPv4:端口、[IPv6]:端口 或 域名:端口 格式 ",-1)),t.isAdmin?v("",!0):(y(),n("div",ie,a[22]||(a[22]=[d("i",{class:"el-icon-info"},null,-1),w(" 提示：请使用公网IPv4地址，如 8.8.8.8、1.1.1.1 等（不允许使用本地地址） ")]))),t.isAdmin?(y(),n("div",ue," 管理员权限：可以转发任何地址 ")):v("",!0)])),_:1,__:[23]}),u(ge,{label:"协议",prop:"protocol"},{default:c((()=>[u(we,{modelValue:t.ruleForm.protocol,"onUpdate:modelValue":a[5]||(a[5]=e=>t.ruleForm.protocol=e),style:{width:"100%"}},{default:c((()=>[u(ye,{label:"TCP",value:"tcp",disabled:t.disabledProtocols.includes("tcp")},null,8,["disabled"]),u(ye,{label:"UDP",value:"udp",disabled:t.disabledProtocols.includes("udp")},null,8,["disabled"]),u(ye,{label:"TLS",value:"tls",disabled:t.disabledProtocols.includes("tls")},null,8,["disabled"])])),_:1},8,["modelValue"]),t.disabledProtocols.length>0?(y(),n("div",ce," 注意：管理员已禁用以下协议："+i(t.disabledProtocols.join(", ").toUpperCase()),1)):v("",!0)])),_:1}),u(ge,{label:"描述",prop:"description"},{default:c((()=>[u(ve,{modelValue:t.ruleForm.description,"onUpdate:modelValue":a[6]||(a[6]=e=>t.ruleForm.description=e),type:"textarea",rows:3,placeholder:"请输入规则描述（可选）"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue","onClose"])])}],["__scopeId","data-v-688ba46c"]]);export{pe as default};
